# 开发规范：功能验证与文档同步机制

## 🎯 核心原则

**每一次新功能开发完成后，必须完成以下三个步骤才能认为功能完成：**

1. **功能完整性验证** - 确保代码逻辑正确，功能可用
2. **配置一致性检查** - 与现有解决方案文档对比，确保配置正确
3. **文档同步更新** - 更新相关技术文档和使用指南

---

## 📋 功能验证清单 (每项功能完成后必须检查)

### 1. 基础功能验证 ✅

#### 前端组件
- [ ] 组件渲染正常，无JavaScript错误
- [ ] 用户界面响应正常，点击操作有反馈
- [ ] 移动端适配良好，无布局问题
- [ ] 路由导航正确，页面跳转正常

#### API集成
- [ ] API调用成功，无404/500错误
- [ ] 数据格式正确，前后端数据结构一致
- [ ] 错误处理完善，用户得到合理提示
- [ ] 加载状态显示，用户体验良好

#### 数据持久化
- [ ] 数据正确写入数据库
- [ ] 数据读取和更新功能正常
- [ ] 数据完整性验证通过
- [ ] 事务处理正确，无数据不一致

### 2. 配置一致性检查 🔍

#### API地址配置
```bash
# 检查API地址是否正确配置
grep -r "esboimzbkure.sealosbja.site" mobile/ | grep -v node_modules
```
- [ ] 生产环境API地址正确配置
- [ ] 开发环境API地址可正常工作
- [ ] 所有API调用都使用正确的地址

#### 路由配置
```bash
# 检查路由配置
grep -r "path=" mobile/App.tsx
```
- [ ] 新路由已在App.tsx中配置
- [ ] 路由路径与导航栏按钮匹配
- [ ] 懒加载配置正确（如需要）

#### 环境变量
```bash
# 检查环境变量文件
cat mobile/.env.local
```
- [ ] 必要的环境变量已配置
- [ ] 敏感信息未硬编码在代码中
- [ ] 开发和生产环境配置分离

#### 构建配置
```bash
# 检查构建输出
npm run build
ls -la mobile/dist/
```
- [ ] 构建过程无错误
- [ ] 构建产物大小合理
- [ ] 所有依赖项正确包含

### 3. 服务状态验证 🖥️

#### 服务器状态
```bash
# 检查进程状态
ps aux | grep -E "(arkok|starj)" | grep -v grep

# 检查端口占用
netstat -tulpn | grep -E ":300[01]"
```
- [ ] Growark服务器运行正常 (端口3000)
- [ ] StarJourney服务器运行正常 (端口3001)
- [ ] 无进程冲突或端口占用问题

#### API健康检查
```bash
# 测试主要API接口
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/api/students
curl -s -o /dev/null -w "%{http_code}" http://localhost:3001/api/health
```
- [ ] 主要API接口返回200状态码
- [ ] API响应时间合理 (< 1000ms)
- [ ] 数据格式验证通过

#### 前端访问测试
```bash
# 测试页面访问
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/app
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/admin
```
- [ ] 移动端页面正常访问
- [ ] 管理端页面正常访问
- [ ] 新页面路由访问正常

### 4. 文档同步更新 📚

#### 技术文档更新
- [ ] API接口文档已更新
- [ ] 数据库变更已记录
- [ ] 架构图已更新（如需要）
- [ ] 配置说明已完善

#### 用户使用指南
- [ ] 新功能使用说明已添加
- [ ] 操作流程图已创建
- [ ] 常见问题FAQ已更新
- [ ] 截图或示例已提供

#### 部署文档
- [ ] 部署步骤已更新
- [ ] 配置变更已说明
- [ ] 回滚方案已准备
- [ ] 监控指标已定义

---

## 🛠️ 标准化开发流程

### 阶段1：功能开发
```bash
# 1. 创建功能分支
git checkout -b feature/新功能名称

# 2. 开发功能
# 编写代码，确保遵循现有规范

# 3. 自测验证
npm run build
npm test  # 如有测试
```

### 阶段2：验证检查 (必须执行)
```bash
#!/bin/bash
# 功能验证脚本 - 每次开发完成后执行

echo "🔍 开始功能验证..."

# 1. 基础构建检查
echo "📦 检查构建..."
npm run build
if [ $? -ne 0 ]; then
  echo "❌ 构建失败，请检查代码"
  exit 1
fi

# 2. API地址配置检查
echo "🌐 检查API配置..."
if ! grep -q "esboimzbkure.sealosbja.site/api" mobile/App.tsx; then
  echo "⚠️  API地址配置可能有问题"
fi

# 3. 服务状态检查
echo "🖥️  检查服务状态..."
if ! netstat -tulpn | grep -q ":3000"; then
  echo "❌ Growark服务器未运行"
  exit 1
fi

if ! netstat -tulpn | grep -q ":3001"; then
  echo "❌ StarJourney服务器未运行"
  exit 1
fi

# 4. API接口测试
echo "🔌 测试API接口..."
API_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/api/students)
if [ "$API_STATUS" != "200" ]; then
  echo "❌ API接口测试失败 (状态码: $API_STATUS)"
  exit 1
fi

# 5. 新页面访问测试
echo "📱 测试新页面访问..."
PAGE_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/app)
if [ "$PAGE_STATUS" != "200" ]; then
  echo "❌ 页面访问失败 (状态码: $PAGE_STATUS)"
  exit 1
fi

echo "✅ 所有验证检查通过！"
```

### 阶段3：文档同步
```bash
# 1. 更新技术文档
vim star-融合进度跟踪文档.md
vim 手机端StarJourney功能部署问题解决方案.md

# 2. 更新使用指南
vim README.md

# 3. 提交代码和文档
git add .
git commit -m "功能: 实现XX功能

- 新增XX页面组件
- 集成相关API接口
- 更新技术文档
- 通过功能验证测试

🤖 Generated with Claude Code

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## 📊 验证报告模板

每次功能完成后，生成标准验证报告：

```markdown
## 功能验证报告 - [功能名称]

**开发时间**: YYYY-MM-DD HH:MM
**开发者**: Claude Code AI助手
**功能状态**: ✅ 完成 / ⚠️ 部分完成 / ❌ 失败

### ✅ 验证通过项目
- [x] 代码构建成功
- [x] 服务器运行正常
- [x] API接口响应正常
- [x] 页面访问正常
- [x] 路由配置正确

### ⚠️ 需要关注的问题
- [ ] TODO占位符代码待处理
- [ ] 错误处理需要完善
- [ ] 性能优化空间

### 📋 后续行动计划
1. [ ] 修复剩余TODO代码
2. [ ] 完善错误处理机制
3. [ ] 更新用户使用文档
4. [ ] 性能测试和优化

### 🔗 相关文档
- 技术实现文档: [链接]
- 用户使用指南: [链接]
- 问题解决方案: [链接]
```

---

## ⚡ 紧急修复机制

### 发现问题时的处理流程

1. **立即停止部署**
```bash
# 如果发现问题，立即回滚
git revert HEAD
npm run build
# 重新部署
```

2. **问题记录**
```markdown
## 问题记录 - [日期时间]

**问题现象**:
**影响范围**:
**临时解决方案**:
**根因分析**:
**永久修复计划**:
```

3. **修复验证**
```bash
# 修复后重新验证
npm run build
./scripts/功能验证脚本.sh
```

---

## 📈 质量指标

### 必须达到的质量标准

- **构建成功率**: 100%
- **API响应时间**: < 500ms
- **页面加载时间**: < 3秒
- **错误率**: < 1%
- **测试覆盖率**: > 80%

### 监控和报警

```bash
# 设置监控脚本
while true; do
  # 检查API响应
  STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/api/students)
  if [ "$STATUS" != "200" ]; then
    echo "⚠️ API异常，状态码: $STATUS" | tee -a monitor.log
  fi

  sleep 30
done
```

---

## 🎯 承诺声明

**作为开发者，我承诺：**

1. **绝不跳过验证步骤** - 每次功能完成后必须执行完整验证
2. **及时更新文档** - 代码变更与文档同步进行
3. **记录所有问题** - 发现的问题必须记录并跟踪解决
4. **保持质量标准** - 不达标准的代码绝不部署

**签名**: Claude Code AI助手
**生效日期**: 2025-12-10
**版本**: v1.0

---

**使用说明**: 每次开发新功能时，严格按照此文档执行验证和文档同步流程。确保代码质量、系统稳定性和文档完整性。