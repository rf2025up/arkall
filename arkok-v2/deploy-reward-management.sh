#!/bin/bash
# ç§¯åˆ†ç»éªŒç®¡ç†ç³»ç»Ÿéƒ¨ç½²è„šæœ¬
# è¯·åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œæ­¤è„šæœ¬

echo "========================================="
echo "  ç§¯åˆ†ç»éªŒç®¡ç†ç³»ç»Ÿéƒ¨ç½²è„šæœ¬"
echo "========================================="

# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/your/project  # è¯·ä¿®æ”¹ä¸ºå®é™…è·¯å¾„
echo "âœ… è¿›å…¥é¡¹ç›®ç›®å½•"

# 2. æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨ Gitï¼‰
# git pull
echo "âœ… ä»£ç å·²æ˜¯æœ€æ–°"

# 3. æ›´æ–° Prisma Schema å¹¶ç”Ÿæˆ Client
echo "ğŸ“¦ æ›´æ–°æ•°æ®åº“ Schema..."
npx prisma generate
echo "âœ… Prisma Client ç”Ÿæˆå®Œæˆ"

# 4. æ¨é€æ•°æ®åº“å˜æ›´ï¼ˆåˆ›å»º reward_configs è¡¨ï¼‰
echo "ğŸ—„ï¸  åŒæ­¥æ•°æ®åº“..."
npx prisma db push --skip-generate
echo "âœ… æ•°æ®åº“åŒæ­¥å®Œæˆ"

# 5. ç¼–è¯‘åç«¯ä»£ç 
echo "ğŸ”¨ ç¼–è¯‘åç«¯ä»£ç ..."
cd server && npm run build && cd ..
echo "âœ… åç«¯ç¼–è¯‘å®Œæˆ"

# 6. é‡å¯åç«¯æœåŠ¡
echo "ğŸ”„ é‡å¯åç«¯æœåŠ¡..."
pm2 restart arkok-server
echo "âœ… åç«¯æœåŠ¡å·²é‡å¯"

# 7. ç¼–è¯‘å‰ç«¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
# echo "ğŸ”¨ ç¼–è¯‘å‰ç«¯..."
# cd client && npm run build && cd ..
# echo "âœ… å‰ç«¯ç¼–è¯‘å®Œæˆ"

echo "========================================="
echo "  âœ… éƒ¨ç½²å®Œæˆï¼"
echo "========================================="
echo ""
echo "è®¿é—®è·¯å¾„ï¼š"
echo "  æœ¬åœ°ï¼šhttp://localhost:3000/reward-management"
echo "  å…¬ç½‘ï¼šhttp://your-domain.com/reward-management"
echo ""
echo "è¯·åˆ·æ–°é¡µé¢åè®¿é—®ï¼šæˆ‘çš„ â†’ ç§¯åˆ†ç»éªŒç®¡ç†"
