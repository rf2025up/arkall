# ğŸ¯ æƒé™é€»è¾‘ä¿®å¤æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜åˆ†æ

åŸºäºç”¨æˆ·åé¦ˆå’Œæ•°æ®åº“æ£€æŸ¥ï¼Œå‘ç°ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

### ğŸ” å½“å‰çŠ¶æ€
- **é¾™è€å¸ˆ**ï¼šå…­å¹´çº§1ç­ï¼Œç›®å‰åªæœ‰2ä¸ªå­¦ç”Ÿ
- **ç³»ç»Ÿç®¡ç†å‘˜**ï¼šæ— ç­çº§ï¼Œä½†ç»‘å®šäº†44ä¸ªå­¦ç”Ÿ
- **æµ‹è¯•æ•™å¸ˆ**ï¼šä¸€å¹´çº§1ç­ï¼Œç›®å‰åªæœ‰1ä¸ªå­¦ç”Ÿ
- **å…¶ä»–è€å¸ˆ**ï¼šå¤§éƒ¨åˆ†æ²¡æœ‰ç»‘å®šå­¦ç”Ÿ

### âŒ æƒé™é€»è¾‘é—®é¢˜
1. **æ ¡é•¿è§’è‰²ç¦ç”¨å¤±è´¥**ï¼šç³»ç»Ÿç®¡ç†å‘˜ä»èƒ½è®¿é—®åŠŸèƒ½
2. **å­¦ç”Ÿåˆ†é…æ··ä¹±**ï¼šæ ¡é•¿ç»‘å®šäº†å¤§é‡å­¦ç”Ÿ
3. **ç­çº§æ•°æ®ä¸å®Œæ•´**ï¼šè€å¸ˆæ²¡æœ‰è¶³å¤Ÿçš„ç­çº§å­¦ç”Ÿ

## ğŸ¯ æ­£ç¡®çš„æƒé™é€»è¾‘è®¾è®¡

### ğŸ‘‘ è§’è‰²å®šä¹‰
```
æ ¡é•¿ (ADMIN):
- ç¦æ­¢å‘å¸ƒå¤‡è¯¾å†…å®¹
- å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç­çº§çš„ç»Ÿè®¡æ•°æ®
- ä¸èƒ½æ“ä½œå…·ä½“å­¦ç”Ÿçš„å­¦ä¹ æ•°æ®

è€å¸ˆ (TEACHER):
- åªèƒ½å‘å¸ƒè‡ªå·±ç­çº§çš„å¤‡è¯¾å†…å®¹
- åªèƒ½çœ‹åˆ°è‡ªå·±ç­çº§çš„å­¦ç”Ÿæ•°æ®
- æŒ‰ç­çº§åˆ†ç»„æ˜¾ç¤ºå­¦ç”Ÿ
```

### ğŸ« å­¦ç”Ÿç»‘å®šè§„åˆ™
```
1. å­¦ç”Ÿåº”è¯¥ç»‘å®šåˆ°å…·ä½“ç­çº§çš„è€å¸ˆ
2. æ¯ä¸ªè€å¸ˆç®¡ç†è‡ªå·±çš„ç­çº§å­¦ç”Ÿ
3. æ ¡é•¿è§’è‰²ä¸ç›´æ¥ç»‘å®šå­¦ç”Ÿ
4. ç­çº§ä¸primaryClassNameå­—æ®µå¯¹åº”
```

## ğŸ”§ ä¿®å¤æ­¥éª¤

### æ­¥éª¤1: æ•°æ®åº“å­—æ®µåä¿®å¤
```sql
-- æ£€æŸ¥studentsè¡¨ç»“æ„
SELECT column_name FROM information_schema.columns WHERE table_name = 'students';

-- ç¡®ä¿å­—æ®µåæ­£ç¡®
-- åº”è¯¥æœ‰: id, name, className, teacherId, isActive, ç­‰
```

### æ­¥éª¤2: å­¦ç”Ÿé‡æ–°ç»‘å®š
```javascript
// å°†æ ¡é•¿ç»‘å®šçš„å­¦ç”Ÿé‡æ–°åˆ†é…ç»™å…·ä½“è€å¸ˆ
const adminStudents = await prisma.students.findMany({
  where: {
    teacherId: adminId,  // æ ¡é•¿ID
    isActive: true
  }
});

// æŒ‰ç­çº§é‡æ–°åˆ†é…
conståˆ†é…é€»è¾‘ = {
  'é¾™è€å¸ˆ': 'å…­å¹´çº§1ç­', // 5åå­¦ç”Ÿ
  'æµ‹è¯•æ•™å¸ˆ': 'ä¸€å¹´çº§1ç­', // 8åå­¦ç”Ÿ
  'å…¶ä»–è€å¸ˆ': 'å„å¯¹åº”ç­çº§' // å‰©ä½™å­¦ç”Ÿ
};
```

### æ­¥éª¤3: å‰ç«¯æƒé™æ£€æŸ¥
```typescript
// è§’è‰²æƒé™ä¸­é—´ä»¶
const checkTeacherPermission = (user) => {
  if (user.role === 'ADMIN') {
    return {
      canPublish: false,
      message: 'æ ¡é•¿æ— æƒé™å‘å¸ƒå¤‡è¯¾å†…å®¹ï¼Œè¯·åˆ‡æ¢åˆ°å…·ä½“è€å¸ˆç­çº§'
    };
  }

  if (user.role === 'TEACHER' && !user.primaryClassName) {
    return {
      canPublish: false,
      message: 'è¯·å…ˆè®¾ç½®ä¸»è¦ç­çº§'
    };
  }

  return { canPublish: true };
};
```

### æ­¥éª¤4: è¿‡å…³é¡µæ˜¾ç¤ºé€»è¾‘
```typescript
// æŒ‰ç­çº§è¿‡æ»¤å­¦ç”Ÿ
const getStudentsByTeacher = async (teacherId: string) => {
  const students = await prisma.students.findMany({
    where: {
      teacherId: teacherId,
      isActive: true
    },
    orderBy: [
      { className: 'asc' },
      { name: 'asc' }
    ]
  });

  return students; // è¿”å›è¯¥è€å¸ˆçš„æ‰€æœ‰å­¦ç”Ÿ
};
```

## ğŸ“ APIä¿®æ”¹éœ€æ±‚

### 1. å¤‡è¯¾å‘å¸ƒAPIæƒé™æ£€æŸ¥
```typescript
// åœ¨ POST /api/lms/publish ä¸­æ·»åŠ 
const checkPermission = (user) => {
  if (user.role === 'ADMIN') {
    throw new Error('æ ¡é•¿æ— æƒé™å‘å¸ƒå¤‡è¯¾å†…å®¹ï¼Œè¯·åˆ‡æ¢åˆ°å…·ä½“è€å¸ˆç­çº§');
  }
  return true;
};
```

### 2. å­¦ç”ŸAPIæŒ‰ç­çº§è¿‡æ»¤
```typescript
// ä¿®æ”¹ GET /api/students è·¯ç”±
router.get('/students', async (req, res) => {
  const user = req.user; // ä»è®¤è¯ä¸­é—´ä»¶è·å–

  let students;
  if (user.role === 'ADMIN') {
    // æ ¡é•¿çœ‹ä¸åˆ°å…·ä½“å­¦ç”Ÿæ•°æ®ï¼Œåªèƒ½çœ‹ç»Ÿè®¡
    return res.json({
      success: true,
      data: { students: [], total: 0, message: 'è¯·åˆ‡æ¢åˆ°å…·ä½“è€å¸ˆæŸ¥çœ‹å­¦ç”Ÿæ•°æ®' }
    });
  } else {
    // è€å¸ˆçœ‹åˆ°è‡ªå·±ç­çº§çš„å­¦ç”Ÿ
    students = await prisma.students.findMany({
      where: {
        teacherId: user.userId,
        isActive: true
      }
    });
  }

  res.json({
    success: true,
    data: { students, total: students.length }
  });
});
```

## âœ… é¢„æœŸç»“æœ

ä¿®å¤å®Œæˆåï¼š
- âœ… é¾™è€å¸ˆç­æ˜¾ç¤º5ä¸ªå…­å¹´çº§1ç­å­¦ç”Ÿ
- âœ… æµ‹è¯•æ•™å¸ˆç­æ˜¾ç¤º8ä¸ªä¸€å¹´çº§1ç­å­¦ç”Ÿ
- âœ… æ ¡é•¿è§’è‰²æ— æ³•å‘å¸ƒå¤‡è¯¾
- âœ… è¿‡å…³é¡µæŒ‰ç­çº§åˆ†ç»„æ˜¾ç¤º
- âœ… å­¦ç”Ÿæ•°æ®æŒ‰ç­çº§æ­£ç¡®å½’å±

## ğŸš€ éƒ¨ç½²éªŒè¯

1. æ•°æ®åº“å­—æ®µåæ£€æŸ¥
2. å­¦ç”Ÿé‡æ–°åˆ†é…
3. æƒé™ä¸­é—´ä»¶æ›´æ–°
4. å‰ç«¯UIæƒé™æ§åˆ¶
5. APIç«¯ç‚¹æƒé™æ£€æŸ¥

## ğŸ“Š éªŒè¯æ¸…å•

- [ ] æ ¡é•¿æ— æ³•å‘å¸ƒå¤‡è¯¾
- [ ] é¾™è€å¸ˆç­æ˜¾ç¤º5ä¸ªå­¦ç”Ÿ
- [ ] æµ‹è¯•æ•™å¸ˆç­æ˜¾ç¤º8ä¸ªå­¦ç”Ÿ
- [ ] è¿‡å…³é¡µåˆ·æ–°åç«‹å³æ˜¾ç¤ºæ­£ç¡®å­¦ç”Ÿ
- [ ] ç­çº§åˆ†ç»„æ­£ç¡®
- [ ] æ— ç­çº§è€å¸ˆæ˜¾ç¤ºæç¤ºä¿¡æ¯