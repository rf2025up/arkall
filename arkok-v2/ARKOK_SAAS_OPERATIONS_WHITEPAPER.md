# ArkOK V2 SaaS 多校区运营管理白皮书 (V5.0 Operator Edition)

本白皮书旨在定义 ArkOK 作为 SaaS 平台在多校区环境下的**平台治理架构**、**角色权力拓扑**及**运营标准化流程**。

---

## 1. SaaS 多租户架构本质：隔离与超越

ArkOK 采用的是 **“单实例、多租户 (Single-Instance, Multi-Tenant)”** 架构。

- **隔离 (Isolation)**: 默认情况下，所有数据请求必须携带 `schoolId` 过滤器。这是为了确保“校区 A”的数据是一座孤岛，校区 B 无法窥视。
- **超越 (Transcendence)**: 超级管理员 (SUPER_ADMIN) 的本质是**“跨校区穿透”**。它在查询时不再受单一 `schoolId` 限制，从而实现全局掌控。

---

## 2. 角色权力拓扑 (Role Hierarchy)

| 角色 | 权限逻辑层 | 核心职责 | 业务隐喻 |
| :--- | :--- | :--- | :--- |
| **超级管理员 (SUPER_ADMIN)** | **平台控制面 (Control Plane)** | 创建校区、分配功能插件、管理续费、全局审计、跨校区支持。 | **造物主 (SaaS 运营商)** |
| **校区管理员 (ADMIN)** | **租户管理面 (Tenant Admin)** | 校内师生绑定、全校看板管理、校内勋章库配置。 | **代理人 (校长/分校负责人)** |
| **教师 (TEACHER)** | **业务执行面 (Data Plane)** | 备课发布、评价、1v1 讲解进度推进。 | **执行者 (一线教师)** |

---

## 3. 超级管理员与校区间的“上帝视角”逻辑

### 3.1 掌控权：插件化功能包 (Feature Flags)
超级管理员不再干预具体的教学，而是通过“开关”管理价值：
- **AI 套餐包**: 决定该校区是否有权调用“AI 错题分析”。
- **讲解套餐包**: 开启或关闭“1v1 讲解”模块。
- **容量配额**: 设置校区允许的最大教师数和学生总数。

### 3.2 治理权：续费与生命周期
每一个校区（如：星途与伴）在平台眼中都有一个 `expiresAt` (过期时间) 和 `planType` (套餐类型)。超级管理员拥有唯一的账务更新权，当校区欠费或未续费时，可一键将其 `isActive` 置为 `false`。

---

## 4. 新开校区标准化操作手册 (Standard Onboarding SOP)

当您（超级管理员）需要引入一个新机构（例如：“阳光学堂”）时，流程分为以下两个阶段：

### 4.1 阶段一：当前“开发者模式” (脚本驱动)
在平台控制台尚未完全上线前，您只需通过执行我为您准备的 `create_tenant.ts` 脚本即可快速开通：

1. **执行指令**: `npm run tenant:create --name="阳光学堂" --admin="sun_admin"`
2. **后端逻辑**:
   - 自动生成该校区的唯一 UUID。
   - 自动注入默认的“教育哲学”文案。
   - 自动创建一个 `Role: ADMIN` 的账号，初始密码设为 `123456`。
3. **交付**: 将账号交给对方校长，由其在校内自行认领老师。

### 4.2 阶段二：未来“运营商模式” (UI 驱动)
当【超级管理员控制台】上线后，流程将简化为：

1. **登录**: 使用您的 `root` 账号进入 `/super-admin/tenants`。
2. **点击 [新增校区]**:
   - 输入校区名称。
   - 勾选功能包（是否包含 AI、1v1 讲解）。
   - 设置有效期（续费结束时间）。
3. **一键分发**: 点击“创建”后，系统自动生成管理员初始账号并提供二维码/链接供对方认领。

### 4.3 新校区“从零到一”的生命周期
- **T+0**: 您创建校区，产生 `schoolId`。
- **T+1**: 校长登录，创建本校老师账号 (或由老师自行注册后，校长执行“认领”)。
- **T+2**: 老师登录，导入学生名单，开始发布第一条备课计划。
- **T+3**: 产生第一条 `task_records`，该校区的“成长长河”正式开始流淌。

---

## 5. 超级管理员前端界面 (Platform Dashboard) 规划

### 5.1 是否需要独立界面？
**答案是：必须。** 
如果不做独立界面，您的管理入口将混合在业务入口中，极易导致误操作，且难以展示“全局看板”。

### 5.2 核心模块设计
- **校区罗盘 (School Compass)**: 展示全平台所有校区的分布、活跃度、存储占用情况。
- **账务中心 (Billing Center)**: 到期校区预警、续费流水记录。
- **功能工厂 (Feature Factory)**: 全局管理 AI 服务的 API 余额、系统负载情况。
- **全局搜索 (Master Search)**: 唯一可以实现一键检索全平台任意学生或老师的入口（用于客服响应或排查问题）。

---

## 6. SaaS 运营的未来：数据中台
未来，超级管理员将能看到**“全校区对比分析”**：
- 哪个校区的“过关率”最高？
- 哪个校区的“1v1 讲解”转化效果最好？
- 从而提炼出最佳实践，反哺给全平台的校区。

---
*星途大海，共筑传奇。本白皮书由 ArkOK V5.0 总架构师于 2025-12-23 编写，作为多校区商业化运营的最高行动纲领。*
