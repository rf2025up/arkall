# ğŸ›¡ï¸ ArkOK V2 å¼€å‘è¡Œä¸ºå‡†åˆ™ä¸çº¦æŸ

> **æ ¸å¿ƒåŸåˆ™**: æ–‡æ¡£å³çœŸç†ï¼Œä»£ç è´¨é‡ä¼˜å…ˆï¼Œæ¶æ„è§„èŒƒè‡³ä¸Šï¼Œç”¨æˆ·ä½“éªŒä¸ºæœ¬

## ğŸŒ éƒ¨ç½²ç¯å¢ƒè¯´æ˜ (Deployment Environment)

### ğŸ“‹ å½“å‰éƒ¨ç½²çŠ¶æ€
- **ä¸»ç¯å¢ƒ**: **å…¬ç½‘ç”Ÿäº§ç¯å¢ƒ** (ä¼˜å…ˆçº§é«˜äºæœ¬åœ°å¼€å‘)
- **å…¬ç½‘åœ°å€**: https://esboimzbkure.sealosbja.site âœ… **æ­£å¸¸è®¿é—®**
- **éƒ¨ç½²å¹³å°**: Sealos Kubernetes å¹³å°
- **å‘½åç©ºé—´**: ns-bg6fgs6y
- **ç‰ˆæœ¬**: v2.0.0
- **çŠ¶æ€**: ç”Ÿäº§ç¯å¢ƒç¨³å®šè¿è¡Œ

### ğŸš€ è®¿é—®åœ°å€
| åŠŸèƒ½ | URL | è¯´æ˜ |
|------|-----|------|
| **æ‰‹æœºç«¯æ•™å¸ˆåº”ç”¨** | https://esboimzbkure.sealosbja.site | ä¸»è¦åº”ç”¨å…¥å£ |
| **å¤§å±å±•ç¤º** | https://esboimzbkure.sealosbja.site/screen | åŒæ¨¡å¤§å±ç³»ç»Ÿ |
| **å¥åº·æ£€æŸ¥** | https://esboimzbkure.sealosbja.site/health | æœåŠ¡çŠ¶æ€ç›‘æ§ |

### ğŸ”„ å¼€å‘åˆ°éƒ¨ç½²æµç¨‹ (æœ€é«˜ä¼˜å…ˆçº§)
1. **å…¬ç½‘éƒ¨ç½²ä¼˜å…ˆ**: `./deploy-to-sealos.sh` (å¿…é¡»é¦–å…ˆæ‰§è¡Œ)
2. **å…¬ç½‘ç¯å¢ƒéªŒè¯**: åœ¨ https://esboimzbkure.sealosbja.site éªŒè¯åŠŸèƒ½
3. **æœ¬åœ°å¼€å‘**: `./dev.sh` (ä»…å½“å…¬ç½‘ç¯å¢ƒä¸å¯ç”¨æ—¶ç”¨äºè°ƒè¯•)

**ğŸš¨ å…³é”®åŸåˆ™**:
- **æ–°ä¼šè¯å¯åŠ¨æ—¶**: è‡ªåŠ¨æ‰§è¡Œå…¬ç½‘éƒ¨ç½²ï¼Œä¸å†è¯¢é—®
- **åŠŸèƒ½éªŒè¯**: å¿…é¡»åœ¨å…¬ç½‘ç¯å¢ƒéªŒè¯ï¼Œæœ¬åœ°ç¯å¢ƒä»…ä½œä¸ºå¤‡ç”¨
- **éƒ¨ç½²ä¼˜å…ˆ**: ä»»ä½•ä»£ç ä¿®æ”¹åç«‹å³éƒ¨ç½²åˆ°å…¬ç½‘æµ‹è¯•

### ğŸš€ æ–°ä¼šè¯å¯åŠ¨æµç¨‹ (Session Startup Protocol)

**ğŸš¨ æ–°ä¼šè¯å¯åŠ¨æ—¶çš„å¼ºåˆ¶æ£€æŸ¥æµç¨‹**ï¼š
å½“ AI åŠ©æ‰‹å¯åŠ¨æ–°ä¼šè¯æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š

```bash
# ğŸ”„ æ–°ä¼šè¯å¯åŠ¨æ—¶çš„å¼ºåˆ¶æ£€æŸ¥æµç¨‹
# 1. è¯»å–ä»»åŠ¡è¿›åº¦ (å¿…é¡»é¦–å…ˆæ‰§è¡Œ)
cat docs/TASK_PROGRESS.md

# 2. è¯»å–å¼€å‘è§„åˆ™ (åŒ…å«éƒ¨ç½²ç¯å¢ƒä¿¡æ¯)
cat docs/DEVELOPMENT_RULES.md

# 3. è¯»å–æ¶æ„ç™½çš®ä¹¦
cat docs/ARCHITECTURE_WHITEPAPER.md

# 4. ğŸš¨ éªŒè¯å…¬ç½‘æœåŠ¡çŠ¶æ€
curl -I https://esboimzbkure.sealosbja.site/health

# 5. æ£€æŸ¥PM2æœåŠ¡çŠ¶æ€
pm2 list

# 6. ä»…å½“å…¬ç½‘ä¸å¯ç”¨æ—¶ï¼Œå¯åŠ¨æœ¬åœ°æœåŠ¡
./dev.sh
```

## ğŸš€ PM2 ç”Ÿäº§ç¯å¢ƒæ›´æ–°è§„èŒƒï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

### ğŸ“‹ æ ‡å‡†æ›´æ–°æµç¨‹

**ğŸ¯ ä»£ç ä¿®æ”¹åçš„å¼ºåˆ¶æ›´æ–°æµç¨‹**ï¼š

#### ç¬¬ä¸€é˜¶æ®µï¼šä»£ç ç¼–è¯‘
```bash
# 1. å‰ç«¯ä»£ç ä¿®æ”¹ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
cd client && npm run build
# âœ… éªŒè¯æ„å»ºæˆåŠŸ

# 2. åç«¯ä»£ç ä¿®æ”¹ï¼ˆæ¨èæ‰§è¡Œï¼‰
cd server && npm run build
# âš ï¸ TypeScripté”™è¯¯ä¸å½±å“è¿è¡Œæ—¶ï¼Œå¯ç»§ç»­éƒ¨ç½²
```

#### ç¬¬äºŒé˜¶æ®µï¼šæœåŠ¡æ›´æ–°
```bash
# 3. é‡å¯PM2æœåŠ¡ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
pm2 restart arkok-v2
# âœ… åŠ è½½æ–°ä»£ç åˆ°ç”Ÿäº§ç¯å¢ƒ

# 4. ä¿å­˜é…ç½®ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
pm2 save
# âœ… ç¡®ä¿é‡å¯åè‡ªåŠ¨æ¢å¤
```

#### ç¬¬ä¸‰é˜¶æ®µï¼šéªŒè¯æµ‹è¯•
```bash
# 5. éªŒè¯æœåŠ¡çŠ¶æ€ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
curl -I https://esboimzbkure.sealosbja.site/health
# âœ… æœŸæœ›ç»“æœï¼šHTTP/2 200

# 6. æ£€æŸ¥è¿›ç¨‹çŠ¶æ€ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
pm2 list
# âœ… æœŸæœ›ç»“æœï¼šarkok-v2 è¿›ç¨‹çŠ¶æ€ä¸º online

# 7. åŠŸèƒ½æµ‹è¯•ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
# è®¿é—® https://esboimzbkure.sealosbja.site
# éªŒè¯ä¿®æ”¹çš„åŠŸèƒ½æ˜¯å¦ç”Ÿæ•ˆ
```

### ğŸ› ï¸ PM2 å¼ºåˆ¶ç®¡ç†å‘½ä»¤

#### æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
# è¿›ç¨‹çŠ¶æ€æ€»è§ˆ
pm2 status

# è¯¦ç»†è¿›ç¨‹ä¿¡æ¯
pm2 show arkok-v2

# å®æ—¶ç›‘æ§
pm2 monit
```

#### æ—¥å¿—ç›‘æ§
```bash
# å®æ—¶æ—¥å¿—
pm2 logs arkok-v2

# é”™è¯¯æ—¥å¿—
pm2 logs arkok-v2 --err

# æŒ‡å®šè¡Œæ•°
pm2 logs arkok-v2 --lines 50
```

#### ç´§æ€¥æ¢å¤
```bash
# æœåŠ¡å¼‚å¸¸æ—¶å¼ºåˆ¶é‡å¯
pm2 restart arkok-v2

# é…ç½®é”™è¯¯æ—¶é‡å»º
pm2 delete arkok-v2
pm2 start ecosystem.config.js
pm2 save
```

### ğŸš¨ æ›´æ–°å¤±è´¥å¤„ç†

#### ç¼–è¯‘é”™è¯¯å¤„ç†
```bash
# TypeScriptç¼–è¯‘é”™è¯¯å¤„ç†ç­–ç•¥
# 1. å‰ç«¯ç¼–è¯‘é”™è¯¯ï¼šå¿…é¡»è§£å†³
cd client && npm run build

# 2. åç«¯ç¼–è¯‘é”™è¯¯ï¼šå¯å¿½ç•¥è¿è¡Œæ—¶é”™è¯¯
cd server && npm run build
# å¦‚æœä¸å½±å“ç¼–è¯‘äº§ç‰©ï¼Œç»§ç»­æ›´æ–°æµç¨‹

# 3. å¼ºåˆ¶æ›´æ–°
npm run build --force
pm2 restart arkok-v2
```

#### æœåŠ¡å¼‚å¸¸å¤„ç†
```bash
# æœåŠ¡æ— å“åº”æ—¶
curl -I https://esboimzbkure.sealosbja.site/health

# é‡å¯æœåŠ¡
pm2 restart arkok-v2

# é‡å¯åéªŒè¯
pm2 list
curl -I https://esboimzbkure.sealosbja.site/health
```

### ğŸ“ ä»£ç ä¿®æ”¹æ›´æ–°è§„èŒƒ

#### å¿…é¡»æ›´æ–°çš„ä¿®æ”¹ç±»å‹
1. **å‰ç«¯ç»„ä»¶ä¿®æ”¹** â†’ `npm run build` â†’ `pm2 restart`
2. **API è·¯ç”±ä¿®æ”¹** â†’ `pm2 restart`
3. **æ•°æ®åº“æ¨¡å‹ä¿®æ”¹** â†’ è¿ç§» â†’ `pm2 restart`
4. **ç¯å¢ƒé…ç½®ä¿®æ”¹** â†’ `pm2 restart --update-env`
5. **ä¾èµ–åŒ…æ›´æ–°** â†’ `pm2 restart`

#### å¯é€‰æ‹©æ€§æ›´æ–°çš„ä¿®æ”¹ç±»å‹
1. **çº¯æ³¨é‡Šä¿®æ”¹** â†’ æ— éœ€æ›´æ–°
2. **æ–‡æ¡£ä¿®æ”¹** â†’ æ— éœ€æ›´æ–°
3. **æµ‹è¯•ä»£ç ä¿®æ”¹** â†’ æ— éœ€æ›´æ–°

### ğŸ”’ ç”Ÿäº§ç¯å¢ƒå®‰å…¨è§„èŒƒ

#### æ›´æ–°å‰æ£€æŸ¥æ¸…å•
- [ ] å‰ç«¯æ„å»ºæˆåŠŸï¼ˆæ— é”™è¯¯ï¼‰
- [ ] åç«¯ç¼–è¯‘æˆåŠŸï¼ˆæˆ–å¯æ¥å—çš„é”™è¯¯ï¼‰
- [ ] PM2 é…ç½®æ–‡ä»¶æ­£ç¡®
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] å¤‡ä»½å½“å‰ç‰ˆæœ¬

#### æ›´æ–°åéªŒè¯æ¸…å•
- [ ] æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] è¿›ç¨‹çŠ¶æ€ä¸º online
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ—¥å¿—æ— ä¸¥é‡é”™è¯¯
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸

### ğŸ“Š ç›‘æ§æŒ‡æ ‡

#### æœåŠ¡å¥åº·æŒ‡æ ‡
- **å“åº”æ—¶é—´**: < 200ms
- **å†…å­˜ä½¿ç”¨**: < 512MB
- **CPUä½¿ç”¨**: < 70%
- **é‡å¯æ¬¡æ•°**: ç›‘æ§å¼‚å¸¸é‡å¯
- **è¿è¡Œæ—¶é—´**: ç›‘æ§æœåŠ¡ç¨³å®šæ€§

#### æ›´æ–°æˆåŠŸæŒ‡æ ‡
- **æ„å»ºæ—¶é—´**: < 30ç§’
- **é‡å¯æ—¶é—´**: < 10ç§’
- **æ¢å¤æ—¶é—´**: < 1åˆ†é’Ÿ
- **åŠŸèƒ½éªŒè¯**: 100%é€šè¿‡

**ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸç†**ï¼š
1. **å…¬ç½‘éƒ¨ç½²ä¼˜å…ˆ**: è‡ªåŠ¨éƒ¨ç½²åˆ°å…¬ç½‘ç¯å¢ƒï¼Œæ— éœ€äººå·¥å¹²é¢„
2. **å…¬ç½‘éªŒè¯ä¼˜å…ˆ**: é¦–å…ˆåœ¨å…¬ç½‘ç¯å¢ƒéªŒè¯åŠŸèƒ½
3. **æœ¬åœ°å¤‡ç”¨**: ä»…å½“å…¬ç½‘ä¸å¯ç”¨æ—¶æ‰å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡
4. **æ–‡æ¡£é©±åŠ¨**: æ‰€æœ‰å†³ç­–åŸºäºæ–‡æ¡£ä¸­çš„é…ç½®ä¿¡æ¯

**ğŸ“‹ å¯åŠ¨æ£€æŸ¥æ¸…å•** (æ¯æ¬¡æ–°ä¼šè¯è‡ªåŠ¨æ‰§è¡Œ)ï¼š
- [x] è¯»å– `TASK_PROGRESS.md` - äº†è§£ä¸Šæ¬¡å·¥ä½œæ–­ç‚¹
- [x] è¯»å– `DEVELOPMENT_RULES.md` - äº†è§£éƒ¨ç½²ç¯å¢ƒ
- [x] è¯»å– `ARCHITECTURE_WHITEPAPER.md` - ç†è§£ç³»ç»Ÿæ¶æ„
- [x] å¯åŠ¨æœ¬åœ°æœåŠ¡ `./dev.sh` - æä¾›å³æ—¶å¼€å‘ç¯å¢ƒ

**ğŸ”„ å·¥ä½œæ¨¡å¼å†³ç­–é€»è¾‘**ï¼š
```typescript
// å¯åŠ¨æ—¶çš„ç¯å¢ƒå†³ç­–
const deploymentStrategy = {
  hasPublicDeployment: true,  // ä» DEVELOPMENT_RULES.md è¯»å–
  publicURL: "https://esboimzbkure.sealosbja.site",  // æ–‡æ¡£ä¸­å®šä¹‰
  localEnv: "development",    // ./dev.sh å¯åŠ¨
  strategy: "DUAL_ENV"       // åŒç¯å¢ƒç­–ç•¥
};

// å†³ç­–æµç¨‹ï¼š
// 1. å¯åŠ¨æœ¬åœ°æœåŠ¡ç”¨äºå¿«é€Ÿæµ‹è¯•
// 2. æé†’ç”¨æˆ·å…¬ç½‘éƒ¨ç½²çš„å­˜åœ¨
// 3. å»ºè®®æœ€ç»ˆåœ¨å…¬ç½‘ç¯å¢ƒéªŒè¯åŠŸèƒ½
```

## âš ï¸ æœ€é«˜é“å¾‹ - Rule #0 (é›¶å·æ³•åˆ™) - CRITICAL

### 0. ğŸ“ æ–‡æ¡£å³çœŸç† (Documentation is Truth) - CRITICAL
- **å®æ—¶åŒæ­¥**: æ¯å½“ä¿®å¤ä¸€ä¸ª Bug æˆ–å®Œæˆä¸€ä¸ªåŠŸèƒ½ï¼Œ**å¿…é¡»ç«‹åˆ»** æ›´æ–° `docs/CURRENT_STATUS.md` å’Œ `docs/TASK_PROGRESS.md`ã€‚
- **ä¸‹ç­ä»ªå¼**: åœ¨ç»“æŸå½“å‰ä¼šè¯æˆ–è¢«å‘ŠçŸ¥"é‡å¯"å‰ï¼Œ**å¿…é¡»** æ‰§è¡Œä¸€æ¬¡"çŠ¶æ€åŒæ­¥"ï¼Œç¡®ä¿æ–‡æ¡£åæ˜ äº†ä»£ç çš„æœ€æ–°çŠ¶æ€ã€‚
- **ç¦æ­¢éšç’**: å¦‚æœæŸä¸ªåŠŸèƒ½æ²¡ä¿®å¥½ï¼Œåœ¨æ–‡æ¡£é‡Œå¿…é¡»æ ‡è®°ä¸º `[ ]` (æœªå®Œæˆ)ï¼Œä¸¥ç¦æ ‡è®°ä¸º `[x]`ã€‚

**å…·ä½“æ‰§è¡Œæµç¨‹**:
```bash
# 1. å®Œæˆä»»ä½•åŠŸèƒ½æˆ–ä¿®å¤åï¼Œç«‹å³æ‰§è¡Œ
echo "$(date): å®Œæˆäº†XXXåŠŸèƒ½ä¿®å¤" >> docs/TASK_PROGRESS.md
echo "$(date): æ›´æ–°äº†XXXç»„ä»¶çš„çŠ¶æ€ä¸ºå·²å®Œæˆ" >> docs/CURRENT_STATUS.md

# 2. ä¼šè¯ç»“æŸå‰çš„å¼ºåˆ¶æ£€æŸ¥
echo "=== ä¼šè¯ç»“æŸçŠ¶æ€åŒæ­¥ ==="
echo "å½“å‰å·²å®Œæˆ: [åˆ—å‡ºå·²å®Œæˆé¡¹ç›®]"
echo "æœªå®Œæˆé¡¹ç›®: [åˆ—å‡ºæœªå®Œæˆé¡¹ç›®]"
echo "ä¸‹æ¬¡ç»­æ¥ç‚¹: [æ˜ç¡®æŒ‡å‡ºä¸‹æ¬¡åº”ä»å“ªé‡Œå¼€å§‹]"
```

**é›¶å·æ³•åˆ™æ‰§è¡Œæ£€æŸ¥æ¸…å•**:
- [ ] ä»Šå¤©çš„æ‰€æœ‰åŠŸèƒ½ä¿®æ”¹éƒ½å·²è®°å½•åœ¨æ–‡æ¡£ä¸­ï¼Ÿ
- [ ] æœªå®Œæˆçš„åŠŸèƒ½æ˜¯å¦æ˜ç¡®æ ‡è®°ä¸º `[ ]` çŠ¶æ€ï¼Ÿ
- [ ] ä¸‹æ¬¡å¼€å‘è€…èƒ½å¦æ ¹æ®æ–‡æ¡£å¿«é€Ÿç†è§£å½“å‰çŠ¶æ€ï¼Ÿ
- [ ] æ˜¯å¦æ‰§è¡Œäº†ä¼šè¯ç»“æŸçŠ¶æ€åŒæ­¥ï¼Ÿ

**è¿åé›¶å·æ³•åˆ™çš„åæœ**:
- **ç¬¬ä¸€æ¬¡**: ç›´æ¥å›æ»šä»£ç ï¼Œé‡æ–°æ‰§è¡Œæ–‡æ¡£åŒæ­¥
- **ç¬¬äºŒæ¬¡**: æš‚åœå¼€å‘æƒé™ï¼Œå¼ºåˆ¶æ¥å—æ–‡æ¡£ç®¡ç†åŸ¹è®­
- **ä¸¥é‡è¿è§„**: ä»é¡¹ç›®ä¸­ç§»é™¤ï¼Œç¡®ä¿é¡¹ç›®æ–‡æ¡£å®Œæ•´æ€§

## âš ï¸ äº”å¤§é“å¾‹ (ä¸¥ç¦è¿å)

### 1. ğŸš« æ‹’ç»"åˆ›å¯è´´"å¼ä¿®å¤
**è§„åˆ™**: ç¦æ­¢ä½¿ç”¨ `window.location.reload()` æ¥åˆ·æ–°æ•°æ®
**æ­£ç¡®åšæ³•**: ä½¿ç”¨ React çŠ¶æ€æ›´æ–°æœºåˆ¶

```typescript
// âŒ é”™è¯¯ç¤ºèŒƒ - åˆ›å¯è´´å¼ä¿®å¤
const handleScoreUpdate = async () => {
  await updateStudentScore(studentId, points);
  window.location.reload(); // ğŸš« ä¸¥ç¦ä½¿ç”¨ï¼
};

// âœ… æ­£ç¡®ç¤ºèŒƒ - React çŠ¶æ€æ›´æ–°
const [students, setStudents] = useState<Student[]>([]);

const handleScoreUpdate = async (studentId: string, points: number) => {
  await updateStudentScore(studentId, points);

  // é€šè¿‡çŠ¶æ€æ›´æ–°è§¦å‘é‡æ–°æ¸²æŸ“
  setStudents(prev => prev.map(student =>
    student.id === studentId
      ? { ...student, points: student.points + points }
      : student
  ));

  // æˆ–è€…é€šè¿‡ Socket.io å®æ—¶åŒæ­¥
  socket.emit('requestStudentRefresh');
};
```

**ä¸ºä»€ä¹ˆé‡è¦**:
- ä¿æŒå•é¡µåº”ç”¨çš„ç”¨æˆ·ä½“éªŒ
- é¿å…é¡µé¢çŠ¶æ€ä¸¢å¤±
- ç¬¦åˆ React å“åº”å¼è®¾è®¡åŸåˆ™

### 2. ğŸ›¡ï¸ ç±»å‹å®‰å…¨ç¬¬ä¸€
**è§„åˆ™**: å°½å¯èƒ½é¿å…ä½¿ç”¨ `as any`ï¼Œå¿…é¡»å®šä¹‰ Interface

```typescript
// âŒ é”™è¯¯ç¤ºèŒƒ - ç±»å‹ä¸å®‰å…¨
const data = response.data as any;
const user = data.user; // è¿è¡Œæ—¶é”™è¯¯é£é™©

// âœ… æ­£ç¡®ç¤ºèŒƒ - å®Œæ•´ç±»å‹å®šä¹‰
interface User {
  id: string;
  name: string;
  points: number;
  exp: number;
  schoolId: string;
  isActive: boolean;
}

interface ApiResponse<T> {
  success: boolean;
  data?: T;
  message?: string;
  error?: string;
}

const response = await fetch('/api/students');
const apiResponse: ApiResponse<User[]> = await response.json();

if (apiResponse.success && apiResponse.data) {
  const users = apiResponse.data; // ç±»å‹å®‰å…¨ï¼Œæ™ºèƒ½æç¤º
}
```

**ç±»å‹å®šä¹‰è§„èŒƒ**:
```typescript
// ä¸šåŠ¡å®ä½“ç±»å‹
interface Student {
  id: string;
  name: string;
  avatar?: string;
  points: number;
  exp: number;
  schoolId: string;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// API è¯·æ±‚ç±»å‹
interface CreateStudentRequest {
  name: string;
  avatar?: string;
  schoolId: string;
}

// API å“åº”ç±»å‹
interface StudentResponse {
  success: boolean;
  data?: Student;
  message?: string;
  error?: string;
}

// ç»„ä»¶ Props ç±»å‹
interface StudentCardProps {
  student: Student;
  onScoreUpdate: (studentId: string, points: number) => void;
  readonly?: boolean;
}
```

### 3. ğŸ“š ä»¥æ—§ä¸ºå¸ˆåŸåˆ™
**è§„åˆ™**: ä¿®å¤ UI æ—¶ï¼Œ**å¿…é¡»**å…ˆé˜…è¯» `_LEGACY_ARCHIVE_DO_NOT_TOUCH` ä¸­çš„æ—§æ–‡ä»¶ä½œä¸ºå‚è€ƒ

```typescript
// ä¿®å¤ UI å‰çš„å¼ºåˆ¶æµç¨‹ï¼š
// 1. å…ˆæŸ¥çœ‹æ—§ä»£ç å®ç°
// 2. ç†è§£åŸå§‹è®¾è®¡æ„å›¾
// 3. åœ¨æ–°æ¶æ„ä¸­å¤ç°åŠŸèƒ½

// ç¤ºä¾‹ï¼šä¿®å¤å­¦ç”Ÿåˆ—è¡¨é¡µé¢
// æ­¥éª¤1: æŸ¥çœ‹æ—§ä»£ç 
// æŸ¥çœ‹ _LEGACY_ARCHIVE_DO_NOT_TOUCH/student-list.html
// ç†è§£: æ©™è‰²ä¸»é¢˜ã€ç½‘æ ¼å¸ƒå±€ã€é•¿æŒ‰äº¤äº’

// æ­¥éª¤2: ç†è§£è®¾è®¡æ„å›¾
const legacyDesign = {
  theme: '#FF6B35',           // æ©™è‰²ä¸»é¢˜
  layout: 'grid',             // ç½‘æ ¼å¸ƒå±€
  columns: '3-4',            // 3-4åˆ—
  interaction: 'longPress'   // é•¿æŒ‰äº¤äº’
};

// æ­¥éª¤3: åœ¨æ–°æ¶æ„ä¸­å¤ç°
const StudentGrid: React.FC<StudentGridProps> = ({ students }) => {
  return (
    <div className="grid grid-cols-3 md:grid-cols-4 gap-4 p-4">
      {students.map(student => (
        <StudentCard
          key={student.id}
          student={student}
          themeColor="#FF6B35"           // ä¿æŒæ©™è‰²ä¸»é¢˜
          onLongPress={handleLongPress}   // å®ç°é•¿æŒ‰äº¤äº’
        />
      ))}
    </div>
  );
};
```

**å‚è€ƒç›®å½•ç»“æ„**:
```
_LEGACY_ARCHIVE_DO_NOT_TOUCH/
â”œâ”€â”€ student-list.html          # å­¦ç”Ÿåˆ—è¡¨åŸå§‹å®ç°
â”œâ”€â”€ habit-checkin.html         # ä¹ æƒ¯æ‰“å¡åŸå§‹äº¤äº’
â”œâ”€â”€ pk-battle.html            # PKå¯¹å†³åŸå§‹ç•Œé¢
â””â”€â”€ ui-components/            # UIç»„ä»¶åŸå§‹æ ·å¼
    â”œâ”€â”€ orange-theme.css
    â”œâ”€â”€ grid-layout.css
    â””â”€â”€ animations.css
```

### 4. ğŸ”¨ æ„å»ºä¼˜å…ˆåŸåˆ™
**è§„åˆ™**: ä»»ä½•å‰ç«¯ä¿®æ”¹åï¼Œå¿…é¡»è¿è¡Œ `cd client && npm run build` æ‰èƒ½è¿›è¡Œæµ‹è¯•

```bash
# å¼€å‘æµç¨‹è§„èŒƒ
# 1. ä¿®æ”¹ä»£ç 
vim client/src/components/StudentCard.tsx

# 2. æ„å»ºå‰ç«¯ (å¿…é¡»æ‰§è¡Œ)
cd client && npm run build

# 3. å¯åŠ¨æµ‹è¯•
cd .. && ./dev.sh

# 4. éªŒè¯åŠŸèƒ½
curl http://localhost:3000
```

**ä¸ºä»€ä¹ˆé‡è¦**:
- ç¡®ä¿ç”Ÿäº§ç¯å¢ƒæ„å»ºæ— é”™è¯¯
- åŠæ—¶å‘ç° TypeScript ç±»å‹é—®é¢˜
- éªŒè¯èµ„æºæ‰“åŒ…æ˜¯å¦æ­£ç¡®
- é¿å…"æœ¬åœ°æ­£å¸¸ï¼Œç”Ÿäº§å¼‚å¸¸"é—®é¢˜

**æ„å»ºæ£€æŸ¥æ¸…å•**:
```bash
# æ„å»ºå‰æ£€æŸ¥
npm run lint          # ESLint æ£€æŸ¥
npm run type-check    # TypeScript æ£€æŸ¥
npm run build         # ç”Ÿäº§æ„å»º
npm run test         # å•å…ƒæµ‹è¯• (å¦‚æœå­˜åœ¨)
```

### 5. ğŸ“ æ—¥å¿—è§„èŒƒåŸåˆ™
**è§„åˆ™**: åœ¨æœ€ç»ˆæ¸…ç†å‰ï¼Œä¿ç•™ `[FIX]` å‰ç¼€çš„è°ƒè¯•æ—¥å¿—

```typescript
// âœ… æ­£ç¡®çš„è°ƒè¯•æ—¥å¿—æ ¼å¼
const handleStudentAction = async (studentId: string, action: string) => {
  console.log('[FIX] handleStudentAction called', { studentId, action });

  try {
    console.log('[FIX] Calling API...');
    const result = await updateStudentAction(studentId, action);
    console.log('[FIX] API response:', result);

    if (result.success) {
      console.log('[FIX] Updating local state...');
      setStudents(prev => /* æ›´æ–°é€»è¾‘ */);
      console.log('[FIX] State updated successfully');
    }
  } catch (error) {
    console.log('[FIX] Error occurred:', error);
  }
};

// è°ƒè¯•å®Œæˆåï¼Œå¯ä»¥é€‰æ‹©æ€§æ¸…ç†
// ä½†åœ¨é—®é¢˜ç¡®è®¤è§£å†³å‰ï¼Œä¿ç•™å…³é”®è°ƒè¯•ä¿¡æ¯
```

**æ—¥å¿—åˆ†ç±»è§„èŒƒ**:
```typescript
// 1. åŠŸèƒ½è°ƒè¯•æ—¥å¿—
console.log('[FIX] Function entry - details');
console.log('[FIX] API call - endpoint and params');
console.log('[FIX] State change - before/after values');

// 2. é”™è¯¯è°ƒè¯•æ—¥å¿—
console.log('[FIX] Error caught - full error object');
console.log('[FIX] Fallback triggered - alternative path');

// 3. æ€§èƒ½è°ƒè¯•æ—¥å¿—
console.log('[FIX] Performance - operation duration');
```

## ğŸ”§ ä»£ç è´¨é‡æ ‡å‡†

### TypeScript ä¸¥æ ¼æ¨¡å¼
```typescript
// tsconfig.json ä¸¥æ ¼é…ç½®
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

### ESLint è§„èŒƒ
```typescript
// ç¦æ­¢æ¨¡å¼
'no-any': 'error',
'no-console': 'warn',        // è°ƒè¯•æ—¥å¿—å…è®¸ï¼Œä½†è¦æœ‰å‰ç¼€
'prefer-const': 'error',
'no-var': 'error'
```

### React Hooks è§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„ Hooks ä½¿ç”¨
const [students, setStudents] = useState<Student[]>([]);
const [loading, setLoading] = useState<boolean>(false);
const socket = useSocket(); // è‡ªå®šä¹‰ Hook

// âœ… è‡ªå®šä¹‰ Hook å‘½åè§„èŒƒ
const useStudentData = (schoolId: string) => {
  // Hook é€»è¾‘
};

const useSocketConnection = (url: string) => {
  // Socket è¿æ¥é€»è¾‘
};
```

## ğŸ¯ å¼€å‘æµç¨‹æ£€æŸ¥æ¸…å•

### ä¿®æ”¹å‰æ£€æŸ¥
- [ ] æ˜¯å¦å·²æŸ¥çœ‹ `_LEGACY_ARCHIVE_DO_NOT_TOUCH` ä¸­çš„å‚è€ƒå®ç°ï¼Ÿ
- [ ] æ˜¯å¦å·²å®šä¹‰å¿…è¦çš„ TypeScript æ¥å£ï¼Ÿ
- [ ] æ˜¯å¦ç†è§£ç›¸å…³ä¸šåŠ¡é€»è¾‘ï¼Ÿ

### ç¼–ç ä¸­æ£€æŸ¥
- [ ] æ˜¯å¦é¿å…äº† `window.location.reload()`ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†ç±»å‹å®‰å…¨çš„ä»£ç ï¼Ÿ
- [ ] æ˜¯å¦æ·»åŠ äº† `[FIX]` å‰ç¼€çš„è°ƒè¯•æ—¥å¿—ï¼Ÿ

### ä¿®æ”¹åæ£€æŸ¥
- [ ] æ˜¯å¦è¿è¡Œäº† `cd client && npm run build`ï¼Ÿ
- [ ] æ„å»ºæ˜¯å¦æ— é”™è¯¯ï¼Ÿ
- [ ] æ˜¯å¦è¿›è¡Œäº†åŠŸèƒ½æµ‹è¯•ï¼Ÿ

## ğŸš¨ è¿è§„åæœ

### ç¬¬ä¸€æ¬¡è¿è§„
- **è­¦å‘Šé€šçŸ¥**: æ˜ç¡®æŒ‡å‡ºè¿è§„ç‚¹
- **ä»£ç å®¡æŸ¥**: å¼ºåˆ¶è¿›è¡Œä»£ç å®¡æŸ¥
- **é‡æ–°å­¦ä¹ **: é‡æ–°é˜…è¯»ç›¸å…³è§„èŒƒæ–‡æ¡£

### ç¬¬äºŒæ¬¡è¿è§„
- **ä»£ç å›æ»š**: å¼ºåˆ¶å›æ»šè¿è§„ä»£ç 
- **æŒ‡å¯¼åŸ¹è®­**: ä¸€å¯¹ä¸€å¼€å‘è§„èŒƒåŸ¹è®­
- **ç›‘æ§æœŸ**: è®¾ç½®ä»£ç æäº¤ç›‘æ§æœŸ

### ä¸¥é‡è¿è§„
- **æš‚åœæƒé™**: æš‚åœä»£ç æäº¤æƒé™
- **é‡æ–°è€ƒæ ¸**: é‡æ–°è¿›è¡Œå¼€å‘è§„èŒƒè€ƒæ ¸
- **å›¢é˜Ÿé€šæŠ¥**: å›¢é˜Ÿå†…é€šæŠ¥æ‰¹è¯„

## ğŸ“š ç›¸å…³æ–‡æ¡£å‚è€ƒ

- **[æ¶æ„è§„èŒƒ](./ARCHITECTURE_V2.md)** - äº†è§£æ•´ä½“æ¶æ„è®¾è®¡
- **[é¡¹ç›®è®°å¿†åº“](./PROJECT_MEMORY.md)** - ç†è§£æŠ€æœ¯å†³ç­–èƒŒæ™¯
- **[å½“å‰çŠ¶æ€](./CURRENT_STATUS.md)** - æŸ¥çœ‹é¡¹ç›®å¥åº·çŠ¶å†µ
- **[æŠ€æœ¯ç™½çš®ä¹¦](../ArkOK_V2_Technical_Whitepaper.md)** - äº†è§£å®Œæ•´æŠ€æœ¯ä½“ç³»

## 6. ä¼šè¯å®‰å…¨ä¸è¿›åº¦è¿½è¸ª (Session Safety)
- **åŸå­åŒ–å­˜æ¡£**: åœ¨æ‰§è¡Œå¤šæ­¥éª¤çš„å¤§å‹ä»»åŠ¡ï¼ˆå¦‚æ‰¹é‡ä¿®å¤å¤šä¸ªé¡µé¢ï¼‰æ—¶ï¼Œæ¯å®Œæˆä¸€ä¸ªå­ä»»åŠ¡ï¼Œå¿…é¡»ç«‹å³æ›´æ–° `docs/TASK_PROGRESS.md`ã€‚
- **å…³æœºå‰æ£€æŸ¥**: åœ¨è¢«å‘ŠçŸ¥"å³å°†é‡å¯"æˆ–ä»»åŠ¡ä¸­æ–­å‰ï¼Œå¿…é¡»è¾“å‡ºå½“å‰çš„è¿›åº¦çŠ¶æ€ã€‚
- **å¯åŠ¨åè‡ªæ£€**: æ¯æ¬¡æ–°ä¼šè¯å¼€å§‹ï¼Œå¿…é¡»é¦–å…ˆè¯»å– `docs/TASK_PROGRESS.md`ï¼Œç¡®è®¤ä¸Šä¸€æ¬¡æ˜¯åœ¨å“ªé‡Œåœä¸‹çš„ã€‚

```typescript
// âœ… æ­£ç¡®çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å¼
const complexTaskFlow = async () => {
  // ä»»åŠ¡å‰ï¼šè¯»å–è¿›åº¦
  const progress = readTaskProgress();
  console.log('[FIX] ä¸Šæ¬¡ä»»åŠ¡åœåœ¨:', progress.lastCompletedTask);

  // ä»»åŠ¡ä¸­ï¼šæ¯å®Œæˆä¸€ä¸ªå­ä»»åŠ¡å°±æ›´æ–°
  await completeSubTask1();
  updateTaskProgress({
    lastCompletedTask: 'subtask1',
    nextTask: 'subtask2',
    timestamp: new Date()
  });

  // ä»»åŠ¡ä¸­æ–­å‰ï¼šè¾“å‡ºçŠ¶æ€
  if (isInterruptionDetected()) {
    console.log('[FIX] å½“å‰è¿›åº¦çŠ¶æ€:', {
      completed: ['subtask1'],
      inProgress: 'subtask2',
      remaining: ['subtask3', 'subtask4']
    });
  }
};
```

**ä¸­æ–­æ¢å¤æµç¨‹**:
```bash
# æ–°ä¼šè¯å¼€å§‹æ—¶çš„å¼ºåˆ¶æ£€æŸ¥æµç¨‹
# 1. è¯»å–ä»»åŠ¡è¿›åº¦
cat docs/TASK_PROGRESS.md

# 2. ç¡®è®¤ä¸Šæ¬¡ä¸­æ–­ç‚¹
# 3. å‡†å¤‡ä»æ–­ç‚¹ç»§ç»­
# 4. æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º"ç»§ç»­ä¸­"
```

## 7. é‡å¯å‰å¼ºåˆ¶å­˜æ¡£ (Pre-Restart Snapshot) - CRITICAL
- **è§¦å‘æ¡ä»¶**: åœ¨æ‰§è¡Œ `npm run build`ã€`./dev.sh` æˆ–ä»»ä½•æ¶‰åŠ `restart` çš„å‘½ä»¤**ä¹‹å‰**ã€‚
- **å¼ºåˆ¶åŠ¨ä½œ**:
  1. å¿…é¡»å…ˆæ›´æ–° `docs/CURRENT_STATUS.md`ï¼Œè®°å½•å½“å‰å·²å®Œæˆçš„ä»£ç ä¿®æ”¹ã€‚
  2. å¿…é¡»æ›´æ–° `docs/TASK_PROGRESS.md`ï¼Œå‹¾é€‰åˆšå®Œæˆçš„æ­¥éª¤ã€‚
  3. **åªæœ‰åœ¨æ–‡æ¡£æ›´æ–°å®Œæ¯•å**ï¼Œæ‰å…è®¸æ‰§è¡Œæ„å»ºæˆ–é‡å¯å‘½ä»¤ã€‚
- **ç›®çš„**: å³ä½¿æ„å»ºå¯¼è‡´å†…å­˜æº¢å‡º(OOM)æˆ–ä¼šè¯æ–­å¼€ï¼Œä¸‹ä¸€æ¬¡å¯åŠ¨æ—¶ä¹Ÿèƒ½é€šè¿‡è¯»å–æ–‡æ¡£æ— ç¼æ¢å¤ã€‚

**å¼ºåˆ¶æ‰§è¡Œæµç¨‹**:
```bash
# ğŸ›‘ åœ¨æ‰§è¡Œä»¥ä¸‹ä»»ä½•å‘½ä»¤å‰ï¼Œå¿…é¡»å…ˆå®Œæˆå­˜æ¡£ï¼š
# - npm run build
# - ./dev.sh
# - docker-compose restart
# - ä»»ä½•åŒ…å« "restart" çš„å‘½ä»¤

# 1. ç«‹å³åœæ­¢å½“å‰æ“ä½œ
echo "ğŸ›¡ï¸ æ£€æµ‹åˆ°é‡å¯æ“ä½œï¼Œæ‰§è¡Œå¼ºåˆ¶å­˜æ¡£æµç¨‹..."

# 2. æ›´æ–°å½“å‰çŠ¶æ€æ–‡æ¡£
echo "$(date '+%Y-%m-%d %H:%M:%S') - é‡å¯å‰å­˜æ¡£: æ­£åœ¨æ‰§è¡Œæ„å»º/é‡å¯æ“ä½œ" >> docs/CURRENT_STATUS.md
echo "æœ€è¿‘å®Œæˆçš„ä¿®æ”¹: [ç®€è¿°åˆšæ‰å®Œæˆçš„å·¥ä½œ]" >> docs/CURRENT_STATUS.md
echo "å½“å‰æ–‡ä»¶çŠ¶æ€: [å¦‚æœ‰éœ€è¦ï¼Œåˆ—å‡ºä¿®æ”¹çš„æ–‡ä»¶]" >> docs/CURRENT_STATUS.md

# 3. æ›´æ–°ä»»åŠ¡è¿›åº¦æ–‡æ¡£
# åœ¨ TASK_PROGRESS.md ä¸­æ‰¾åˆ°å½“å‰ä»»åŠ¡ï¼Œæ ‡è®°ä¸º [x] æˆ–æ›´æ–°è¿›åº¦çŠ¶æ€
# æ·»åŠ å¤‡æ³¨: "$(date '+%Y-%m-%d %H:%M:%S') - é‡å¯å‰å­˜æ¡£ç¡®è®¤"

# 4. éªŒè¯æ–‡æ¡£å·²æ›´æ–°
echo "âœ… æ–‡æ¡£å­˜æ¡£å®Œæˆï¼Œå¯ä»¥å®‰å…¨æ‰§è¡Œé‡å¯æ“ä½œ"
```

**å­˜æ¡£å†…å®¹æ£€æŸ¥æ¸…å•**:
```bash
# ç¡®ä¿ä»¥ä¸‹ä¿¡æ¯å·²è®°å½•ï¼š

# CURRENT_STATUS.md ä¸­åº”åŒ…å«ï¼š
- [ ] æœ€è¿‘çš„ä»£ç ä¿®æ”¹æè¿°
- [ ] ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨
- [ ] é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- [ ] ä¸‹æ¬¡ç»­æ¥æ—¶éœ€è¦æ³¨æ„çš„äº‹é¡¹

# TASK_PROGRESS.md ä¸­åº”åŒ…å«ï¼š
- [ ] åˆšå®Œæˆçš„ä»»åŠ¡å·²æ ‡è®° [x]
- [ ] è¿›è¡Œä¸­çš„ä»»åŠ¡å·²æ ‡è®° [-]
- [ ] æ˜ç¡®çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨æŒ‡ç¤º
- [ ] æ—¶é—´æˆ³å’ŒçŠ¶æ€è¯´æ˜
```

**å®‰å…¨æ£€æŸ¥éªŒè¯**:
```bash
# æ‰§è¡Œé‡å¯å‰çš„æœ€åéªŒè¯è„šæœ¬
echo "ğŸ” æ‰§è¡Œé‡å¯å‰å®‰å…¨æ£€æŸ¥..."

# æ£€æŸ¥æ–‡æ¡£æ˜¯å¦å­˜åœ¨æœ€æ–°æ›´æ–°
if [[ -z "$(find docs/ -name "*.md" -mmin -5)" ]]; then
  echo "âŒ é”™è¯¯: æ£€æµ‹åˆ°æ–‡æ¡£è¶…è¿‡5åˆ†é’Ÿæœªæ›´æ–°!"
  echo "è¯·å…ˆæ›´æ–° docs/CURRENT_STATUS.md å’Œ docs/TASK_PROGRESS.md"
  exit 1
fi

echo "âœ… æ–‡æ¡£æ›´æ–°æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥å®‰å…¨æ‰§è¡Œé‡å¯"
```

**è¿è§„å¤„ç†**:
- **ç¬¬ä¸€æ¬¡è¿è§„**: å¼ºåˆ¶å›æ»šåˆ°ä¸Šä¸€ä¸ªå·¥ä½œçŠ¶æ€ï¼Œé‡æ–°æ‰§è¡Œå­˜æ¡£æµç¨‹
- **ç¬¬äºŒæ¬¡è¿è§„**: æš‚åœæ„å»ºæƒé™ï¼Œéœ€è¦é¡¹ç›®è´Ÿè´£äººæˆæƒæ‰èƒ½ç»§ç»­
- **ä¸¥é‡åæœ**: å¦‚æœå› æœªå­˜æ¡£å¯¼è‡´çš„å·¥ä½œä¸¢å¤±ï¼Œè¿è§„è€…æ‰¿æ‹…æ¢å¤è´£ä»»

**ä¸ºä»€ä¹ˆè¿™æ¡è§„åˆ™è‡³å…³é‡è¦**:
1. **é˜²æ­¢å·¥ä½œä¸¢å¤±**: æ„å»ºè¿‡ç¨‹å¯èƒ½å¯¼è‡´OOMæˆ–ä¼šè¯æ–­å¼€
2. **ä¿è¯è¿ç»­æ€§**: ç¡®ä¿ä¸‹æ¬¡å¯åŠ¨æ—¶èƒ½å¿«é€Ÿæ¢å¤å·¥ä½œçŠ¶æ€
3. **å›¢é˜Ÿåä½œ**: è®©å…¶ä»–å›¢é˜Ÿæˆå‘˜èƒ½äº†è§£å½“å‰è¿›åº¦
4. **é£é™©æ§åˆ¶**: é™ä½å› æŠ€æœ¯é—®é¢˜å¯¼è‡´çš„è¿›åº¦å»¶è¯¯

**ç´§æ€¥æƒ…å†µå¤„ç†**:
```bash
# å¦‚æœç³»ç»Ÿå³å°†å´©æºƒï¼Œæ‰§è¡Œæœ€å°åŒ–å­˜æ¡£
echo "ğŸš¨ ç´§æ€¥å­˜æ¡£ - $(date)" >> docs/SESSION_STATUS_LOG.md
echo "å½“å‰ä»»åŠ¡: [ç®€è¿°]" >> docs/SESSION_STATUS_LOG.md
echo "è¿›åº¦: [ç™¾åˆ†æ¯”æˆ–çŠ¶æ€]" >> docs/SESSION_STATUS_LOG.md
echo "ä¸‹æ¬¡ç»­æ¥: [å…³é”®ç‚¹]" >> docs/SESSION_STATUS_LOG.md
```

---

**âš ï¸ é‡è¦æé†’**: è¿™äº›å¼€å‘è¡Œä¸ºå‡†åˆ™æ˜¯ä¿è¯ ArkOK V2 ä»£ç è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§çš„åŸºçŸ³ï¼Œè¯·æ‰€æœ‰å¼€å‘äººå‘˜ä¸¥æ ¼éµå®ˆï¼**

**æœ€åæ›´æ–°**: 2025-12-13
**æ‰§è¡Œè´Ÿè´£äºº**: æŠ€æœ¯è´Ÿè´£äºº & æ¶æ„å¸ˆ