# ğŸ“˜ ArkOK V2 æ™ºæ…§æ•™è‚² SaaS å¹³å°ï¼šæ¶æ„ç™½çš®ä¹¦ & å®æ–½è·¯çº¿å›¾

**ç‰ˆæœ¬:** 1.0
**æœ€åæ›´æ–°:** 2025-12-12
**çŠ¶æ€:** ç¬¬ä¸€é˜¶æ®µï¼ˆåœ°åŸºå·¥ç¨‹ï¼‰å·²å®Œæˆï¼Œå³å°†è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼ˆä¸»ä½“ç»“æ„æ–½å·¥ï¼‰

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šé¡¹ç›®æ€»è§ˆä¸é¡¶å±‚è®¾è®¡

### 1.1 é¡¹ç›®æ„¿æ™¯

å°†ç°æœ‰çš„ ArkOK åº”ç”¨ï¼ˆV1ï¼‰é‡æ„ä¸ºä¸€ä¸ªç°ä»£åŒ–ã€é«˜å¯ç”¨ã€å¯æ‰©å±•çš„æ™ºæ…§æ•™è‚² SaaS å¹³å° (ArkOK V2)ã€‚è¯¥å¹³å°åœ¨è®¾è®¡ä¹‹åˆå³ä»¥æ”¯æ’‘ **1000+ æ ¡åŒº** å¹¶å‘ä½¿ç”¨ä¸ºç›®æ ‡ï¼ŒåŒæ—¶æä¾›å“è¶Šçš„ç”¨æˆ·ä½“éªŒå’Œå®æ—¶çš„æ•°æ®äº¤äº’èƒ½åŠ›ã€‚

### 1.2 æ ¸å¿ƒè®¾è®¡å“²å­¦

#### å¤šç§Ÿæˆ·åŸç”Ÿ (SaaS Native)
ç¡®ä¿ä¸åŒæ ¡åŒºï¼ˆç§Ÿæˆ·ï¼‰ä¹‹é—´çš„æ•°æ®é€šè¿‡ `schoolId` åœ¨æ•°æ®åº“å±‚é¢ä¸¥æ ¼éš”ç¦»ï¼Œä¸ºå•†ä¸šåŒ–è¿è¥å¥ å®šåŸºç¡€ã€‚

#### åŒæ ¸é©±åŠ¨æ¶æ„ (Dual-Core Engine)
- **Node.js ä¸»æœåŠ¡:** å¤„ç†é«˜å¹¶å‘ä¸šåŠ¡é€»è¾‘ï¼ˆAPIï¼‰ã€æ•°æ®åº“äº¤äº’ï¼ˆPrismaï¼‰å’Œå®æ—¶æ¶ˆæ¯æ¨é€ï¼ˆSocket.ioï¼‰ã€‚
- **Python AI æœåŠ¡:** ä½œä¸ºç‹¬ç«‹æ¨¡å—ï¼Œè´Ÿè´£ OCRã€é”™é¢˜åˆ†æç­‰è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œé€šè¿‡å†…éƒ¨ API ä¸ä¸»æœåŠ¡é€šä¿¡ï¼Œé¿å…é˜»å¡ã€‚

#### UI/UX ç­–ç•¥ (åŒè½¨å¹¶è¡Œ)
- **æ‰‹æœºç«¯ (Teacher's Cockpit):** ä¸¥æ ¼ä¿ç•™å¹¶å¤ç”¨ V1 ç‰ˆæœ¬å·²æœ‰çš„ UI å¸ƒå±€å’Œäº¤äº’ä¹ æƒ¯ã€‚è¿™å°Šé‡äº†ç”¨æˆ·çš„è‚Œè‚‰è®°å¿†ï¼Œä»…åœ¨åº•å±‚æ›¿æ¢ä¸ºå…¨æ–°çš„ã€é«˜æ€§èƒ½çš„æ•°æ®æ¥å£ã€‚
- **å¤§å±ç«¯ (Commander's Display):** é‡‡ç”¨å…¨æ–°çš„ "æ˜Ÿé™…æŒ‡æŒ¥å®˜" (Cyberpunk / Starship) é£æ ¼ï¼Œæ³¨é‡è§†è§‰å†²å‡»åŠ›ã€æ•°æ®å¯è§†åŒ–å’Œå®æ—¶åŠ¨ç”»æ•ˆæœï¼Œä¸ºçº¿ä¸‹æ•™å­¦åœºæ™¯æä¾›éœ‡æ’¼çš„å±•ç¤ºä½“éªŒã€‚

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šæŠ€æœ¯æ ˆä¸æ¶æ„å›¾

### 2.1 æŠ€æœ¯æ ˆ (Tech Stack)

| é¢†åŸŸ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|----------|------|
| **å‰ç«¯ (Client)** | React 18 + Vite + TypeScript | ä¸šç•Œæ ‡å‡†ï¼Œå¼€å‘æ•ˆç‡ä¸æ€§èƒ½å…¼å¤‡ã€‚ |
| **æ ·å¼æ–¹æ¡ˆ** | Tailwind CSS | åŸå­åŒ– CSSï¼Œç¡®ä¿ UI ä¸€è‡´æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚ |
| **åŠ¨ç”»å¼•æ“** | Framer Motion | ä¸“ä¸º React è®¾è®¡ï¼Œè½»æ¾å®ç°å¤æ‚ã€æµç•…çš„åŠ¨ç”»ã€‚ |
| **åç«¯ API (Server)** | Node.js + Express + TypeScript | äº‹ä»¶é©±åŠ¨çš„éé˜»å¡ I/Oï¼Œå®Œç¾å¥‘åˆå®æ—¶åº”ç”¨åœºæ™¯ã€‚ |
| **å®æ—¶é€šè®¯** | Socket.io (+ Redis Adapter for scaling) | æˆç†Ÿçš„ WebSocket åº“ï¼Œæ”¯æŒæŒ‰æˆ¿é—´ï¼ˆæ ¡åŒºï¼‰å¹¿æ’­ã€‚ |
| **AI å¼•æ“** | Python + FastAPI (é¢„ç•™) | å¼ºå¤§çš„ AI ç”Ÿæ€ï¼Œé€šè¿‡ RESTful API æä¾›æœåŠ¡ã€‚ |
| **æ•°æ®åº“ ORM** | Prisma | å¼ºç±»å‹å®‰å…¨ï¼Œè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢ï¼Œæå¤§æå‡å¼€å‘æ•ˆç‡ã€‚ |
| **æ•°æ®åº“** | PostgreSQL | åŠŸèƒ½å¼ºå¤§ï¼Œç¨³å®šå¯é ï¼Œæ”¯æŒå¤æ‚çš„ JSONB æ•°æ®ç±»å‹ã€‚ |
| **éƒ¨ç½²ç¯å¢ƒ** | Sealos (Kubernetes) | ä¸€ç«™å¼äº‘æ“ä½œç³»ç»Ÿï¼Œç®€åŒ–éƒ¨ç½²ï¼Œæ”¯æŒå¼¹æ€§ä¼¸ç¼©ã€‚ |

### 2.2 ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TD
    subgraph "User Devices"
        Mobile[ğŸ“± è€å¸ˆæ‰‹æœºç«¯]
        BigScreen[ğŸ–¥ï¸ ç­çº§å¤§å±]
    end

    subgraph "Sealos Cloud Platform"
        Ingress[ğŸŒ å…¬ç½‘ Ingress]

        subgraph "Application Services (arkok-v2)"
            Proxy[ğŸš¦ æ™ºèƒ½ä»£ç† (Node.js on Port 8000)]
            Frontend[ğŸ¨ å‰ç«¯æœåŠ¡ (Vite on Port 5173)]
            Backend[ğŸš€ åç«¯ä¸»æœåŠ¡ (Node.js on Port 3000)]
            AI_Worker[ğŸ§  AI æœåŠ¡ (Python on Port 8001, placeholder)]
        end

        subgraph "Data & Messaging Layer"
            Database[(ğŸ˜ PostgreSQL)]
            Messaging[(ğŸ“¡ Redis)]
        end
    end

    Mobile -- HTTPS --> Ingress
    BigScreen -- WSS --> Ingress

    Ingress -- "/ (root)" --> Proxy
    Ingress -- "/api/*" --> Proxy
    Ingress -- "/socket.io/*" --> Proxy

    Proxy -- "UI Requests" --> Frontend
    Proxy -- "/api/*" --> Backend
    Proxy -- "/socket.io/* (WebSocket)" --> Backend

    Backend <--> Database
    Backend <--> Messaging
    Backend -- "AI Task" --> AI_Worker
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå½“å‰å®æ–½è¿›åº¦ (æˆªè‡³ 2025-12-12)

**çŠ¶æ€:** âœ… ç¬¬ä¸€é˜¶æ®µ (åœ°åŸºå·¥ç¨‹) å·²åœ†æ»¡å®Œæˆã€‚

### é¡¹ç›®åˆå§‹åŒ–ä¸ç¯å¢ƒéš”ç¦»
- âœ… **å·²å®Œæˆ:** åœ¨ `/home/devbox/project/` ç›®å½•ä¸‹åˆ›å»ºäº†å…¨æ–°çš„ `arkok-v2` é¡¹ç›®ã€‚
- âœ… **å·²å®Œæˆ:** æ‰€æœ‰ V1 ç‰ˆæœ¬çš„æ—§ä»£ç ï¼ˆåŒ…æ‹¬ `å¿«é€Ÿéƒ¨ç½².sh`ï¼‰å‡å·²å®‰å…¨å½’æ¡£è‡³ `_LEGACY_ARCHIVE_DO_NOT_TOUCH` ç›®å½•ï¼Œå½»åº•è§£å†³äº† AI ä¸Šä¸‹æ–‡æ±¡æŸ“é—®é¢˜ã€‚
- âœ… **å·²å®Œæˆ:** `server`, `client`, `ai-worker` ä¸‰å¤§æ¨¡å—çš„ç›®å½•ç»“æ„å’Œ `package.json` å·²åˆ›å»ºï¼Œæ‰€æœ‰æ ¸å¿ƒä¾èµ–å·²å®‰è£…ã€‚

### æ•°æ®åº“è®¾è®¡ä¸æ•°æ®è¿ç§»
- âœ… **å·²å®Œæˆ:** ä½¿ç”¨ Prisma åœ¨ `server/prisma/schema.prisma` ä¸­å®šä¹‰äº†æ”¯æŒå¤šç§Ÿæˆ·çš„å…¨æ–°æ•°æ®æ¨¡å‹ï¼Œæ¶µç›– `School`, `User`, `Student`, `TaskRecord` ç­‰æ ¸å¿ƒå®ä½“ã€‚
- âœ… **å·²å®Œæˆ:** å·²æˆåŠŸæ‰§è¡Œ `server/prisma/migrate_legacy.ts` è„šæœ¬ï¼Œå°†æ—§ `students` è¡¨ä¸­çš„**å§“åã€ç­çº§ã€ç§¯åˆ†(score)ã€ç»éªŒ(total_exp)**ç­‰æ•°æ®æ— æŸè¿ç§»è‡³æ–°æ¶æ„ï¼Œå¹¶ç»Ÿä¸€å½’å±åˆ° "Default Migration School"ã€‚æ•°æ®å·²å®‰å…¨è½åœ°ã€‚

### ç½‘ç»œé…ç½®ä¸æœåŠ¡å¯åŠ¨
- âœ… **å·²å®Œæˆ:** è§£å†³äº† Sealos Devbox ç¯å¢ƒå› ç¼ºå°‘ `kubectl` æƒé™è€Œæ— æ³•ä¿®æ”¹ Ingress çš„é—®é¢˜ã€‚Claude Code åˆ›æ–°æ€§åœ°å®æ–½äº† **"Plan C - è‡ªå»ºåå‘ä»£ç†"** æ–¹æ¡ˆã€‚
- âœ… **å·²å®Œæˆ:** åˆ›å»ºäº† `proxy-server.js` è¿è¡Œåœ¨ 8000 ç«¯å£ï¼Œä½œä¸ºæ™ºèƒ½æµé‡åˆ†å‘ä¸­å¿ƒï¼Œå¹¶å°† Sealos Ingress æŒ‡å‘å®ƒã€‚
- âœ… **å·²å®Œæˆ:** è§£å†³äº† Tailwind CSS çš„ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ã€‚
- âœ… **å·²å®Œæˆ:** é…ç½®äº† `dev.sh` ä¸€é”®å¯åŠ¨è„šæœ¬ï¼Œæ”¯æŒå‰åç«¯çƒ­é‡è½½ã€‚

**å½“å‰çŠ¶æ€:** è¿è¡Œ `./dev.sh` åï¼Œåº”ç”¨å·²æˆåŠŸä¸Šçº¿ï¼Œå¯é€šè¿‡å…¬ç½‘åŸŸå `https://esboimzbkure.sealosbja.site` è®¿é—®ï¼Œä½†æ˜¾ç¤ºçš„æ˜¯ Vite é»˜è®¤é¡µé¢ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æœªç§»æ¤ UIã€‚

---

## ç¬¬å››éƒ¨åˆ†ï¼šæ ¸å¿ƒæ¨¡å—è¯¦è§£

### 4.1 æ•°æ®åº“è®¾è®¡ (Prisma Schema)

```prisma
// server/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model School {
  id          String   @id @default(cuid())
  name        String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  users       User[]
  students    Student[]
  taskRecords TaskRecord[]

  @@map("schools")
}

model User {
  id        String   @id @default(cuid())
  schoolId  String
  username  String   @unique
  email     String?  @unique
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  school    School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@map("users")
}

model Student {
  id          String   @id @default(cuid())
  schoolId    String
  name        String
  classRoom   String
  avatar      String?
  score       Int      @default(0)
  totalExp    Int      @default(0)
  level       Int      @default(1)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  school      School       @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  taskRecords TaskRecord[]

  @@map("students")
}

model TaskRecord {
  id          String     @id @default(cuid())
  schoolId    String
  studentId   String
  taskType    TaskType
    description String?
  score       Int?
  exp         Int?
  metadata    Json?
  createdAt   DateTime   @default(now())

  school      School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@map("task_records")
}

enum UserRole {
  ADMIN
  USER
}

enum TaskType {
  HOMEWORK
  EXAM
  PARTICIPATION
  BONUS
}
```

### 4.1 API å“åº”å¤„ç†æ ‡å‡† (å¼ºåˆ¶è§„èŒƒ)

**åŸåˆ™**: æœç» `as any`ï¼Œå®ç°ç±»å‹å®‰å…¨çš„ API å“åº”å¤„ç†

#### 4.1.1 æ ‡å‡†å“åº”æ¥å£
æ‰€æœ‰ API å“åº”å¿…é¡»ä½¿ç”¨ç»Ÿä¸€çš„ `ApiResponse<T>` æ¥å£ï¼š

```typescript
// æ ‡å‡†APIå“åº”æ¥å£ - å…¨å±€ç»Ÿä¸€
export interface ApiResponse<T = any> {
  success: boolean;           // è¯·æ±‚æ˜¯å¦æˆåŠŸ
  message?: string;           // å¯é€‰çš„é”™è¯¯æˆ–æˆåŠŸæ¶ˆæ¯
  data: T;                    // å®é™…æ•°æ®è½½è·ï¼Œç±»å‹å®‰å…¨
  token?: string;             // è®¤è¯å“åº”ä¸­çš„JWTä»¤ç‰Œ
  user?: any;                 // è®¤è¯å“åº”ä¸­çš„ç”¨æˆ·ä¿¡æ¯
}

// åˆ†é¡µå“åº”æ¥å£
export interface PaginatedResponse<T> {
  success: boolean;
  data: T[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
  };
}

// é”™è¯¯å“åº”æ¥å£
export interface ErrorResponse {
  success: false;
  error: {
    code: string;
    message: string;
    details?: any[];
  };
}
```

#### 4.1.2 å¼ºåˆ¶è§„å®š
- **ç¦æ­¢**: ä½¿ç”¨ `as any` æˆ– `unknown` ç±»å‹å¤„ç† API å“åº”
- **å¿…é¡»**: æ‰€æœ‰ API è°ƒç”¨éƒ½æœ‰æ˜ç¡®çš„ç±»å‹å®šä¹‰
- **å¿…é¡»**: ä½¿ç”¨ç±»å‹å®ˆå« (type guards) è¿›è¡Œå®‰å…¨çš„æ•°æ®æå–

#### 4.1.3 ä½¿ç”¨ç¤ºä¾‹
```typescript
// âœ… æ­£ç¡®å®è·µ - ç±»å‹å®‰å…¨
interface StudentsResponse {
  students: Student[];
  total: number;
}

const response = await apiService.get<StudentsResponse>('/students');
if (response.success) {
  const students = response.data.students; // ç±»å‹å®‰å…¨
}

// âŒ é”™è¯¯å®è·µ - ç¦æ­¢ä½¿ç”¨
const response = await apiService.get('/students') as any;
const students = response.data.students; // å±é™©çš„æ–­è¨€
```

### 4.2 API è®¾è®¡è§„èŒƒ

æ‰€æœ‰ API ç«¯ç‚¹éƒ½éµå¾ª `/api/v1/{schoolId}/{resource}` çš„å‘½åè§„èŒƒï¼Œç¡®ä¿ç§Ÿæˆ·éš”ç¦»ã€‚

#### æ ¸å¿ƒç«¯ç‚¹ç¤ºä¾‹ï¼š

```typescript
// å­¦ç”Ÿç®¡ç†
GET    /api/v1/{schoolId}/students          // è·å–å­¦ç”Ÿåˆ—è¡¨
POST   /api/v1/{schoolId}/students          // åˆ›å»ºæ–°å­¦ç”Ÿ
GET    /api/v1/{schoolId}/students/{id}     // è·å–å•ä¸ªå­¦ç”Ÿ
PUT    /api/v1/{schoolId}/students/{id}     // æ›´æ–°å­¦ç”Ÿä¿¡æ¯
DELETE /api/v1/{schoolId}/students/{id}     // åˆ é™¤å­¦ç”Ÿ

// ä»»åŠ¡è®°å½•
GET    /api/v1/{schoolId}/task-records      // è·å–ä»»åŠ¡è®°å½•
POST   /api/v1/{schoolId}/task-records      // åˆ›å»ºä»»åŠ¡è®°å½•
GET    /api/v1/{schoolId}/task-records/{id} // è·å–å•ä¸ªä»»åŠ¡è®°å½•

// ç»Ÿè®¡æ•°æ®
GET    /api/v1/{schoolId}/stats/overview   // è·å–æ¦‚è§ˆç»Ÿè®¡
GET    /api/v1/{schoolId}/stats/leaderboard // æ’è¡Œæ¦œ
```

### 4.3 Socket.io æˆ¿é—´ç­–ç•¥

```typescript
// æ¯ä¸ªæ ¡åŒºä½œä¸ºç‹¬ç«‹çš„æˆ¿é—´
const schoolRoom = `school:${schoolId}`;

// æ•™å¸ˆåŠ å…¥æ ¡åŒºæˆ¿é—´
socket.join(schoolRoom);

// å‘ç‰¹å®šæ ¡åŒºå¹¿æ’­æ•°æ®æ›´æ–°
io.to(schoolRoom).emit('student-updated', updatedStudent);
io.to(schoolRoom).emit('task-completed', taskRecord);
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šå¼€å‘è§„èŒƒä¸æœ€ä½³å®è·µ

### 5.1 ç›®å½•ç»“æ„è§„èŒƒ

```
arkok-v2/
â”œâ”€â”€ server/                 # Node.js åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/        # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ services/      # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ middleware/    # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ types/         # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ prisma/           # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ schema.prisma
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ client/               # React å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/   # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/        # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/        # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ services/     # API è°ƒç”¨
â”‚   â”‚   â””â”€â”€ types/        # TypeScript ç±»å‹
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ ai-worker/            # Python AI æœåŠ¡ (é¢„ç•™)
â”œâ”€â”€ docs/                 # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ dev.sh               # å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬
```

### 5.2 ç¼–ç è§„èŒƒ

#### TypeScript
- ä½¿ç”¨ä¸¥æ ¼çš„ TypeScript é…ç½® (`strict: true`)
- æ‰€æœ‰ API å“åº”å¿…é¡»å®šä¹‰æ¥å£ç±»å‹
- é¿å…ä½¿ç”¨ `any` ç±»å‹ï¼Œä¼˜å…ˆä½¿ç”¨ `unknown` æˆ–å…·ä½“ç±»å‹

#### React ç»„ä»¶
- ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ + Hooks
- éµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œæ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹
- ä½¿ç”¨ `memo` ä¼˜åŒ–æ€§èƒ½ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

#### API è®¾è®¡
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ ¼å¼
- ä½¿ç”¨ HTTP çŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚çŠ¶æ€
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢ (page, limit)

### 5.3 Git å·¥ä½œæµ

```
main (ç”Ÿäº§åˆ†æ”¯)
â”œâ”€â”€ develop (å¼€å‘åˆ†æ”¯)
â”‚   â”œâ”€â”€ feature/school-management
â”‚   â”œâ”€â”€ feature/student-crud
â”‚   â””â”€â”€ feature/real-time-sync
â””â”€â”€ hotfix/critical-bug-fix
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šéƒ¨ç½²ä¸è¿ç»´

### 6.1 Sealos éƒ¨ç½²é…ç½®

```yaml
# sealos.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: arkok-v2
spec:
  replicas: 2
  selector:
    matchLabels:
      app: arkok-v2
  template:
    metadata:
      labels:
        app: arkok-v2
    spec:
      containers:
      - name: arkok-v2
        image: arkok-v2:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: arkok-secrets
              key: database-url
```

### 6.2 ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env.production
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://...
REDIS_URL=redis://...
JWT_SECRET=your-jwt-secret
CORS_ORIGIN=https://your-domain.com
```

### 6.3 ç›‘æ§ä¸æ—¥å¿—

- **åº”ç”¨ç›‘æ§:** ä½¿ç”¨ PM2 è¿›è¡Œè¿›ç¨‹ç®¡ç†
- **æ€§èƒ½ç›‘æ§:** é›†æˆ APM å·¥å…· (å¦‚ New Relic æˆ– DataDog)
- **æ—¥å¿—èšåˆ:** ä½¿ç”¨ Winston + Elasticsearch
- **é”™è¯¯è¿½è¸ª:** é›†æˆ Sentry

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šå®‰å…¨ç­–ç•¥

### 7.1 èº«ä»½è®¤è¯ä¸æˆæƒ

```typescript
// JWT è®¤è¯ä¸­é—´ä»¶
const authenticateToken = (req: Request, res: Response, next: NextFunction) => {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return res.status(401).json({ error: 'Access token required' });
  }

  jwt.verify(token, process.env.JWT_SECRET!, (err, user) => {
    if (err) return res.status(403).json({ error: 'Invalid token' });
    req.user = user;
    next();
  });
};
```

### 7.2 æ•°æ®å®‰å…¨

- æ‰€æœ‰æ•æ„Ÿæ•°æ®ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- API è¯·æ±‚é€Ÿç‡é™åˆ¶ (Rate Limiting)
- SQL æ³¨å…¥é˜²æŠ¤ (ä½¿ç”¨ Prisma ORM)
- XSS é˜²æŠ¤ (è¾“å…¥éªŒè¯å’Œè¾“å‡ºç¼–ç )
- CSRF é˜²æŠ¤ (ä½¿ç”¨ CSRF token)

### 7.3 ç½‘ç»œå®‰å…¨

- å¼ºåˆ¶ä½¿ç”¨ HTTPS
- è®¾ç½®å®‰å…¨çš„ CORS ç­–ç•¥
- ä½¿ç”¨ Helmet.js è®¾ç½®å®‰å…¨å¤´éƒ¨
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…ï¼Œä¿®å¤å®‰å…¨æ¼æ´

---

## ç¬¬å…«éƒ¨åˆ†ï¼šæ€§èƒ½ä¼˜åŒ–

### 8.1 æ•°æ®åº“ä¼˜åŒ–

```sql
-- åˆ›å»ºå¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
CREATE INDEX idx_students_school_class ON students(school_id, class_room);
CREATE INDEX idx_task_records_school_student ON task_records(school_id, student_id);
CREATE INDEX idx_task_records_created_at ON task_records(created_at DESC);
```

### 8.2 ç¼“å­˜ç­–ç•¥

```typescript
// Redis ç¼“å­˜ç¤ºä¾‹
const getCachedData = async (key: string) => {
  const cached = await redis.get(key);
  if (cached) {
    return JSON.parse(cached);
  }
  return null;
};

const setCachedData = async (key: string, data: any, ttl = 3600) => {
  await redis.setex(key, ttl, JSON.stringify(data));
};
```

### 8.3 å‰ç«¯ä¼˜åŒ–

- ä»£ç åˆ†å‰² (Code Splitting)
- æ‡’åŠ è½½ (Lazy Loading)
- å›¾ç‰‡ä¼˜åŒ–å’Œ CDN åŠ é€Ÿ
- Service Worker ç¼“å­˜ç­–ç•¥

---

## ç¬¬ä¹éƒ¨åˆ†ï¼šæµ‹è¯•ç­–ç•¥

### 9.1 æµ‹è¯•é‡‘å­—å¡”

```
          E2E Tests (10%)
         /               \
    Integration Tests (20%)
   /                       \
Unit Tests (70%)
```

### 9.2 æµ‹è¯•å·¥å…·æ ˆ

- **å•å…ƒæµ‹è¯•:** Jest + React Testing Library
- **é›†æˆæµ‹è¯•:** Supertest (API æµ‹è¯•)
- **E2E æµ‹è¯•:** Playwright
- **æ€§èƒ½æµ‹è¯•:** Artillery

### 9.3 æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: > 80%
- é›†æˆæµ‹è¯•è¦†ç›–ç‡: > 60%
- å…³é”®è·¯å¾„ E2E æµ‹è¯•: 100%

---

## ç¬¬åéƒ¨åˆ†ï¼šæœªæ¥è§„åˆ’ä¸è·¯çº¿å›¾

### 10.1 ç¬¬äºŒé˜¶æ®µï¼šä¸»ä½“ç»“æ„æ–½å·¥ (2025-12 ~ 2026-01)

**ç›®æ ‡ï¼š** å®Œæˆ MVP åŠŸèƒ½ï¼Œå®ç°å¤šæ ¡åŒºå®Œæ•´é—­ç¯

**æ ¸å¿ƒä»»åŠ¡ï¼š**
- [ ] æ‰‹æœºç«¯ UI å®Œæ•´ç§»æ¤ (ä¿ç•™ V1 äº¤äº’ä¹ æƒ¯)
- [ ] å¤§å±ç«¯ "æ˜Ÿé™…æŒ‡æŒ¥å®˜" UI è®¾è®¡ä¸å®ç°
- [ ] å®Œæ•´çš„ CRUD API å®ç°
- [ ] å®æ—¶æ•°æ®åŒæ­¥ (Socket.io)
- [ ] åŸºç¡€çš„ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†

### 10.2 ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½å¼€å‘ (2026-02 ~ 2026-03)

**ç›®æ ‡ï¼š** AI åŠŸèƒ½é›†æˆï¼Œæ‰“é€ æ™ºèƒ½åŒ–æ•™è‚²å¹³å°

**æ ¸å¿ƒä»»åŠ¡ï¼š**
- [ ] Python AI æœåŠ¡å¼€å‘
- [ ] OCR ä½œä¸šæ‰¹æ”¹åŠŸèƒ½
- [ ] æ™ºèƒ½é”™é¢˜åˆ†æ
- [ ] ä¸ªæ€§åŒ–å­¦ä¹ æ¨è
- [ ] æ•°æ®å¯è§†åŒ–çœ‹æ¿

### 10.3 ç¬¬å››é˜¶æ®µï¼šå•†ä¸šåŒ–å‡†å¤‡ (2026-04 ~ 2026-05)

**ç›®æ ‡ï¼š** å¤šç§Ÿæˆ· SaaS åŒ–ï¼Œæ”¯æŒå•†ä¸šåŒ–è¿è¥

**æ ¸å¿ƒä»»åŠ¡ï¼š**
- [ ] å¤šç§Ÿæˆ·ç®¡ç†åå°
- [ ] è®¡è´¹å’Œè®¢é˜…ç³»ç»Ÿ
- [ ] æ•°æ®å¯¼å…¥å¯¼å‡ºå·¥å…·
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œæ‰©å®¹
- [ ] å®‰å…¨åŠ å›ºå’Œåˆè§„

### 10.4 ç¬¬äº”é˜¶æ®µï¼šè§„æ¨¡åŒ–è¿è¥ (2026-06+)

**ç›®æ ‡ï¼š** æ”¯æ’‘ 1000+ æ ¡åŒºï¼Œæˆä¸ºè¡Œä¸šæ ‡æ†

**æ ¸å¿ƒä»»åŠ¡ï¼š**
- [ ] å¾®æœåŠ¡æ¶æ„é‡æ„
- [ ] å›½é™…åŒ–å’Œæœ¬åœ°åŒ–
- [ ] å¼€æ”¾ API å¹³å°
- [ ] ç§»åŠ¨ç«¯ App å¼€å‘
- [ ] AI æ¨¡å‹ä¼˜åŒ–å’Œè®­ç»ƒ

---

## ç¬¬åä¸€éƒ¨åˆ†ï¼šå¸¸è§é—®é¢˜è§£ç­”

### Q1: ä¸ºä»€ä¹ˆé€‰æ‹©å¤šç§Ÿæˆ·æ¶æ„è€Œä¸æ˜¯ä¸ºæ¯ä¸ªå­¦æ ¡ç‹¬ç«‹éƒ¨ç½²ï¼Ÿ

**A:** å¤šç§Ÿæˆ·æ¶æ„å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š
- **æˆæœ¬æ•ˆç›Š:** å…±äº«åŸºç¡€è®¾æ–½ï¼Œé™ä½è¿è¥æˆæœ¬
- **ç»´æŠ¤ä¾¿åˆ©:** ç»Ÿä¸€æ›´æ–°å’Œå‡çº§ï¼Œæ— éœ€é€ä¸ªéƒ¨ç½²
- **æ•°æ®æ´å¯Ÿ:** è·¨æ ¡åŒºçš„æ•°æ®åˆ†æèƒ½åŠ›
- **å¿«é€Ÿæ‰©å±•:** æ–°æ ¡åŒºå¿«é€Ÿä¸Šçº¿ï¼Œæ— éœ€é‡æ–°éƒ¨ç½²

### Q2: å¦‚ä½•ä¿è¯ä¸åŒæ ¡åŒºæ•°æ®çš„éš”ç¦»æ€§ï¼Ÿ

**A:** é€šè¿‡ä¸‰ä¸ªå±‚é¢ä¿è¯æ•°æ®éš”ç¦»ï¼š
1. **æ•°æ®åº“å±‚:** ä½¿ç”¨ `schoolId` ä½œä¸ºå¤–é”®ï¼Œæ‰€æœ‰æŸ¥è¯¢éƒ½åŒ…å«æ ¡åŒºè¿‡æ»¤
2. **API å±‚:** è·¯ç”±è®¾è®¡ä¸­åŒ…å« `schoolId` å‚æ•°ï¼Œç¡®ä¿ API è°ƒç”¨éš”ç¦»
3. **åº”ç”¨å±‚:** Socket.io æˆ¿é—´æŒ‰æ ¡åŒºéš”ç¦»ï¼Œå®æ—¶æ¨é€ä¸ä¼šè·¨åŒº

### Q3: ä¸ºä»€ä¹ˆé€‰æ‹© Prisma è€Œä¸æ˜¯å…¶ä»– ORMï¼Ÿ

**A:** Prisma çš„ä¼˜åŠ¿ï¼š
- **ç±»å‹å®‰å…¨:** è‡ªåŠ¨ç”Ÿæˆ TypeScript ç±»å‹
- **å¼€å‘æ•ˆç‡:** ä¼˜ç§€çš„ DX å’Œè‡ªåŠ¨å®Œæˆ
- **æ•°æ®åº“è¿ç§»:** å†…ç½®è¿ç§»å·¥å…·ï¼Œç®€åŒ– schema ç®¡ç†
- **æ€§èƒ½ä¼˜åŒ–:** æŸ¥è¯¢ä¼˜åŒ–å’Œè¿æ¥æ± ç®¡ç†

### Q4: å¦‚ä½•å¤„ç† AI æœåŠ¡çš„é«˜å»¶è¿Ÿé—®é¢˜ï¼Ÿ

**A:** é‡‡ç”¨å¼‚æ­¥å¤„ç†ç­–ç•¥ï¼š
1. **ä»»åŠ¡é˜Ÿåˆ—:** ä½¿ç”¨ Redis ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼ŒAI ä»»åŠ¡å¼‚æ­¥å¤„ç†
2. **WebSocket æ¨é€:** å¤„ç†å®Œæˆåé€šè¿‡ Socket.io æ¨é€ç»“æœ
3. **è¶…æ—¶å¤„ç†:** è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡
4. **é™çº§ç­–ç•¥:** AI æœåŠ¡ä¸å¯ç”¨æ—¶æä¾›åŸºç¡€åŠŸèƒ½

### Q5: å¦‚ä½•ä¿è¯å¹³å°çš„å¯æ‰©å±•æ€§ï¼Ÿ

**A:** ä»å¤šä¸ªç»´åº¦ä¿è¯å¯æ‰©å±•æ€§ï¼š
1. **æ°´å¹³æ‰©å±•:** æ— çŠ¶æ€çš„æœåŠ¡è®¾è®¡ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡
2. **æ•°æ®åº“åˆ†ç‰‡:** æŒ‰æ ¡åŒºæˆ–åœ°åŒºè¿›è¡Œæ•°æ®åˆ†ç‰‡
3. **ç¼“å­˜ç­–ç•¥:** å¤šå±‚ç¼“å­˜å‡å°‘æ•°æ®åº“å‹åŠ›
4. **å¾®æœåŠ¡æ¶æ„:** åæœŸå¯æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å¾®æœåŠ¡

---

## ç»“è¯­

ArkOK V2 ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯å‡çº§ï¼Œæ›´æ˜¯å¯¹æœªæ¥æ•™è‚²æ¨¡å¼çš„æ·±åº¦æ€è€ƒå’Œå®è·µã€‚é€šè¿‡ç°ä»£åŒ–çš„æ¶æ„è®¾è®¡ã€æ™ºèƒ½åŒ–çš„åŠŸèƒ½é›†æˆå’Œå¯æŒç»­çš„å‘å±•è§„åˆ’ï¼Œæˆ‘ä»¬è‡´åŠ›äºæ‰“é€ ä¸€ä¸ªçœŸæ­£èƒ½å¤Ÿæ”¹å˜æ•™è‚²çš„å¹³å°ã€‚

ç¬¬ä¸€é˜¶æ®µçš„åœ°åŸºå·¥ç¨‹å·²ç»ä¸ºæˆ‘ä»¬å¥ å®šäº†åšå®çš„åŸºç¡€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†æŒ‰ç…§æ—¢å®šçš„è·¯çº¿å›¾ï¼Œç¨³æ­¥æ¨è¿›å„ä¸ªé˜¶æ®µçš„å¼€å‘å·¥ä½œã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œåœ¨ä¸ä¹…çš„å°†æ¥ï¼ŒArkOK V2 å°†æˆä¸ºæ™ºæ…§æ•™è‚²é¢†åŸŸçš„æ ‡æ†äº§å“ã€‚

**è®©æˆ‘ä»¬ä¸€èµ·ï¼Œç”¨æŠ€æœ¯èµ‹èƒ½æ•™è‚²ï¼Œç”¨åˆ›æ–°æ”¹å˜æœªæ¥ï¼** ğŸš€

---

*æœ¬æ–‡æ¡£å°†æŒç»­æ›´æ–°ï¼Œè®°å½•é¡¹ç›®çš„è¿›å±•å’Œå†³ç­–è¿‡ç¨‹ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æå‡ºè®¨è®ºã€‚*