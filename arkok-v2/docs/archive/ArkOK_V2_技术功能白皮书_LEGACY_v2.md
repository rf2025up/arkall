# ArkOK V2 æŠ€æœ¯æ¶æ„ä¸åŠŸèƒ½è¯´æ˜ç™½çš®ä¹¦

**ç‰ˆæœ¬:** v2.0.0
**å‘å¸ƒæ—¥æœŸ:** 2025-12-18
**æ–‡æ¡£ç±»å‹:** æŠ€æœ¯ç™½çš®ä¹¦
**é€‚ç”¨èŒƒå›´:** å¼€å‘å›¢é˜Ÿã€æŠ€æœ¯å†³ç­–è€…ã€ç³»ç»Ÿæ¶æ„å¸ˆ

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„è®¾è®¡](#2-æŠ€æœ¯æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#3-æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
4. [æ•°æ®æ¨¡å‹è®¾è®¡](#4-æ•°æ®æ¨¡å‹è®¾è®¡)
5. [å®‰å…¨æ¶æ„](#5-å®‰å…¨æ¶æ„)
6. [å‰ç«¯æ¶æ„è¯¦è§£](#6-å‰ç«¯æ¶æ„è¯¦è§£)
7. [åç«¯æœåŠ¡æ¶æ„](#7-åç«¯æœåŠ¡æ¶æ„)
8. [å®æ—¶é€šä¿¡ç³»ç»Ÿ](#8-å®æ—¶é€šä¿¡ç³»ç»Ÿ)
9. [éƒ¨ç½²æ¶æ„](#9-éƒ¨ç½²æ¶æ„)
10. [å¼€å‘è§„èŒƒä¸æœ€ä½³å®è·µ](#10-å¼€å‘è§„èŒƒä¸æœ€ä½³å®è·µ)
11. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#11-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
12. [æœªæ¥æŠ€æœ¯æ¼”è¿›](#12-æœªæ¥æŠ€æœ¯æ¼”è¿›)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 ç³»ç»Ÿç®€ä»‹

ArkOK V2æ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„å¤šç§Ÿæˆ·æ•™è‚²ç®¡ç†SaaSå¹³å°ï¼Œä¸“ä¸ºK-12æ•™è‚²åœºæ™¯è®¾è®¡ã€‚ç³»ç»Ÿé‡‡ç”¨"ç»Ÿä¸€æ‰˜ç®¡"æ¶æ„æ¨¡å¼ï¼Œé›†æˆäº†å­¦ç”Ÿå­¦ä¹ ç®¡ç†ã€æ•™å¸ˆå¤‡è¯¾å·¥å…·ã€ç§¯åˆ†æ¿€åŠ±ç³»ç»Ÿã€å¸ˆç”Ÿå…³ç³»ç®¡ç†ã€å®æ—¶æ•°æ®åŒæ­¥ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼ä¸»å¼ 

- **æ•™å­¦æ•ˆç‡æå‡**: é€šè¿‡æ™ºèƒ½åŒ–å¤‡è¯¾å·¥å…·å’Œä»»åŠ¡ç®¡ç†ç³»ç»Ÿæå‡æ•™å¸ˆå·¥ä½œæ•ˆç‡
- **ä¸ªæ€§åŒ–å­¦ä¹ **: åŸºäºå¸ˆç”Ÿç»‘å®šçš„ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„å’Œä»»åŠ¡æ¨è
- **æ•°æ®é©±åŠ¨å†³ç­–**: å®æ—¶å­¦ä¹ æ•°æ®æ”¶é›†å’Œåˆ†æï¼Œæ”¯æŒæ•™å­¦å†³ç­–
- **å¤šç«¯ç»Ÿä¸€ä½“éªŒ**: ç»Ÿä¸€æ‰˜ç®¡çš„Webåº”ç”¨ï¼Œæ”¯æŒå„ç§è®¾å¤‡è®¿é—®

### 1.3 æŠ€æœ¯ç‰¹è‰²

- **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: React 19 + TypeScript + Prisma + Express
- **ç»Ÿä¸€æ‰˜ç®¡æ¶æ„**: å‰åç«¯é›†æˆéƒ¨ç½²ï¼Œç®€åŒ–è¿ç»´å¤æ‚åº¦
- **å®æ—¶æ•°æ®åŒæ­¥**: åŸºäºSocket.ioçš„å®æ—¶é€šä¿¡æœºåˆ¶
- **å¸ˆç”Ÿç»‘å®šå®‰å…¨**: åŸºäºè§’è‰²å’Œæƒé™çš„ç»†ç²’åº¦è®¿é—®æ§åˆ¶

---

## 2. æŠ€æœ¯æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ArkOK V2 ç»Ÿä¸€æ‰˜ç®¡æ¶æ„                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   å‰ç«¯åº”ç”¨       â”‚    â”‚        åç«¯APIæœåŠ¡           â”‚  â”‚
â”‚  â”‚  React 19       â”‚â—„â”€â”€â–ºâ”‚      Express.js 4.18       â”‚  â”‚
â”‚  â”‚  TypeScript      â”‚    â”‚      TypeScript            â”‚  â”‚
â”‚  â”‚  Vite 7.2       â”‚    â”‚      Prisma 5.7           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                           â”‚                  â”‚
â”‚           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚      PostgreSQL æ•°æ®åº“       â”‚  â”‚
â”‚                          â”‚     (Prisma ORM)           â”‚  â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç»Ÿä¸€ç«¯å£ 3000                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¶æ„è®¾è®¡åŸåˆ™

#### å•ä¸€èŒè´£åŸåˆ™ (SRP)
- **å‰ç«¯**: ä¸“æ³¨äºç”¨æˆ·ç•Œé¢å’Œäº¤äº’é€»è¾‘
- **åç«¯**: ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’Œæ•°æ®å¤„ç†
- **æ•°æ®åº“**: ä¸“æ³¨äºæ•°æ®å­˜å‚¨å’Œå…³ç³»ç®¡ç†

#### ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
```typescript
// æœåŠ¡å±‚æŠ½è±¡ï¼Œä¾èµ–æ³¨å…¥æ¨¡å¼
export class LMSService {
  private prisma = new PrismaClient(); // è‡ªåŒ…å«ï¼Œæ— å¤–éƒ¨ä¾èµ–

  async publishPlan(request: PublishPlanRequest): Promise<PublishPlanResult> {
    // ä¸šåŠ¡é€»è¾‘å®ç°
  }
}
```

#### å¼€é—­åŸåˆ™ (OCP)
- **æ’ä»¶åŒ–ä»»åŠ¡ç³»ç»Ÿ**: æ”¯æŒåŠ¨æ€æ‰©å±•æ–°çš„ä»»åŠ¡ç±»å‹
- **å¯é…ç½®çš„è¯„åˆ†ç³»ç»Ÿ**: æ”¯æŒè‡ªå®šä¹‰ç§¯åˆ†è§„åˆ™
- **æ¨¡å—åŒ–çš„å‰ç«¯ç»„ä»¶**: æ”¯æŒç»„ä»¶çš„ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•

### 2.3 æŠ€æœ¯æ ˆé€‰å‹

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | é€‰å‹ç†ç”± |
|------|----------|------|----------|
| å‰ç«¯æ¡†æ¶ | React | 19.2.0 | æœ€æ–°ç‰ˆæœ¬ï¼Œæ€§èƒ½ä¼˜åŒ–ï¼Œç”Ÿæ€å®Œå–„ |
| æ„å»ºå·¥å…· | Vite | 7.2.4 | å¿«é€Ÿæ„å»ºï¼Œçƒ­æ›´æ–°æ”¯æŒ |
| ç±»å‹ç³»ç»Ÿ | TypeScript | 5.9.3 | ç±»å‹å®‰å…¨ï¼Œå¼€å‘ä½“éªŒå¥½ |
| åç«¯æ¡†æ¶ | Express.js | 4.18.2 | æˆç†Ÿç¨³å®šï¼Œä¸­é—´ä»¶ä¸°å¯Œ |
| ORMæ¡†æ¶ | Prisma | 5.7.1 | ç±»å‹å®‰å…¨ï¼Œæ•°æ®åº“è¿ç§» |
| æ•°æ®åº“ | PostgreSQL | - | å¼ºä¸€è‡´æ€§ï¼ŒJSONæ”¯æŒ |
| å®æ—¶é€šä¿¡ | Socket.io | - | è·¨æµè§ˆå™¨å…¼å®¹ï¼Œç¨³å®šå¯é  |

---

## 3. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 3.1 å¸ˆç”Ÿå…³ç³»ç®¡ç†ç³»ç»Ÿ

#### åŠŸèƒ½æ¦‚è¿°
å®ç°æ•™å¸ˆä¸å­¦ç”Ÿä¹‹é—´çš„ç»‘å®šå…³ç³»ç®¡ç†ï¼Œæ”¯æŒå¤šè§†å›¾æ¨¡å¼åˆ‡æ¢å’Œå®‰å…¨çš„æƒé™æ§åˆ¶ã€‚

#### æŠ€æœ¯å®ç°

**æ•°æ®æ¨¡å‹:**
```typescript
interface Teacher {
  id: string;
  schoolId: string;
  primaryClassName: string; // ç­ä¸»ä»»ç­çº§å
  teacherId: string;
  username: string;
  name: string;
  role: "TEACHER" | "ADMIN";
}

interface Student {
  id: string;
  schoolId: string;
  teacherId: string | null; // å¸ˆç”Ÿç»‘å®šå­—æ®µ
  name: string;
  className: string;
  exp: number;
  points: number;
}
```

**æƒé™æ§åˆ¶é€»è¾‘:**
```typescript
// åŸºäºè§†å›¾æ¨¡å¼çš„æ•°æ®è®¿é—®æ§åˆ¶
const getViewModeFilter = (viewMode: string, userId: string) => {
  switch (viewMode) {
    case 'MY_STUDENTS':
      return { teacherId: userId }; // åªæŸ¥çœ‹è‡ªå·±çš„å­¦ç”Ÿ
    case 'ALL_SCHOOL':
      return {}; // æŸ¥çœ‹å…¨æ ¡å­¦ç”Ÿï¼ˆç”¨äºæŠ¢äººåŠŸèƒ½ï¼‰
    case 'SPECIFIC_CLASS':
      return { teacherId: selectedTeacherId }; // æŸ¥çœ‹ç‰¹å®šè€å¸ˆçš„å­¦ç”Ÿ
    default:
      return { teacherId: userId };
  }
};
```

#### åŠŸèƒ½ç‰¹æ€§
- **å¤šè§†å›¾æ¨¡å¼**: æˆ‘çš„å­¦ç”Ÿ | å…¨æ ¡å¤§åå• | ç‰¹å®šç­çº§
- **æŠ¢äººåŠŸèƒ½**: å®‰å…¨çš„å¸ˆç”Ÿå…³ç³»è½¬ç§»æœºåˆ¶
- **å®æ—¶åŒæ­¥**: å¸ˆç”Ÿå…³ç³»å˜æ›´çš„å®æ—¶é€šçŸ¥
- **æƒé™éš”ç¦»**: ä¸¥æ ¼çš„æ•™å¸ˆæƒé™è¾¹ç•Œæ§åˆ¶

### 3.2 å­¦ä¹ ç®¡ç†ç³»ç»Ÿ (LMS)

#### åŠŸèƒ½æ¦‚è¿°
æä¾›å®Œæ•´çš„æ•™å­¦è®¡åˆ’ç®¡ç†ã€ä»»åŠ¡å‘å¸ƒã€å­¦ä¹ è¿›åº¦è·Ÿè¸ªåŠŸèƒ½ï¼Œæ”¯æŒæ ¸å¿ƒæ•™å­¦æ³•å’Œç»¼åˆæˆé•¿ä¸¤å¤§ä»»åŠ¡ä½“ç³»ã€‚

#### åŒé‡ä»»åŠ¡åˆ†ç±»ä½“ç³»

**1. æ ¸å¿ƒæ•™å­¦æ³•ä»»åŠ¡åº“ (38ä¸ªä»»åŠ¡)**
```typescript
interface MethodologyTask {
  educationalDomain: 'æ ¸å¿ƒæ•™å­¦æ³•';
  educationalSubcategory: string; // 9å¤§æ•™å­¦æ³•ç»´åº¦
  name: string;
  description: string;
  defaultExp: number;
  difficulty: 1-5;
}

// 9å¤§æ•™å­¦æ³•ç»´åº¦
const TEACHING_DIMENSIONS = [
  'åŸºç¡€å­¦ä¹ æ–¹æ³•è®º',      // 5ä¸ªä»»åŠ¡
  'æ•°å­¦æ€ç»´ä¸è§£é¢˜ç­–ç•¥',   // 7ä¸ªä»»åŠ¡
  'è¯­æ–‡å­¦ç§‘èƒ½åŠ›æ·±åŒ–',    // 6ä¸ªä»»åŠ¡
  'è‹±è¯­åº”ç”¨ä¸è¾“å‡º',      // 2ä¸ªä»»åŠ¡
  'é˜…è¯»æ·±åº¦ä¸åˆ†äº«',      // 3ä¸ªä»»åŠ¡
  'è‡ªä¸»å­¦ä¹ ä¸è§„åˆ’',      // 4ä¸ªä»»åŠ¡
  'è¯¾å ‚äº’åŠ¨ä¸æ·±åº¦å‚ä¸',   // 5ä¸ªä»»åŠ¡
  'å®¶åº­è”ç»“ä¸çŸ¥è¯†è¿ç§»',   // 5ä¸ªä»»åŠ¡
  'é«˜é˜¶è¾“å‡ºä¸åˆ›æ–°'       // 1ä¸ªä»»åŠ¡
];
```

**2. ç»¼åˆæˆé•¿ä»»åŠ¡åº“ (14ä¸ªä»»åŠ¡)**
```typescript
interface GrowthTask {
  educationalDomain: 'ç»¼åˆæˆé•¿';
  category: string; // 4å¤§ç±»é‡æ–°åˆ†ç»„
  subcategory: string; // å…·ä½“å­ç±»åˆ«
  name: string;
  defaultExp: number;
}

// 4å¤§ç±»åˆ†ç»„
const GROWTH_CATEGORIES = {
  'é˜…è¯»å¹¿åº¦ç±»': ['å¹´çº§åŒæ­¥é˜…è¯»', 'è¯¾å¤–é˜…è¯»30åˆ†é’Ÿ', 'å¡«å†™é˜…è¯»è®°å½•å•'],
  'æ•´ç†ä¸è´¡çŒ®ç±»': ['ç¦»æ ¡å‰æ•´ç†', 'é›†ä½“è´¡çŒ®ä»»åŠ¡', 'å…‰ç›˜è¡ŒåŠ¨'],
  'äº’åŠ©ä¸åˆ›æ–°ç±»': ['å¸®åŠ©åŒå­¦', 'åˆ›æ„è¡¨è¾¾', 'å¥åº·æ´»åŠ›ä»»åŠ¡'],
  'å®¶åº­è”ç»“ç±»': ['å®¶åº­é˜…è¯»', 'å®¶åŠ¡åŠ³åŠ¨']
};
```

#### å¤‡è¯¾ç³»ç»Ÿæ¶æ„

**å‘å¸ƒå®‰å…¨çº¦æŸ:**
```typescript
async publishPlan(request: PublishPlanRequest): Promise<PublishPlanResult> {
  // ğŸ”’ å…³é”®å®‰å…¨çº¦æŸï¼šåªèƒ½å‘è‡ªå·±åä¸‹çš„å­¦ç”Ÿå‘å¸ƒ
  const students = await this.prisma.student.findMany({
    where: {
      schoolId: request.schoolId,
      teacherId: request.teacherId, // å‘å¸ƒè€…IDé”å®š
      isActive: true
    }
  });

  // åˆ›å»ºæ•™å­¦è®¡åˆ’è®°å½•
  const lessonPlan = await this.prisma.lessonPlan.create({
    data: {
      schoolId: request.schoolId,
      teacherId: request.teacherId,
      title: request.title,
      content: request.content,
      date: request.date,
      isActive: true
    }
  });

  // æ‰¹é‡åˆ›å»ºå­¦ç”Ÿä»»åŠ¡è®°å½•
  const taskRecords = students.map(student => ({
    studentId: student.id,
    lessonPlanId: lessonPlan.id,
    // ... ä»»åŠ¡æ•°æ®
  }));

  await this.prisma.taskRecord.createMany({
    data: taskRecords
  });

  // å®æ—¶é€šçŸ¥ç›¸å…³å­¦ç”Ÿ
  this.notifyStudents(students, lessonPlan);
}
```

### 3.3 ç§¯åˆ†ä¸ç»éªŒå€¼ç³»ç»Ÿ

#### ç³»ç»Ÿè®¾è®¡ç†å¿µ
åŸºäºæ¸¸æˆåŒ–å­¦ä¹ ç†å¿µï¼Œé€šè¿‡ç§¯åˆ†å’Œç»éªŒå€¼æ¿€åŠ±å­¦ç”Ÿå­¦ä¹ ï¼Œæ”¯æŒå¤šç»´åº¦çš„è¯„ä»·ä½“ç³»ã€‚

#### æ•°æ®æ¨¡å‹è®¾è®¡
```typescript
interface ScoringRecord {
  id: string;
  studentId: string;
  teacherId: string;
  points: number;         // ç§¯åˆ†å€¼ï¼ˆå¯æ­£å¯è´Ÿï¼‰
  exp: number;           // ç»éªŒå€¼ï¼ˆåªå¢ä¸å‡ï¼‰
  reason: string;        // ç§¯åˆ†åŸå› 
  category: string;      // ç§¯åˆ†ç±»åˆ«
  createdAt: Date;
}

interface Student {
  // ... å…¶ä»–å­—æ®µ
  points: number;        // å½“å‰æ€»ç§¯åˆ†
  exp: number;          // å½“å‰æ€»ç»éªŒå€¼
  level: number;        // ç­‰çº§ = Math.floor(exp / 100) + 1
}
```

#### ç§¯åˆ†ç±»åˆ«ä½“ç³»
```typescript
const SCORING_CATEGORIES = {
  'I': 'å­¦ä¹ æˆæœä¸é«˜ä»·å€¼å¥–åŠ±',
  'II': 'è‡ªä¸»ç®¡ç†ä¸ä¹ æƒ¯å…»æˆ (åˆæ‰˜ç¯‡)',
  'III': 'è‡ªä¸»ç®¡ç†ä¸å­¦ä¹ è¿‡ç¨‹ (æ™šè¾…ç¯‡)',
  'IV': 'å­¦ä¹ æ•ˆç‡ä¸æ—¶é—´ç®¡ç†',
  'V': 'è´¨é‡ã€è¿›æ­¥ä¸æ•´ç†',
  'VI': 'çºªå¾‹ä¸æƒ©ç½šç»†åˆ™',
  'CUSTOM': 'è‡ªå®šä¹‰ç±»åˆ«'
};
```

#### æ‰¹é‡ç§¯åˆ†æ“ä½œ
```typescript
// æ‰¹é‡ç§¯åˆ†æ›´æ–°API
router.post('/students/score', async (req, res) => {
  const { studentIds, points, exp, reason } = req.body;

  const results = await Promise.allSettled(
    studentIds.map(studentId =>
      studentService.updateStudentScore(studentId, {
        points,
        exp,
        reason,
        teacherId: req.user.userId
      })
    )
  );

  // å®æ—¶æ›´æ–°å­¦ç”Ÿæ•°æ®
  this.io.emit('student_scores_updated', {
    studentIds,
    updates: results.map(r => r.status === 'fulfilled' ? r.value : null)
  });
});
```

---

## 4. æ•°æ®æ¨¡å‹è®¾è®¡

### 4.1 æ•°æ®åº“æ¶æ„æ¦‚è§ˆ

**ORMæ¡†æ¶**: Prisma 5.7.1
**æ•°æ®åº“**: PostgreSQL
**å‘½åè§„èŒƒ**: snake_caseè¡¨å + camelCaseå­—æ®µ

### 4.2 æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### å­¦æ ¡ç®¡ç†æ¨¡å‹
```prisma
model schools {
  id         String         @id @default(cuid())
  name       String
  planType   String         @default("FREE")
  isActive   Boolean        @default(true)
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt

  // å…³è”å…³ç³»
  teachers   teacher[]
  students   student[]
  lessonPlans lessonPlan[]

  @@map("schools")
}
```

#### æ•™å¸ˆç®¡ç†æ¨¡å‹
```prisma
model teachers {
  id               String         @id @default(cuid())
  schoolId         String
  primaryClassName String?        // ç­ä¸»ä»»ç­çº§åï¼ˆå®ªæ³•è¦æ±‚ï¼‰
  teacherId        String?
  username         String         @unique
  password         String
  name             String
  displayName      String?
  email            String?
  role             String         @default("TEACHER")
  isActive         Boolean        @default(true)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  // å…³è”å…³ç³»
  school           school         @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  students         student[]
  lessonPlans      lessonPlan[]

  @@map("teachers")
}
```

#### å­¦ç”Ÿç®¡ç†æ¨¡å‹
```prisma
model students {
  id          String    @id @default(cuid())
  schoolId    String
  teacherId   String?   // å¸ˆç”Ÿç»‘å®šå­—æ®µï¼ˆå®ªæ³•è¦æ±‚ï¼‰
  name        String
  className   String?
  avatarUrl   String?
  points      Int       @default(0)
  exp         Int       @default(0)
  level       Int       @default(1)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // å…³è”å…³ç³»
  school      school    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  teacher     teacher?  @relation(fields: [teacherId], references: [id], onDelete: SetNull)
  taskRecords taskRecord[]

  @@map("students")
}
```

#### æ•™å­¦è®¡åˆ’æ¨¡å‹
```prisma
model lessonPlans {
  id        String    @id @default(cuid())
  schoolId  String
  teacherId String
  title     String
  content   Json      // å­˜å‚¨è¯¾ç¨‹ä¿¡æ¯ã€ä»»åŠ¡åˆ—è¡¨ç­‰
  date      DateTime
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // å…³è”å…³ç³»
  school       school       @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  teacher      teacher      @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  taskRecords  taskRecord[]

  @@map("lesson_plans")
}
```

#### ä»»åŠ¡è®°å½•æ¨¡å‹
```prisma
model taskRecords {
  id           String    @id @default(cuid())
  studentId    String
  lessonPlanId String
  taskId       String
  title        String
  type         TaskType  @default(TASK)
  content      Json?
  status       String    @default("PENDING")
  expAwarded   Int       @default(0)
  attempts     Int       @default(0)
  completedAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // å…³è”å…³ç³»
  student    student    @relation(fields: [studentId], references: [id], onDelete: Cascade)
  lessonPlan lessonPlan @relation(fields: [lessonPlanId], references: [id], onDelete: Cascade)

  @@map("task_records")
}
```

#### ä»»åŠ¡åº“æ¨¡å‹
```prisma
model taskLibrary {
  id                   String   @id @default(cuid())
  category             String   // è¿è¥æ ‡ç­¾åˆ†ç±»ï¼ˆè¿‡å…³é¡µä½¿ç”¨ï¼‰
  educationalDomain    String   @default("åŸºç¡€ä½œä¸š") // æ•™è‚²ä½“ç³»åˆ†ç±»ï¼ˆå¤‡è¯¾é¡µä½¿ç”¨ï¼‰
  educationalSubcategory String @default("åŸºç¡€æ ¸å¿ƒ")
  name                 String
  description          String?
  defaultExp           Int      @default(0)
  type                 String   @default("TASK")
  difficulty           Int?
  isActive             Boolean  @default(true)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("task_library")
}
```

### 4.3 æ•°æ®å…³ç³»å›¾

```
schools (1) â”€â”€â”€â”€â”€â”€â”€â”€ (N) teachers
  â”‚                       â”‚
  â”‚                       â”œâ”€â”€ (1:N) students (teacherIdç»‘å®š)
  â”‚                       â”‚
  â”‚                       â””â”€â”€ (1:N) lessonPlans
  â”‚                                   â”‚
  â”‚                                   â””â”€â”€ (1:N) taskRecords
  â”‚                                            â”‚
  â”‚                                            â””â”€â”€ (N:1) students
  â”‚
  â””â”€â”€ (1:N) students (schoolIdéš”ç¦»)
```

### 4.4 æ•°æ®ä¸€è‡´æ€§ä¿è¯

#### äº‹åŠ¡å¤„ç†
```typescript
// å¸ˆç”Ÿå…³ç³»è½¬ç§»çš„äº‹åŠ¡å¤„ç†
async transferStudents(studentIds: string[], targetTeacherId: string) {
  return await this.prisma.$transaction(async (tx) => {
    // 1. æ›´æ–°å­¦ç”Ÿçš„teacherId
    await tx.student.updateMany({
      where: { id: { in: studentIds } },
      data: { teacherId: targetTeacherId }
    });

    // 2. è®°å½•è½¬ç§»æ—¥å¿—
    await tx.transferLog.create({
      data: {
        studentIds,
        fromTeacherId: currentTeacherId,
        toTeacherId: targetTeacherId,
        transferredAt: new Date()
      }
    });

    // 3. å‘é€é€šçŸ¥
    await this.notifyTransfer(studentIds, targetTeacherId);
  });
}
```

---

## 5. å®‰å…¨æ¶æ„

### 5.1 è®¤è¯ä¸æˆæƒä½“ç³»

#### JWTè®¤è¯å®ç°
```typescript
export class AuthService {
  private readonly JWT_SECRET = process.env.JWT_SECRET || 'default-secret';
  private readonly JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || '7d';

  async login(credentials: LoginRequest): Promise<LoginResponse> {
    const { username, password } = credentials;

    // æ•°æ®åº“éªŒè¯
    const user = await this.prisma.teacher.findFirst({
      where: { username },
      include: { school: true }
    });

    if (user && await bcrypt.compare(password, user.password)) {
      const token = jwt.sign({
        userId: user.id,
        username: user.username,
        schoolId: user.schoolId,
        role: user.role
      }, this.JWT_SECRET, { expiresIn: this.JWT_EXPIRES_IN });

      return {
        success: true,
        user: {
          userId: user.id,
          username: user.username,
          name: user.name,
          role: user.role,
          schoolId: user.schoolId
        },
        token,
        expiresIn: this.parseExpiresIn(this.JWT_EXPIRES_IN)
      };
    }

    return { success: false, message: 'è®¤è¯å¤±è´¥' };
  }
}
```

#### æƒé™ä¸­é—´ä»¶
```typescript
export const authenticateToken = (authService: AuthService) => {
  return (req: Request, res: Response, next: NextFunction) => {
    const authHeader = req.headers['authorization'];
    const token = authHeader && authHeader.split(' ')[1];

    if (!token) {
      return res.status(401).json({
        success: false,
        message: 'Access token required'
      });
    }

    const user = authService.verifyToken(token);
    if (!user) {
      return res.status(403).json({
        success: false,
        message: 'Invalid or expired token'
      });
    }

    // å°†ç”¨æˆ·ä¿¡æ¯é™„åŠ åˆ°è¯·æ±‚å¯¹è±¡
    (req as any).user = user;
    next();
  };
};
```

### 5.2 å¸ˆç”Ÿç»‘å®šå®‰å…¨æ¨¡å‹

#### æ•°æ®è®¿é—®æ§åˆ¶
```typescript
export class StudentService {
  private prisma = new PrismaClient();

  async getStudents(query: StudentQuery): Promise<StudentListResponse> {
    const { schoolId, scope, teacherId, userRole } = query;

    // åŸºäºè§†å›¾æ¨¡å¼çš„è®¿é—®æ§åˆ¶
    let whereCondition: any = {
      schoolId: schoolId,
      isActive: true,
    };

    switch (scope) {
      case 'MY_STUDENTS':
        if (teacherId) {
          whereCondition.teacherId = teacherId; // åªè®¿é—®è‡ªå·±çš„å­¦ç”Ÿ
        }
        break;

      case 'ALL_SCHOOL':
        if (userRole !== 'ADMIN') {
          throw new Error('æƒé™ä¸è¶³ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å…¨æ ¡å­¦ç”Ÿ');
        }
        // ä¸æ·»åŠ teacherIdæ¡ä»¶ï¼Œæ˜¾ç¤ºå…¨æ ¡å­¦ç”Ÿ
        break;

      case 'SPECIFIC_TEACHER':
        if (teacherId) {
          whereCondition.teacherId = teacherId;
        }
        break;
    }

    const students = await this.prisma.student.findMany({
      where: whereCondition,
      orderBy: { createdAt: 'desc' }
    });

    return {
      success: true,
      data: {
        students,
        total: students.length
      }
    };
  }
}
```

#### æ“ä½œæƒé™éªŒè¯
```typescript
// LMSå‘å¸ƒæƒé™éªŒè¯
export const canPublishLessonPlan = (user: AuthUser, targetTeacherId?: string): boolean => {
  // 1. å¿…é¡»æ˜¯æ•™å¸ˆè§’è‰²
  if (user.role !== 'TEACHER' && user.role !== 'ADMIN') {
    return false;
  }

  // 2. åªèƒ½ä¸ºè‡ªå·±æˆ–æŒ‡å®šæ•™å¸ˆå‘å¸ƒï¼ˆå¦‚æœæ˜¯æŒ‡å®šæ•™å¸ˆæ¨¡å¼ï¼‰
  if (targetTeacherId && user.userId !== targetTeacherId && user.role !== 'ADMIN') {
    return false;
  }

  return true;
};
```

### 5.3 æ•°æ®ä¼ è¾“å®‰å…¨

#### HTTPSé…ç½®
```typescript
// ç”Ÿäº§ç¯å¢ƒHTTPSé…ç½®
const app = express();

if (process.env.NODE_ENV === 'production') {
  app.use((req, res, next) => {
    if (req.header('x-forwarded-proto') !== 'https') {
      res.redirect(`https://${req.header('host')}${req.url}`);
    } else {
      next();
    }
  });
}
```

#### æ•°æ®éªŒè¯
```typescript
import { z } from 'zod';

// è¯·æ±‚ä½“éªŒè¯æ¨¡å¼
const CreateStudentSchema = z.object({
  name: z.string().min(1).max(50),
  className: z.string().optional(),
  schoolId: z.string().uuid(),
  teacherId: z.string().uuid()
});

// APIè·¯ç”±éªŒè¯
router.post('/students', async (req, res) => {
  try {
    const validatedData = CreateStudentSchema.parse(req.body);
    // å¤„ç†éªŒè¯åçš„æ•°æ®
  } catch (error) {
    return res.status(400).json({
      success: false,
      message: 'è¯·æ±‚æ•°æ®æ ¼å¼é”™è¯¯',
      errors: error.errors
    });
  }
});
```

---

## 6. å‰ç«¯æ¶æ„è¯¦è§£

### 6.1 ç»„ä»¶æ¶æ„è®¾è®¡

#### æŠ€æœ¯æ ˆç»„åˆ
- **React 19.2.0**: ä½¿ç”¨æœ€æ–°çš„å¹¶å‘ç‰¹æ€§å’ŒHooks
- **TypeScript 5.9.3**: ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
- **Vite 7.2.4**: å¿«é€Ÿçš„å¼€å‘æ„å»ºå·¥å…·
- **Tailwind CSS**: å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶

#### çŠ¶æ€ç®¡ç†æ¶æ„
```typescript
// è®¤è¯ä¸Šä¸‹æ–‡ (AuthContext.tsx)
interface AuthContextType {
  token: string | null;
  user: AuthUser | null;
  login: (credentials: LoginRequest) => Promise<LoginResponse>;
  logout: () => void;
  isLoading: boolean;
}

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [token, setToken] = useState<string | null>(localStorage.getItem('authToken'));
  const [user, setUser] = useState<AuthUser | null>(
    localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')!) : null
  );

  // è®¤è¯é€»è¾‘å®ç°
  const login = async (credentials: LoginRequest): Promise<LoginResponse> => {
    const response = await apiService.auth.login(credentials);
    if (response.success && response.token) {
      setToken(response.token);
      setUser(response.user || null);
      localStorage.setItem('authToken', response.token);
      if (response.user) {
        localStorage.setItem('user', JSON.stringify(response.user));
      }
    }
    return response;
  };

  return (
    <AuthContext.Provider value={{ token, user, login, logout, isLoading: false }}>
      {children}
    </AuthContext.Provider>
  );
};
```

#### ç­çº§ç®¡ç†ä¸Šä¸‹æ–‡
```typescript
// ç­çº§ä¸Šä¸‹æ–‡ (ClassContext.tsx)
interface ClassContextType {
  viewMode: 'MY_STUDENTS' | 'ALL_SCHOOL' | 'SPECIFIC_CLASS';
  selectedTeacherId: string | null;
  currentClass: string;
  availableClasses: ClassInfo[];
  switchViewMode: (mode: string, teacherId?: string) => void;
  switchClass: (className: string) => void;
}

export const ClassProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [viewMode, setViewMode] = useState<ViewMode>('MY_STUDENTS');
  const [selectedTeacherId, setSelectedTeacherId] = useState<string | null>(null);
  const [currentClass, setCurrentClass] = useState<string>('ALL');
  const [availableClasses, setAvailableClasses] = useState<ClassInfo[]>([]);

  const switchViewMode = (mode: string, teacherId?: string) => {
    setViewMode(mode as ViewMode);
    if (teacherId) {
      setSelectedTeacherId(teacherId);
    }
  };

  return (
    <ClassContext.Provider value={{
      viewMode,
      selectedTeacherId,
      currentClass,
      availableClasses,
      switchViewMode,
      switchClass: setCurrentClass
    }}>
      {children}
    </ClassContext.Provider>
  );
};
```

### 6.2 æ ¸å¿ƒé¡µé¢ç»„ä»¶

#### ä¸»é¡µç»„ä»¶ (Home.tsx)
```typescript
const Home: React.FC = () => {
  const { token, user } = useAuth();
  const { viewMode, switchViewMode, selectedTeacherId, currentClass } = useClass();
  const navigate = useNavigate();

  // çŠ¶æ€ç®¡ç†
  const [students, setStudents] = useState<Student[]>([]);
  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());
  const [isMultiSelectMode, setIsMultiSelectMode] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  // æ•°æ®è·å–é€»è¾‘
  const fetchStudents = async () => {
    setIsLoading(true);
    try {
      const params = new URLSearchParams();

      if (viewMode === 'MY_STUDENTS' && user?.userId) {
        params.append('scope', 'MY_STUDENTS');
        params.append('teacherId', user.userId);
      } else if (viewMode === 'ALL_SCHOOL') {
        params.append('scope', 'ALL_SCHOOL');
      }

      const response = await apiService.get(`/students?${params}`);
      if (response.success && response.data) {
        setStudents(response.data.students);
      }
    } catch (error) {
      console.error('è·å–å­¦ç”Ÿæ•°æ®å¤±è´¥:', error);
    } finally {
      setIsLoading(false);
    }
  };

  // äº¤äº’é€»è¾‘
  const handleStudentTouch = (student: Student) => {
    if (isMultiSelectMode) {
      toggleSelection(student.id);
    } else {
      navigate(`/student/${student.id}`);
    }
  };

  const handleLongPress = (student: Student) => {
    // é•¿æŒ‰æ˜¾ç¤ºç§¯åˆ†é¢æ¿
    setScoringStudent(student);
    setIsSheetOpen(true);
  };

  return (
    <div className="min-h-screen w-full bg-gradient-to-b from-orange-500 to-orange-600">
      {/* å¤´éƒ¨å¯¼èˆª */}
      <header className="bg-primary px-6 py-6 pb-20">
        <div className="flex justify-between items-center">
          <div>
            <button onClick={() => setIsClassDrawerOpen(true)}>
              <h2 className="text-white text-2xl font-bold">
                {viewMode === 'MY_STUDENTS' ? `${user?.name}çš„ç­çº§` : 'å…¨æ ¡å¤§åå•'}
              </h2>
            </button>
            <p className="text-orange-100 text-sm">
              {students.length} ä½å­¦ç”Ÿ
            </p>
          </div>
          <button onClick={toggleMultiSelectMode}>
            {isMultiSelectMode ? <CheckSquare size={20} /> : <ListChecks size={20} />}
          </button>
        </div>
      </header>

      {/* å­¦ç”Ÿç½‘æ ¼ */}
      <div className="px-4 -mt-12">
        <div className="bg-white rounded-3xl shadow-xl p-5">
          <div className="grid grid-cols-3 gap-4">
            {students.map((student) => (
              <StudentCard
                key={student.id}
                student={student}
                isSelected={selectedIds.has(student.id)}
                isMultiSelectMode={isMultiSelectMode}
                onTouch={() => handleStudentTouch(student)}
                onLongPress={() => handleLongPress(student)}
              />
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};
```

#### å¤‡è¯¾é¡µé¢ç»„ä»¶ (PrepView.tsx)
```typescript
const PrepView: React.FC = () => {
  const { token, user } = useAuth();
  const { currentClass, viewMode } = useClass();

  // çŠ¶æ€ç®¡ç†
  const [taskLibrary, setTaskLibrary] = useState<TaskLibraryItem[]>([]);
  const [courseInfo, setCourseInfo] = useState<CourseInfo>({
    chinese: { unit: "1", lesson: "1", title: "åŠ è½½ä¸­..." },
    math: { unit: "1", lesson: "1", title: "åŠ è½½ä¸­..." },
    english: { unit: "1", title: "Loading..." }
  });
  const [selectedQC, setSelectedQC] = useState<Record<string, string[]>>({
    chinese: [],
    math: [],
    english: []
  });
  const [selectedTasks, setSelectedTasks] = useState<string[]>([]);
  const [publishStatus, setPublishStatus] = useState<PublishStatus>({
    isPublishing: false,
    error: null,
    success: false
  });

  // è·å–æœ€æ–°æ•™å­¦è®¡åˆ’
  const fetchLatestLessonPlan = async () => {
    try {
      const response = await apiService.get('/lms/latest-lesson-plan');
      if (response.success && response.data) {
        const { courseInfo } = response.data;
        setCourseInfo({
          chinese: courseInfo.chinese || { unit: "1", lesson: "1", title: "é»˜è®¤è¯¾ç¨‹" },
          math: courseInfo.math || { unit: "1", lesson: "1", title: "é»˜è®¤è¯¾ç¨‹" },
          english: courseInfo.english || { unit: "1", title: "Default Course" }
        });
      }
    } catch (error) {
      console.error('è·å–æœ€æ–°æ•™å­¦è®¡åˆ’å¤±è´¥:', error);
    }
  };

  // å‘å¸ƒå¤‡è¯¾è®¡åˆ’
  const publishPlan = async () => {
    // å®‰å…¨æ£€æŸ¥ï¼šå¿…é¡»åœ¨æˆ‘çš„å­¦ç”Ÿè§†å›¾ä¸‹æ‰èƒ½å‘å¸ƒ
    if (viewMode !== 'MY_STUDENTS') {
      setPublishStatus({
        isPublishing: false,
        error: 'è¯·åˆ‡æ¢å›ã€æˆ‘çš„å­¦ç”Ÿã€‘è§†å›¾è¿›è¡Œå‘å¸ƒ',
        success: false
      });
      return;
    }

    setPublishStatus({ isPublishing: true, error: null, success: false });

    try {
      const planData = {
        courseInfo: {
          title: `${new Date().toLocaleDateString()} å¤‡è¯¾è®¡åˆ’`,
          ...courseInfo
        },
        qcTasks: Object.entries(selectedQC).flatMap(([subject, items]) =>
          items.map(item => ({
            taskName: item,
            category: subject,
            defaultExp: 5
          }))
        ),
        normalTasks: selectedTasks.map(taskName => {
          const task = taskLibrary.find(t => t.name === taskName);
          return {
            taskName,
            category: task?.category || 'åŸºç¡€æ ¸å¿ƒ',
            defaultExp: task?.defaultExp || 10
          };
        })
      };

      const result = await apiService.post('/lms/publish', planData);

      if (result.success) {
        setPublishStatus({ isPublishing: false, error: null, success: true });
        alert(`å¤‡è¯¾è®¡åˆ’å‘å¸ƒæˆåŠŸï¼å½±å“å­¦ç”Ÿ: ${result.data.totalStudents}`);
      }
    } catch (error) {
      setPublishStatus({
        isPublishing: false,
        error: error instanceof Error ? error.message : 'å‘å¸ƒå¤±è´¥',
        success: false
      });
    }
  };

  return (
    <div className="min-h-screen bg-[#F2F4F7] pb-40">
      {/* å¤´éƒ¨ */}
      <header className="px-6 pt-14 pb-4 sticky top-0 bg-[#F2F4F7]/95 backdrop-blur-md">
        <div className="flex justify-between items-center">
          <div>
            <h1 className="text-2xl font-bold">ä»Šæ—¥å¤‡è¯¾</h1>
            <p className="text-xs text-slate-400">
              {new Date().toLocaleDateString()} Â· {viewMode === 'MY_STUDENTS' ? `${user?.name}çš„ç­çº§` : 'å…¨æ ¡è§†å›¾'}
            </p>
          </div>
          <button
            onClick={publishPlan}
            disabled={publishStatus.isPublishing || viewMode !== 'MY_STUDENTS'}
            className={`px-5 py-2.5 rounded-2xl text-sm font-bold ${
              publishStatus.isPublishing || viewMode !== 'MY_STUDENTS'
                ? 'bg-slate-400 cursor-not-allowed'
                : 'bg-slate-900 text-white'
            }`}
          >
            {publishStatus.isPublishing ? 'å‘å¸ƒä¸­...' : 'å‘å¸ƒ'}
          </button>
        </div>
      </header>

      {/* è¯¾ç¨‹è¿›åº¦ */}
      <div className="px-5 mt-4">
        <div className="bg-white rounded-[24px] p-6 shadow-sm">
          <h3 className="text-xs font-extrabold text-slate-400 mb-5">è¯¾ç¨‹è¿›åº¦</h3>
          {/* è¯¾ç¨‹ä¿¡æ¯è¾“å…¥åŒºåŸŸ */}
        </div>
      </div>

      {/* ä»»åŠ¡é€‰æ‹©åŒºåŸŸ */}
      <div className="px-5 mt-6">
        <TaskSelector
          taskLibrary={taskLibrary}
          selectedQC={selectedQC}
          selectedTasks={selectedTasks}
          onQCToggle={toggleQC}
          onTaskToggle={toggleTask}
        />
      </div>
    </div>
  );
};
```

### 6.3 é€šç”¨ç»„ä»¶åº“

#### APIæœåŠ¡å°è£…
```typescript
// api.service.ts
export class ApiService {
  private api: AxiosInstance;

  constructor(baseURL: string = '/api') {
    this.api = axios.create({
      baseURL,
      timeout: 10000,
      headers: { 'Content-Type': 'application/json' }
    });

    // è¯·æ±‚æ‹¦æˆªå™¨
    this.api.interceptors.request.use(
      (config) => {
        const token = localStorage.getItem('authToken');
        if (token) {
          config.headers.Authorization = `Bearer ${token}`;
        }
        return config;
      },
      (error) => Promise.reject(error)
    );

    // å“åº”æ‹¦æˆªå™¨
    this.api.interceptors.response.use(
      (response) => response.data,
      (error) => {
        if (error.response?.status === 401) {
          localStorage.removeItem('authToken');
          localStorage.removeItem('user');
          window.location.href = '/login';
        }
        return Promise.reject(error);
      }
    );
  }

  // å­¦ç”Ÿç›¸å…³API
  students = {
    get: (params?: string) => this.api.get(`/students${params}`),
    create: (data: CreateStudentRequest) => this.api.post('/students', data),
    update: (id: string, data: UpdateStudentRequest) => this.api.patch(`/students/${id}`, data),
    score: (data: ScoreRequest) => this.api.post('/students/score', data),
    transfer: (data: TransferRequest) => this.api.post('/students/transfer', data)
  };

  // LMSç›¸å…³API
  lms = {
    getTaskLibrary: () => this.api.get('/lms/task-library'),
    publish: (data: PublishRequest) => this.api.post('/lms/publish', data),
    getLatestLessonPlan: () => this.api.get('/lms/latest-lesson-plan'),
    getStudentProgress: (studentId: string) => this.api.get(`/lms/student-progress?studentId=${studentId}`)
  };

  // è®¤è¯ç›¸å…³API
  auth = {
    login: (credentials: LoginRequest) => this.api.post('/auth/login', credentials),
    refreshToken: (token: string) => this.api.post('/auth/refresh', { token })
  };
}
```

---

## 7. åç«¯æœåŠ¡æ¶æ„

### 7.1 æœåŠ¡å±‚è®¾è®¡

#### æ¶æ„åŸåˆ™
- **å•ä¸€èŒè´£**: æ¯ä¸ªæœåŠ¡ç±»ä¸“æ³¨äºç‰¹å®šä¸šåŠ¡é¢†åŸŸ
- **ä¾èµ–æ³¨å…¥**: ä½¿ç”¨è‡ªåŒ…å«çš„PrismaClientå®ä¾‹
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

#### LMSServiceå®ç°
```typescript
export class LMSService {
  private prisma = new PrismaClient();

  /**
   * è·å–ä»»åŠ¡åº“
   * åŒé‡åˆ†ç±»ä½“ç³»ï¼šè¿è¥æ ‡ç­¾ + æ•™è‚²ä½“ç³»
   */
  async getTaskLibrary(): Promise<TaskLibraryItem[]> {
    try {
      const tasks = await this.prisma.taskLibrary.findMany({
        where: { isActive: true },
        orderBy: { createdAt: 'asc' }
      });

      return tasks.map(task => ({
        id: task.id,
        // ğŸ·ï¸ è¿è¥æ ‡ç­¾åˆ†ç±»ï¼ˆè¿‡å…³é¡µä½¿ç”¨ï¼‰
        category: task.category,

        // ğŸ“š æ•™è‚²ä½“ç³»åˆ†ç±»ï¼ˆå¤‡è¯¾é¡µä½¿ç”¨ï¼‰
        educationalDomain: task.educationalDomain || 'åŸºç¡€ä½œä¸š',
        educationalSubcategory: task.educationalSubcategory || task.category,

        name: task.name,
        description: task.description || '',
        defaultExp: task.defaultExp,
        type: task.type,
        difficulty: task.difficulty || 0,
        isActive: task.isActive
      }));
    } catch (error) {
      console.error('è·å–ä»»åŠ¡åº“å¤±è´¥:', error);
      throw new Error('Failed to get task library');
    }
  }

  /**
   * å‘å¸ƒæ•™å­¦è®¡åˆ’
   * å®‰å…¨çº¦æŸï¼šåªèƒ½å‘å‘å¸ƒè€…åä¸‹çš„å­¦ç”Ÿå‘å¸ƒ
   */
  async publishPlan(request: PublishPlanRequest, io: any): Promise<PublishPlanResult> {
    const { schoolId, teacherId, title, content, tasks, date } = request;

    try {
      // ğŸ”’ å®‰å…¨çº¦æŸï¼šè·å–å‘å¸ƒè€…åä¸‹çš„å­¦ç”Ÿ
      const students = await this.prisma.student.findMany({
        where: {
          schoolId,
          teacherId, // å…³é”®å®‰å…¨çº¦æŸ
          isActive: true
        }
      });

      if (students.length === 0) {
        throw new Error('æ²¡æœ‰æ‰¾åˆ°å¯å‘å¸ƒçš„å­¦ç”Ÿ');
      }

      // åˆ›å»ºæ•™å­¦è®¡åˆ’
      const lessonPlan = await this.prisma.lessonPlan.create({
        data: {
          schoolId,
          teacherId,
          title,
          content: {
            ...content,
            publisherId: teacherId,
            securityScope: 'TEACHERS_STUDENTS',
            publishedAt: new Date().toISOString()
          },
          date: date || new Date(),
          isActive: true
        }
      });

      // æ‰¹é‡åˆ›å»ºä»»åŠ¡è®°å½•
      const taskRecords = [];
      for (const student of students) {
        for (const task of tasks) {
          taskRecords.push({
            studentId: student.id,
            lessonPlanId: lessonPlan.id,
            taskId: task.id || `custom_${Date.now()}_${Math.random()}`,
            title: task.title,
            type: task.type,
            content: task.content,
            status: 'PENDING',
            expAwarded: task.expAwarded,
            attempts: 0
          });
        }
      }

      await this.prisma.taskRecord.createMany({
        data: taskRecords
      });

      // ğŸ“¡ å®æ—¶é€šçŸ¥å­¦ç”Ÿ
      const studentIds = students.map(s => s.id);
      io.to(studentIds).emit('lesson_plan_published', {
        lessonPlanId: lessonPlan.id,
        title: title,
        tasks: tasks.map(t => t.title),
        publishedAt: lessonPlan.createdAt
      });

      console.log(`âœ… [LMS] æ•™å­¦è®¡åˆ’å‘å¸ƒæˆåŠŸ: ${lessonPlan.id}, å½±å“å­¦ç”Ÿ: ${students.length}äºº`);

      return {
        success: true,
        lessonPlan: {
          id: lessonPlan.id,
          title: lessonPlan.title,
          date: lessonPlan.date
        },
        taskStats: {
          tasksCreated: taskRecords.length,
          totalStudents: students.length
        }
      };

    } catch (error) {
      console.error('å‘å¸ƒæ•™å­¦è®¡åˆ’å¤±è´¥:', error);
      throw error;
    }
  }
}
```

#### StudentServiceå®ç°
```typescript
export class StudentService {
  private prisma = new PrismaClient();

  /**
   * è·å–å­¦ç”Ÿåˆ—è¡¨
   * æ”¯æŒå¤šè§†å›¾æ¨¡å¼å’Œå®‰å…¨æ§åˆ¶
   */
  async getStudents(query: StudentQuery): Promise<StudentListResponse> {
    const { schoolId, scope, teacherId, userRole, classRoom } = query;

    try {
      let whereCondition: any = {
        schoolId: schoolId,
        isActive: true,
      };

      // åŸºäºè§†å›¾æ¨¡å¼çš„è®¿é—®æ§åˆ¶
      switch (scope) {
        case 'MY_STUDENTS':
          if (teacherId) {
            whereCondition.teacherId = teacherId;
          }
          break;

        case 'ALL_SCHOOL':
          // å…¨æ ¡è§†å›¾ï¼Œä¸é™åˆ¶teacherId
          // ä½†éœ€è¦éªŒè¯ç”¨æˆ·æƒé™
          if (userRole !== 'TEACHER' && userRole !== 'ADMIN') {
            throw new Error('æƒé™ä¸è¶³');
          }
          break;

        case 'SPECIFIC_TEACHER':
          if (teacherId) {
            whereCondition.teacherId = teacherId;
          }
          break;
      }

      // é¢å¤–çš„ç­çº§ç­›é€‰
      if (classRoom && classRoom !== 'ALL') {
        whereCondition.className = classRoom;
      }

      const students = await this.prisma.student.findMany({
        where: whereCondition,
        orderBy: [
          { exp: 'desc' },
          { name: 'asc' }
        ],
        include: {
          teacher: {
            select: {
              id: true,
              name: true,
              primaryClassName: true
            }
          }
        }
      });

      // ç»Ÿè®¡ä¿¡æ¯
      const total = await this.prisma.student.count({
        where: whereCondition
      });

      return {
        success: true,
        data: {
          students: students.map(student => ({
            ...student,
            level: Math.floor(student.exp / 100) + 1,
            avatarUrl: student.avatarUrl || '/avatar.jpg'
          })),
          total,
          pagination: {
            page: 1,
            limit: total,
            pages: 1
          }
        }
      };

    } catch (error) {
      console.error('è·å–å­¦ç”Ÿåˆ—è¡¨å¤±è´¥:', error);
      return {
        success: false,
        message: error instanceof Error ? error.message : 'è·å–å­¦ç”Ÿåˆ—è¡¨å¤±è´¥',
        data: { students: [], total: 0 }
      };
    }
  }

  /**
   * æ›´æ–°å­¦ç”Ÿç§¯åˆ†
   */
  async updateStudentScore(
    studentId: string,
    scoreData: ScoreUpdateData
  ): Promise<Student> {
    try {
      const student = await this.prisma.student.findUnique({
        where: { id: studentId }
      });

      if (!student) {
        throw new Error('å­¦ç”Ÿä¸å­˜åœ¨');
      }

      // æ›´æ–°ç§¯åˆ†å’Œç»éªŒå€¼
      const updatedStudent = await this.prisma.student.update({
        where: { id: studentId },
        data: {
          points: student.points + scoreData.points,
          exp: student.exp + scoreData.exp,
          level: Math.floor((student.exp + scoreData.exp) / 100) + 1
        }
      });

      // è®°å½•ç§¯åˆ†å˜æ›´å†å²
      await this.prisma.scoringRecord.create({
        data: {
          studentId,
          teacherId: scoreData.teacherId,
          points: scoreData.points,
          exp: scoreData.exp,
          reason: scoreData.reason,
          category: scoreData.category
        }
      });

      return updatedStudent;

    } catch (error) {
      console.error('æ›´æ–°å­¦ç”Ÿç§¯åˆ†å¤±è´¥:', error);
      throw error;
    }
  }
}
```

### 7.2 è·¯ç”±å±‚è®¾è®¡

#### LMSè·¯ç”± (lms.routes.ts)
```typescript
import { Router } from 'express';
import { LMSService } from '../services/lms.service';
import { authenticateToken } from '../middleware/auth.middleware';

const router = Router();
const lmsService = new LMSService();

// åº”ç”¨è®¤è¯ä¸­é—´ä»¶åˆ°æ‰€æœ‰è·¯ç”±
router.use(authenticateToken);

// è·å–ä»»åŠ¡åº“
router.get('/task-library', async (req, res) => {
  try {
    const tasks = await lmsService.getTaskLibrary();
    res.json({
      success: true,
      data: tasks,
      message: 'Task library retrieved successfully'
    });
  } catch (error) {
    console.error('è·å–ä»»åŠ¡åº“å¤±è´¥:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to get task library',
      error: (error as Error).message
    });
  }
});

// å‘å¸ƒæ•™å­¦è®¡åˆ’
router.post('/publish', async (req, res) => {
  try {
    const io = req.app.get('io');
    const user = (req as any).user;

    // æƒé™æ£€æŸ¥
    if (user.role !== 'TEACHER' && user.role !== 'ADMIN') {
      return res.status(403).json({
        success: false,
        message: 'æƒé™ä¸è¶³ï¼šåªæœ‰æ•™å¸ˆå¯ä»¥å‘å¸ƒæ•™å­¦è®¡åˆ’'
      });
    }

    const { courseInfo, qcTasks, normalTasks, specialTasks } = req.body;

    const publishRequest: PublishPlanRequest = {
      schoolId: user.schoolId,
      teacherId: user.userId, // ä½¿ç”¨å‘å¸ƒè€…ID
      title: courseInfo.title,
      content: {
        courseInfo,
        qcTasks,
        normalTasks,
        specialTasks,
        publisherId: user.userId,
        securityScope: 'TEACHERS_STUDENTS',
        publishedAt: new Date().toISOString()
      },
      date: courseInfo.date ? new Date(courseInfo.date) : new Date(),
      tasks: [] // æ ¹æ®å‰ç«¯æ•°æ®æ„å»ºä»»åŠ¡æ•°ç»„
    };

    const result = await lmsService.publishPlan(publishRequest, io);

    res.json({
      success: true,
      message: 'Lesson plan published successfully',
      data: result
    });

  } catch (error) {
    console.error('å‘å¸ƒæ•™å­¦è®¡åˆ’å¤±è´¥:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to publish lesson plan',
      error: (error as Error).message
    });
  }
});

export { router as lmsRoutes };
```

#### å­¦ç”Ÿè·¯ç”± (student.routes.ts)
```typescript
import { Router } from 'express';
import { StudentService } from '../services/student.service';
import { authenticateToken } from '../middleware/auth.middleware';

const router = Router();
const studentService = new StudentService();

// åº”ç”¨è®¤è¯ä¸­é—´ä»¶
router.use(authenticateToken);

// è·å–å­¦ç”Ÿåˆ—è¡¨
router.get('/', async (req, res) => {
  try {
    const user = (req as any).user;
    const { scope, classRoom, teacherId } = req.query;

    const query: StudentQuery = {
      schoolId: user.schoolId,
      scope: (scope as string) || 'MY_STUDENTS',
      teacherId: teacherId as string || user.userId,
      userRole: user.role,
      classRoom: classRoom as string
    };

    const result = await studentService.getStudents(query);

    res.json(result);
  } catch (error) {
    console.error('è·å–å­¦ç”Ÿåˆ—è¡¨å¤±è´¥:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to get students',
      error: (error as Error).message
    });
  }
});

// åˆ›å»ºå­¦ç”Ÿ
router.post('/', async (req, res) => {
  try {
    const user = (req as any).user;
    const { name, className } = req.body;

    const studentData = {
      name,
      className: className || `${user.name}çš„ç­çº§`,
      schoolId: user.schoolId,
      teacherId: user.userId // å½’å±åˆ°å½“å‰è€å¸ˆ
    };

    const result = await studentService.createStudent(studentData);

    res.json({
      success: true,
      data: result,
      message: 'Student created successfully'
    });
  } catch (error) {
    console.error('åˆ›å»ºå­¦ç”Ÿå¤±è´¥:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to create student',
      error: (error as Error).message
    });
  }
});

export { router as studentRoutes };
```

### 7.3 ä¸­é—´ä»¶ç³»ç»Ÿ

#### è®¤è¯ä¸­é—´ä»¶
```typescript
// auth.middleware.ts
export interface AuthenticatedRequest extends Request {
  user: AuthUser;
}

export const authenticateToken = (authService: AuthService) => {
  return (req: Request, res: Response, next: NextFunction) => {
    const authHeader = req.headers['authorization'];
    const token = authHeader && authHeader.split(' ')[1];

    if (!token) {
      return res.status(401).json({
        success: false,
        message: 'Access token required',
        code: 'TOKEN_MISSING'
      });
    }

    try {
      const user = authService.verifyToken(token);
      if (!user) {
        return res.status(403).json({
          success: false,
          message: 'Invalid or expired token',
          code: 'TOKEN_INVALID'
        });
      }

      // éªŒè¯ç”¨æˆ·æ˜¯å¦ä»ç„¶æ´»è·ƒ
      // è¿™é‡Œå¯ä»¥æ·»åŠ æ•°æ®åº“æŸ¥è¯¢éªŒè¯ç”¨æˆ·çŠ¶æ€
      (req as AuthenticatedRequest).user = user;
      next();

    } catch (error) {
      console.error('Token verification error:', error);
      return res.status(403).json({
        success: false,
        message: 'Token verification failed',
        code: 'TOKEN_VERIFICATION_ERROR'
      });
    }
  };
};
```

---

## 8. å®æ—¶é€šä¿¡ç³»ç»Ÿ

### 8.1 Socket.ioé›†æˆ

#### æœåŠ¡å™¨ç«¯é…ç½®
```typescript
// socket.ts
import { Server as SocketIOServer } from 'socket.io';
import { Server as HTTPServer } from 'http';

export class SocketManager {
  private io: SocketIOServer;
  private userSockets = new Map<string, string>(); // userId -> socketId

  constructor(server: HTTPServer) {
    this.io = new SocketIOServer(server, {
      cors: {
        origin: process.env.NODE_ENV === 'production'
          ? false // ç”Ÿäº§ç¯å¢ƒä½¿ç”¨åŒæºç­–ç•¥
          : ["http://localhost:3000"], // å¼€å‘ç¯å¢ƒå…è®¸æœ¬åœ°è¿æ¥
        methods: ["GET", "POST"]
      }
    });

    this.setupEventHandlers();
  }

  private setupEventHandlers() {
    this.io.on('connection', (socket) => {
      console.log(`[SOCKET] User connected: ${socket.id}`);

      // ç”¨æˆ·è®¤è¯
      socket.on('authenticate', (token: string) => {
        try {
          const user = jwt.verify(token, process.env.JWT_SECRET!);
          socket.userId = user.userId;
          socket.schoolId = user.schoolId;
          this.userSockets.set(user.userId, socket.id);

          // åŠ å…¥å­¦æ ¡æˆ¿é—´
          socket.join(`school:${user.schoolId}`);

          // åŠ å…¥æ•™å¸ˆæˆ¿é—´ï¼ˆå¦‚æœæ˜¯æ•™å¸ˆï¼‰
          if (user.role === 'TEACHER') {
            socket.join(`teacher:${user.userId}`);
          }

          console.log(`[SOCKET] User authenticated: ${user.userId} (${user.role})`);

          socket.emit('authenticated', {
            success: true,
            userId: user.userId,
            role: user.role
          });

        } catch (error) {
          console.error('[SOCKET] Authentication failed:', error);
          socket.emit('authentication_error', {
            success: false,
            message: 'Invalid token'
          });
        }
      });

      // æ–­å¼€è¿æ¥
      socket.on('disconnect', () => {
        if (socket.userId) {
          this.userSockets.delete(socket.userId);
          console.log(`[SOCKET] User disconnected: ${socket.userId}`);
        }
      });
    });
  }

  /**
   * å‘é€æ•™å­¦è®¡åˆ’å‘å¸ƒé€šçŸ¥
   */
  notifyLessonPlanPublished(studentIds: string[], lessonPlanData: any) {
    studentIds.forEach(studentId => {
      this.io.to(`student:${studentId}`).emit('lesson_plan_published', {
        type: 'LESSON_PLAN_PUBLISHED',
        data: lessonPlanData,
        timestamp: new Date().toISOString()
      });
    });

    console.log(`[SOCKET] Notified ${studentIds.length} students about new lesson plan`);
  }
}

export default SocketManager;
```

#### åº”ç”¨é›†æˆ
```typescript
// app.ts é›†æˆSocket.io
import { createServer } from 'http';
import { SocketManager } from './socket';

export class Application {
  private app: Express;
  private server: HTTPServer;
  private socketManager: SocketManager;

  constructor() {
    this.app = express();
    this.server = createServer(this.app);
    this.socketManager = new SocketManager(this.server);

    this.setupMiddleware();
    this.setupRoutes();
    this.setupErrorHandling();
  }

  private setupRoutes() {
    // å°†socketå®ä¾‹é™„åŠ åˆ°appï¼Œä¾›è·¯ç”±ä½¿ç”¨
    this.app.set('io', this.socketManager.getIO());

    // å…¶ä»–è·¯ç”±è®¾ç½®...
  }

  public start(port: number): void {
    this.server.listen(port, () => {
      console.log(`ğŸš€ ArkOK V2 Server started on port ${port}`);
      console.log(`ğŸ“¡ Socket.io server ready for real-time communications`);
    });
  }
}
```

### 8.2 å‰ç«¯Socketå®¢æˆ·ç«¯

#### SocketæœåŠ¡å°è£…
```typescript
// socket.service.ts
export class SocketService {
  private socket: Socket | null = null;

  constructor() {
    this.connect();
  }

  private connect() {
    const token = localStorage.getItem('authToken');
    if (!token) {
      console.log('[SOCKET] No auth token found, skipping socket connection');
      return;
    }

    this.socket = io('/', {
      auth: {
        token: token
      },
      transports: ['websocket', 'polling']
    });

    this.setupEventListeners();
  }

  private setupEventListeners() {
    if (!this.socket) return;

    // è¿æ¥æˆåŠŸ
    this.socket.on('connect', () => {
      console.log('[SOCKET] Connected to server');

      // è‡ªåŠ¨è®¤è¯
      const token = localStorage.getItem('authToken');
      if (token) {
        this.socket?.emit('authenticate', token);
      }
    });

    // è®¤è¯æˆåŠŸ
    this.socket.on('authenticated', (data) => {
      console.log('[SOCKET] Authentication successful:', data);
    });

    // æ¥æ”¶æ•™å­¦è®¡åˆ’å‘å¸ƒé€šçŸ¥
    this.socket.on('lesson_plan_published', (data) => {
      console.log('[SOCKET] New lesson plan published:', data);
      this.handleLessonPlanPublished(data);
    });

    // è¿æ¥æ–­å¼€
    this.socket.on('disconnect', (reason) => {
      console.log('[SOCKET] Disconnected:', reason);
    });
  }

  // äº‹ä»¶å¤„ç†æ–¹æ³•
  private handleLessonPlanPublished(data: any) {
    // å¯ä»¥ä½¿ç”¨äº‹ä»¶æ€»çº¿æˆ–çŠ¶æ€ç®¡ç†æ¥é€šçŸ¥å…¶ä»–ç»„ä»¶
    window.dispatchEvent(new CustomEvent('lesson_plan_published', { detail: data }));
  }

  // æ–­å¼€è¿æ¥
  disconnect() {
    this.socket?.disconnect();
    this.socket = null;
  }
}

// å…¨å±€SocketæœåŠ¡å®ä¾‹
export const socketService = new SocketService();
```

---

## 9. éƒ¨ç½²æ¶æ„

### 9.1 ç»Ÿä¸€æ‰˜ç®¡éƒ¨ç½²æ¨¡å¼

#### éƒ¨ç½²æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è´Ÿè½½å‡è¡¡å™¨                              â”‚
â”‚                 (Nginx / CloudFlare)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTPS (443)
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ArkOK V2 åº”ç”¨æœåŠ¡å™¨                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Express.js åº”ç”¨                    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚        é™æ€æ–‡ä»¶æœåŠ¡                     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    React Build Files                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    (Frontend Assets)                   â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚        API è·¯ç”±æœåŠ¡                      â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    /api/* è·¯ç”±                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    Socket.io ç«¯ç‚¹                       â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PostgreSQL æ•°æ®åº“                          â”‚
â”‚           (Prisma ORM è¿æ¥æ± ç®¡ç†)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Dockeréƒ¨ç½²é…ç½®
```dockerfile
# Dockerfile
FROM node:18-alpine AS base

# ä¾èµ–å®‰è£…é˜¶æ®µ
FROM base AS deps
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

# æ„å»ºé˜¶æ®µ
FROM base AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .

# æ„å»ºåç«¯
WORKDIR /app/server
RUN npm run build

# æ„å»ºå‰ç«¯
WORKDIR /app/client
RUN npm run build

# ç”Ÿäº§è¿è¡Œé˜¶æ®µ
FROM base AS runner
WORKDIR /app

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 arkok

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=deps --chown=arkok:nodejs /app/server/node_modules ./server/node_modules
COPY --from=builder --chown=arkok:nodejs /app/server/dist ./server/dist
COPY --from=builder --chown=arkok:nodejs /app/server/prisma ./server/prisma
COPY --from=builder --chown=arkok:nodejs /app/client/dist ./client/dist

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV NODE_ENV=production
ENV PORT=3000

# åˆ‡æ¢åˆ°érootç”¨æˆ·
USER arkok

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨åº”ç”¨
CMD ["node", "server/dist/index.js"]
```

#### Docker Composeé…ç½®
```yaml
# docker-compose.yml
version: '3.8'

services:
  arkok-v2:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://arkok:${DB_PASSWORD}@postgres:5432/arkok_v2
      - JWT_SECRET=${JWT_SECRET}
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    restart: unless-stopped
    volumes:
      - ./logs:/app/logs
    networks:
      - arkok-network

  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=arkok_v2
      - POSTGRES_USER=arkok
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
    networks:
      - arkok-network

  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    restart: unless-stopped
    networks:
      - arkok-network

volumes:
  postgres_data:
  redis_data:

networks:
  arkok-network:
    driver: bridge
```

### 9.2 ç¯å¢ƒé…ç½®ç®¡ç†

#### ç¯å¢ƒå˜é‡é…ç½®
```typescript
// config/environment.ts
export interface EnvironmentConfig {
  port: number;
  nodeEnv: string;
  databaseUrl: string;
  jwtSecret: string;
  jwtExpiresIn: string;
  redisUrl?: string;
  corsOrigin: string[];
  uploadMaxSize: number;
  logLevel: string;
}

export const config: EnvironmentConfig = {
  port: parseInt(process.env.PORT || '3000'),
  nodeEnv: process.env.NODE_ENV || 'development',
  databaseUrl: process.env.DATABASE_URL || '',
  jwtSecret: process.env.JWT_SECRET || 'default-secret',
  jwtExpiresIn: process.env.JWT_EXPIRES_IN || '7d',
  redisUrl: process.env.REDIS_URL,
  corsOrigin: process.env.CORS_ORIGIN?.split(',') || ['http://localhost:3000'],
  uploadMaxSize: parseInt(process.env.UPLOAD_MAX_SIZE || '10485760'), // 10MB
  logLevel: process.env.LOG_LEVEL || 'info'
};
```

---

## 10. å¼€å‘è§„èŒƒä¸æœ€ä½³å®è·µ

### 10.1 TypeScriptä»£ç è§„èŒƒ

#### ä¸¥æ ¼ç±»å‹æ£€æŸ¥é…ç½®
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noImplicitThis": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true,
    "noPropertyAccessFromIndexSignature": true,
    "noUncheckedIndexedAccess": true
  }
}
```

#### æ¥å£è®¾è®¡è§„èŒƒ
```typescript
// âœ… å¥½çš„æ¥å£è®¾è®¡
interface ApiResponse<T = any> {
  success: boolean;
  data?: T;
  message?: string;
  error?: string;
  code?: string;
}

// âœ… ä¸¥æ ¼çš„ç”¨æˆ·ç±»å‹å®šä¹‰
interface AuthUser {
  readonly userId: string;
  readonly username: string;
  readonly name: string;
  readonly displayName?: string;
  readonly email?: string;
  readonly role: 'TEACHER' | 'ADMIN' | 'STUDENT';
  readonly schoolId: string;
  readonly schoolName?: string;
  readonly primaryClassName?: string;
}

// âœ… ä½¿ç”¨è”åˆç±»å‹è€Œä¸æ˜¯æšä¸¾
type ViewMode = 'MY_STUDENTS' | 'ALL_SCHOOL' | 'SPECIFIC_CLASS';
type TaskStatus = 'PENDING' | 'SUBMITTED' | 'REVIEWED' | 'COMPLETED';
type TaskType = 'TASK' | 'QC' | 'SPECIAL';
```

### 10.2 é”™è¯¯å¤„ç†è§„èŒƒ

#### è‡ªå®šä¹‰é”™è¯¯ç±»
```typescript
// errors/base-error.ts
export abstract class BaseError extends Error {
  public readonly statusCode: number;
  public readonly code: string;
  public readonly isOperational: boolean;
  public readonly context?: any;

  constructor(
    message: string,
    statusCode: number = 500,
    code: string = 'INTERNAL_ERROR',
    isOperational: boolean = true,
    context?: any
  ) {
    super(message);

    this.statusCode = statusCode;
    this.code = code;
    this.isOperational = isOperational;
    this.context = context;

    // ç¡®ä¿é”™è¯¯å †æ ˆæ­£ç¡®
    Error.captureStackTrace(this, this.constructor);
  }
}

// å…·ä½“é”™è¯¯ç±»
export class ValidationError extends BaseError {
  constructor(message: string, context?: any) {
    super(message, 400, 'VALIDATION_ERROR', true, context);
  }
}

export class AuthenticationError extends BaseError {
  constructor(message: string = 'Authentication failed') {
    super(message, 401, 'AUTHENTICATION_ERROR', true);
  }
}

export class NotFoundError extends BaseError {
  constructor(resource: string, id?: string) {
    const message = id ? `${resource} with id ${id} not found` : `${resource} not found`;
    super(message, 404, 'NOT_FOUND', true);
  }
}
```

### 10.3 æ•°æ®éªŒè¯è§„èŒƒ

#### è¯·æ±‚ä½“éªŒè¯
```typescript
// validation/schemas.ts
import { z } from 'zod';

// å­¦ç”Ÿç›¸å…³éªŒè¯
export const createStudentSchema = z.object({
  name: z.string()
    .min(1, 'Name is required')
    .max(50, 'Name must be less than 50 characters'),
  className: z.string()
    .max(50, 'Class name must be less than 50 characters')
    .optional(),
  schoolId: z.string().uuid(),
  teacherId: z.string().uuid().optional()
});

// ç§¯åˆ†æ›´æ–°éªŒè¯
export const updateScoreSchema = z.object({
  studentIds: z.array(z.string().uuid()).min(1, 'At least one student ID is required'),
  points: z.number(),
  exp: z.number().min(0, 'Experience points must be non-negative'),
  reason: z.string()
    .min(1, 'Reason is required')
    .max(200, 'Reason must be less than 200 characters'),
  category: z.enum(['I', 'II', 'III', 'IV', 'V', 'VI', 'CUSTOM'], {
    errorMap: () => ({ message: 'Invalid category' })
  })
});
```

---

## 11. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 11.1 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

#### æŸ¥è¯¢ä¼˜åŒ–
```typescript
// âœ… ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
const getStudentsOptimized = async (schoolId: string, teacherId?: string) => {
  // ä½¿ç”¨å¤åˆç´¢å¼•ï¼š(schoolId, teacherId, isActive)
  return await prisma.student.findMany({
    where: {
      schoolId,
      ...(teacherId && { teacherId }),
      isActive: true
    },
    select: {
      // åªé€‰æ‹©éœ€è¦çš„å­—æ®µ
      id: true,
      name: true,
      className: true,
      points: true,
      exp: true,
      level: true,
      avatarUrl: true,
      // åŒ…å«å…³è”çš„æ•™å¸ˆä¿¡æ¯ï¼ˆä½¿ç”¨selectå‡å°‘æ•°æ®ä¼ è¾“ï¼‰
      teacher: {
        select: {
          id: true,
          name: true
        }
      }
    },
    orderBy: [
      { exp: 'desc' }, // ä½¿ç”¨ç´¢å¼•æ’åº
      { name: 'asc' }
    ],
    // åˆ†é¡µå¤„ç†
    take: 50,
    skip: 0
  });
};
```

#### è¿æ¥æ± é…ç½®
```typescript
// æ•°æ®åº“è¿æ¥é…ç½®
export const prisma = new PrismaClient({
  datasources: {
    db: {
      url: process.env.DATABASE_URL
    }
  },
  log: ['query', 'info', 'warn', 'error'],
  errorFormat: 'pretty'
});
```

### 11.2 ç¼“å­˜ç­–ç•¥

#### Redisç¼“å­˜å®ç°
```typescript
// cache/redis-cache.ts
export class RedisCache {
  private client: Redis;

  constructor() {
    this.client = new Redis({
      host: process.env.REDIS_HOST || 'localhost',
      port: parseInt(process.env.REDIS_PORT || '6379'),
      password: process.env.REDIS_PASSWORD,
      retryDelayOnFailover: 100,
      maxRetriesPerRequest: 3,
      lazyConnect: true
    });
  }

  async get<T>(key: string): Promise<T | null> {
    try {
      const value = await this.client.get(key);
      return value ? JSON.parse(value) : null;
    } catch (error) {
      console.error('Cache get error:', error);
      return null;
    }
  }

  async set(key: string, value: any, ttl: number = 3600): Promise<void> {
    try {
      await this.client.setex(key, ttl, JSON.stringify(value));
    } catch (error) {
      console.error('Cache set error:', error);
    }
  }
}

export const cache = new RedisCache();
```

#### ç¼“å­˜è£…é¥°å™¨
```typescript
// decorators/cache.ts
export function Cache(ttl: number = 3600, keyPrefix: string = '') {
  return function (target: any, propertyName: string, descriptor: PropertyDescriptor) {
    const method = descriptor.value;

    descriptor.value = async function (...args: any[]) {
      // ç”Ÿæˆç¼“å­˜é”®
      const cacheKey = `${keyPrefix}:${propertyName}:${JSON.stringify(args)}`;

      // å°è¯•ä»ç¼“å­˜è·å–
      const cachedResult = await cache.get(cacheKey);
      if (cachedResult !== null) {
        return cachedResult;
      }

      // æ‰§è¡ŒåŸæ–¹æ³•
      const result = await method.apply(this, args);

      // å­˜å…¥ç¼“å­˜
      await cache.set(cacheKey, result, ttl);

      return result;
    };

    return descriptor;
  };
}

// ä½¿ç”¨ç¤ºä¾‹
export class StudentService {
  @Cache(1800, 'students') // ç¼“å­˜30åˆ†é’Ÿ
  async getStudentsBySchool(schoolId: string): Promise<Student[]> {
    return await this.prisma.student.findMany({
      where: { schoolId, isActive: true },
      orderBy: { name: 'asc' }
    });
  }
}
```

### 11.3 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### ç»„ä»¶æ‡’åŠ è½½
```typescript
// è·¯ç”±æ‡’åŠ è½½
import { lazy, Suspense } from 'react';

// æ‡’åŠ è½½ç»„ä»¶
const Home = lazy(() => import('../pages/Home'));
const StudentDetail = lazy(() => import('../pages/StudentDetail'));
const PrepView = lazy(() => import('../pages/PrepView'));

const AppRouter: React.FC = () => {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/student/:id" element={<StudentDetail />} />
        <Route path="/prep" element={<PrepView />} />
      </Routes>
    </Suspense>
  );
};
```

---

## 12. æœªæ¥æŠ€æœ¯æ¼”è¿›

### 12.1 å¾®æœåŠ¡æ¶æ„æ¼”è¿›

#### æœåŠ¡æ‹†åˆ†ç­–ç•¥
```typescript
// æœåŠ¡è¾¹ç•Œå®šä¹‰
interface ServiceBoundaries {
  // ç”¨æˆ·æœåŠ¡ - å¤„ç†è®¤è¯ã€æˆæƒã€ç”¨æˆ·ç®¡ç†
  userService: {
    authentication: boolean;
    authorization: boolean;
    userManagement: boolean;
  };

  // å­¦ç”ŸæœåŠ¡ - å¤„ç†å­¦ç”Ÿæ•°æ®ã€ç§¯åˆ†ç®¡ç†
  studentService: {
    studentCRUD: boolean;
    scoreManagement: boolean;
    progressTracking: boolean;
  };

  // LMSæœåŠ¡ - å¤„ç†æ•™å­¦è®¡åˆ’ã€ä»»åŠ¡ç®¡ç†
  lmsService: {
    lessonPlanning: boolean;
    taskManagement: boolean;
    contentDelivery: boolean;
  };

  // åˆ†ææœåŠ¡ - å¤„ç†æ•°æ®åˆ†æã€æŠ¥å‘Šç”Ÿæˆ
  analyticsService: {
    dataAggregation: boolean;
    reportGeneration: boolean;
    insights: boolean;
  };

  // é€šçŸ¥æœåŠ¡ - å¤„ç†å®æ—¶é€šçŸ¥ã€æ¶ˆæ¯æ¨é€
  notificationService: {
    realTimeUpdates: boolean;
    emailNotifications: boolean;
    pushNotifications: boolean;
  };
}
```

### 12.2 äººå·¥æ™ºèƒ½é›†æˆ

#### æ™ºèƒ½æ¨èç³»ç»Ÿ
```typescript
// ai/recommendation-engine.ts
export class RecommendationEngine {
  /**
   * åŸºäºååŒè¿‡æ»¤çš„ä»»åŠ¡æ¨è
   */
  async getCollaborativeRecommendations(studentId: string): Promise<TaskRecommendation[]> {
    // è·å–ç›¸ä¼¼å­¦ç”Ÿçš„å®Œæˆæƒ…å†µ
    const similarStudents = await this.findSimilarStudents(studentId);

    // æ¨èç›¸ä¼¼å­¦ç”Ÿå®Œæˆä½†å½“å‰å­¦ç”Ÿæœªå®Œæˆçš„ä»»åŠ¡
    const recommendations = await this.generateRecommendations(
      studentId,
      similarStudents
    );

    return recommendations;
  }

  /**
   * æ··åˆæ¨èç®—æ³•
   */
  async getHybridRecommendations(studentId: string): Promise<TaskRecommendation[]> {
    const studentProfile = await this.getStudentProfile(studentId);

    // å¹¶è¡Œè·å–ä¸¤ç§æ¨èç»“æœ
    const [collaborativeRecs, contentBasedRecs] = await Promise.all([
      this.getCollaborativeRecommendations(studentId),
      this.getContentBasedRecommendations(studentProfile)
    ]);

    // åŠ æƒåˆå¹¶æ¨èç»“æœ
    const hybridRecommendations = this.combineRecommendations(
      collaborativeRecs,
      contentBasedRecs,
      { collaborative: 0.6, contentBased: 0.4 }
    );

    return hybridRecommendations;
  }
}
```

### 12.3 å¤§æ•°æ®åˆ†æå¹³å°

#### æ•°æ®ä»“åº“æ¶æ„
```typescript
// analytics/data-warehouse.ts
export class DataWarehouse {
  /**
   * å­¦ç”Ÿå­¦ä¹ è¡Œä¸ºåˆ†æ
   */
  async analyzeStudentBehavior(studentId: string, timeRange: TimeRange): Promise<StudentBehaviorAnalysis> {
    const query = `
      WITH daily_activity AS (
        SELECT
          DATE(created_at) as date,
          COUNT(*) as task_count,
          SUM(exp_awarded) as exp_gained,
          AVG(completion_time) as avg_completion_time
        FROM task_records
        WHERE student_id = $1
          AND created_at BETWEEN $2 AND $3
          AND status = 'COMPLETED'
        GROUP BY DATE(created_at)
      )
      SELECT
        COUNT(*) as total_active_days,
        AVG(task_count) as avg_daily_tasks,
        SUM(exp_gained) as total_exp,
        AVG(avg_completion_time) as avg_completion_time
      FROM daily_activity
    `;

    return await this.warehouseClient.query(query, [studentId, timeRange.start, timeRange.end]);
  }
}
```

### 12.4 ç§»åŠ¨ç«¯æ‰©å±•

#### React Nativeåº”ç”¨æ¶æ„
```typescript
// mobile/App.tsx
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

import TabNavigator from './navigation/TabNavigator';
import AuthNavigator from './navigation/AuthNavigator';
import { useAuth } from './hooks/useAuth';

const Stack = createNativeStackNavigator();
const queryClient = new QueryClient();

const App: React.FC = () => {
  const { user, isAuthenticated } = useAuth();

  return (
    <QueryClientProvider client={queryClient}>
      <NavigationContainer>
        <Stack.Navigator screenOptions={{ headerShown: false }}>
          {isAuthenticated ? (
            <Stack.Screen name="Main" component={TabNavigator} />
          ) : (
            <Stack.Screen name="Auth" component={AuthNavigator} />
          )}
        </Stack.Navigator>
      </NavigationContainer>
    </QueryClientProvider>
  );
};

export default App;
```

---

## æ€»ç»“

ArkOK V2æŠ€æœ¯æ¶æ„ä¸åŠŸèƒ½è¯´æ˜ç™½çš®ä¹¦è¯¦ç»†é˜è¿°äº†ç³»ç»Ÿçš„ç°ä»£åŒ–æŠ€æœ¯æ ˆé€‰æ‹©ã€æ ¸å¿ƒæ¶æ„è®¾è®¡ã€å®‰å…¨æœºåˆ¶ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å’Œæœªæ¥æ¼”è¿›æ–¹å‘ã€‚

### æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹ï¼š

1. **ç»Ÿä¸€æ‰˜ç®¡æ¶æ„**: ç®€åŒ–éƒ¨ç½²è¿ç»´ï¼Œæä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ
2. **å¸ˆç”Ÿç»‘å®šå®‰å…¨æ¨¡å‹**: åŸºäºè§’è‰²çš„ç»†ç²’åº¦æƒé™æ§åˆ¶
3. **åŒé‡ä»»åŠ¡åˆ†ç±»ä½“ç³»**: æ•™è‚²ä½“ç³»ä¸è¿è¥æ ‡ç­¾çš„å®Œç¾ç»“åˆ
4. **å®æ—¶é€šä¿¡ç³»ç»Ÿ**: Socket.ioé©±åŠ¨çš„å³æ—¶æ•°æ®åŒæ­¥
5. **TypeScriptç±»å‹å®‰å…¨**: ç¡®ä¿ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡
6. **Prisma ORMé›†æˆ**: ç±»å‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œ
7. **ç»„ä»¶åŒ–å‰ç«¯æ¶æ„**: React 19 + ç°ä»£åŒ–å¼€å‘å·¥å…·é“¾

### ç³»ç»Ÿä¼˜åŠ¿ï¼š

- **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡æ”¯æŒåŠŸèƒ½æ‰©å±•å’Œæ¶æ„æ¼”è¿›
- **å®‰å…¨æ€§**: å¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤å’Œæƒé™æ§åˆ¶
- **æ€§èƒ½**: æ•°æ®åº“ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥å’Œå‰ç«¯æ€§èƒ½ä¼˜åŒ–
- **å¯ç»´æŠ¤æ€§**: ä¸¥æ ¼çš„ä»£ç è§„èŒƒå’Œå®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **ç”¨æˆ·ä½“éªŒ**: å®æ—¶æ•°æ®åŒæ­¥å’Œå“åº”å¼ç•Œé¢è®¾è®¡

### æŠ€æœ¯åˆ›æ–°ï¼š

- **æ¸¸æˆåŒ–å­¦ä¹ **: ç§¯åˆ†å’Œç»éªŒå€¼ç³»ç»Ÿæ¿€åŠ±å­¦ç”Ÿå­¦ä¹ 
- **æ™ºèƒ½æ¨è**: åŸºäºååŒè¿‡æ»¤å’Œå†…å®¹åˆ†æçš„ä¸ªæ€§åŒ–æ¨è
- **æ•°æ®é©±åŠ¨**: å®Œæ•´çš„å­¦ä¹ æ•°æ®æ”¶é›†å’Œåˆ†æèƒ½åŠ›
- **è·¨å¹³å°**: ç»Ÿä¸€çš„Webåº”ç”¨å’Œç§»åŠ¨ç«¯æ”¯æŒ

ArkOK V2ä¸ä»…æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„æ•™è‚²ç®¡ç†å¹³å°ï¼Œæ›´æ˜¯ç°ä»£æ•™è‚²ç§‘æŠ€æŠ€æœ¯çš„æœ€ä½³å®è·µå±•ç¤ºï¼Œä¸ºK-12æ•™è‚²æ•°å­—åŒ–è½¬å‹æä¾›äº†å®Œæ•´çš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆã€‚

---

**ç™½çš®ä¹¦ç‰ˆæœ¬**: v2.0.0
**æœ€åæ›´æ–°**: 2025-12-18
**æŠ€æœ¯æ¶æ„**: ç»Ÿä¸€æ‰˜ç®¡ + å¾®æœåŠ¡å°±ç»ª
**æŠ€æœ¯æ ˆ**: React 19 + TypeScript + Prisma + Express.js