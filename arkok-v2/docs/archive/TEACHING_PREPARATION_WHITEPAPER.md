# 📚 ArkOK V2 教学备课白皮书

**版本:** 1.2.0
**日期:** 2025-12-18
**状态:** 🟢 生产就绪
**更新内容:**
- ✅ 完整的82个任务库双重分类体系
- ✅ 核心教学法9大维度分组实现
- ✅ 数据库设计与映射机制说明
- ✅ 前后端智能分组逻辑详解
- 🆕 **学生个人详情页学期地图功能**: 实现按单元课时升序排列的动态学期地图
- 🆕 **ArkOK V2技术宪法合规修复**: 完成数据库访问规范的宪法合规性修复
- 🆕 **数据持久化改进**: 修复备课页数据持久化问题，确保数据一致性

---

## 📋 目录

- [第一部分：备课系统概述](#第一部分备课系统概述)
- [第二部分：双重分类体系](#第二部分双重分类体系)
- [第三部分：核心教学法任务库](#第三部分核心教学法任务库)
- [第四部分：备课操作指南](#第四部分备课操作指南)
- [第五部分：学期地图功能详解](#第五部分学期地图功能详解)
- [第六部分：测试令牌与API使用](#第六部分测试令牌与api使用)
- [第七部分：技术规范与宪法合规](#第七部分技术规范与宪法合规)

---

## 第一部分：备课系统概述

ArkOK V2 备课系统是教师进行教学设计的核心工具，支持：

- **智能任务推荐**: 基于学生学情和能力水平，自动推荐适合的教学任务
- **双重分类体系**: 教育体系分类与运营标签分类并行，满足不同场景需求
- **个性化备课**: 教师可根据班级特点和学生个体差异，灵活调整任务配置
- **实时数据同步**: 备课结果与过关页、数据大屏实时同步

### 系统架构特点

1. **统一任务库**: 82个精心设计的教学任务，涵盖9大运营标签和3大教育体系
2. **智能分类**: 根据使用场景自动切换分类逻辑（备课页使用教育体系分类，过关页使用运营标签）
3. **双重映射**: 前后端智能字段映射，确保数据结构统一兼容
4. **经验值激励**: 每个任务都有对应的经验值，激励学生完成挑战

---

## 第二部分：双重分类体系

### 教育体系分类（备课页使用）

#### 1. 核心教学法 (Core Teaching Methodology)
**数据库分类标识**: `category: '核心教学法'`
**前端分组逻辑**: 按9大教学法维度智能分组
**任务数量**: 38个任务

分为9大教学法维度：

**一、基础学习方法论** (5个任务)
- 作业的自主检查: 培养学生自我纠错与质量监控能力
- 错题的红笔订正: 强化对错误点的视觉记忆与反思
- 错题的摘抄与归因: 深度分析错误根源，从"会做"到"会讲"
- 用"三色笔法"整理作业: 训练信息分层与知识结构化能力
- 自评当日作业质量: 引导学生进行元认知反思，提升自我要求

**二、数学思维与解题策略** (7个任务)
- 5道旧错题的重做练习: 巩固薄弱环节，检验真懂假懂
- 一项老师定制的数学拓展任务: 个性化拔高，激发数学兴趣
- 一道"说题"练习: 口头讲解解题思路，检验逻辑清晰度
- 找一道生活中的数学问题: 培养数学建模与应用意识
- 高阶：母题归纳: 训练抽象思维，从题海中提炼核心解题模型
- 高阶：错题主动重做: 培养主动复盘、自我驱动的学习习惯
- 高阶：应用解题模型表: 结构化、流程化地攻克难题

**三、语文学科能力深化** (6个任务)
- 仿写课文中的一个好句: 迁移应用，提升语言表达能力
- 为当天生字编顺口溜或故事: 创造性联想，深化汉字记忆
- 运用阅读理解解题模板: 学习并实践结构化的阅读分析方法
- 查字典（查一查·读一读）: 培养严谨的工具使用习惯和深度学习能力
- 分类组词与辨析（组一组·辨一辨）: 训练辨析思维和语言精确性
- 联想记忆法（想一想·记一记）: 运用多元记忆策略

**四、英语应用与输出** (2个任务)
- 用今日单词编小对话: 驱动语言的实际应用与输出
- 制作单词卡: 结合图像与例句，构建多感官记忆

**五、阅读深度与分享** (3个任务)
- 好词金句赏析: 培养审美与批判性思维
- 画人物关系图/预测情节: 训练逻辑推理与文本结构分析能力
- 录制阅读小分享: 锻炼口头表达与知识复述能力

**六、自主学习与规划** (4个任务)
- 自主规划"复习"任务: 培养回顾与巩固的元学习能力
- 自主规划"预习"任务: 培养前瞻性学习与问题意识
- 制定学习小计划: 训练目标设定与时间管理能力
- 设定并完成改进目标: 培养自我监控与成长的内驱力

**七、课堂互动与深度参与** (5个任务)
- 主动举手回答问题: 提升课堂参与感与自信心
- 每节课准备一个问题: 培养批判性思维与深度思考习惯
- 主动申请课堂角色: 锻炼公众表达与责任担当
- 记录老师金句并写理解: 训练信息抓取与内化能力
- 帮助同桌理解知识点: 通过"教"来巩固自己的"学"

**八、家庭联结与知识迁移** (5个任务)
- 向家长讲解学习方法: 强化自身理解，建立家庭正向沟通
- 教家人一个新知识: 检验知识掌握的最高标准——能教会别人
- 主动展示复习成果: 培养成果意识与积极的反馈循环
- 分享"改进目标"完成情况: 建立家庭支持系统，强化承诺
- 用数学解决家庭问题: 终极目标——学以致用

**九、高阶输出与创新** (1个任务)
- 录制"小老师"视频: 综合运用知识、表达、技术能力的顶点任务

#### 2. 综合成长 (Comprehensive Growth)
**数据库分类标识**: `category: '综合成长'`
**前端分组逻辑**: 按4大类重新分组显示
**任务数量**: 14个任务

**阅读广度类** (2个任务)
- 年级同步阅读
- 课外阅读30分钟
- 填写阅读记录单
- 阅读一个成语故事，并积累掌握3个成语

**整理与贡献类** (5个任务)
- 离校前的个人卫生清理（桌面/抽屉/地面）
- 离校前的书包整理
- 一项集体贡献任务（浇花/整理书架/打扫等）
- 吃饭时帮助维护秩序，确认光盘，地面保持干净
- 为班级图书角推荐一本书，并写一句推荐语

**互助与创新类** (3个任务)
- 帮助同学（讲解/拍视频/打印等）
- 一项创意表达任务（画画/写日记/做手工等）
- 一项健康活力任务（眼保健操/拉伸/深呼吸/跳绳等）

**家庭联结类** (1个任务)
- 与家人共读30分钟（可亲子读、兄弟姐妹读、给长辈读）
- 帮家里完成一项力所能及的家务（摆碗筷、倒垃圾/整理鞋柜等）

#### 3. 基础作业 (Basic Homework)
**数据库分类标识**: `category: '基础作业'`
**任务数量**: 7个任务

包含基础学习任务，确保学生掌握核心知识：

- **数学作业**: 口算练习、完成数学书面作业
- **语文作业**: 生字/词语的听写练习、课文朗读练习、完成语文书面作业
- **英语作业**: 单词的默写练习、完成英语书面作业

### 数据库设计说明

#### 任务库表结构 (task_library)

```sql
CREATE TABLE task_library (
  id VARCHAR(36) PRIMARY KEY,
  -- 🏷️ 运营标签分类（过关页使用）
  category VARCHAR(50) NOT NULL,

  -- 📚 教育体系分类（备课页使用）
  educationalDomain VARCHAR(50) DEFAULT '基础作业',
  educationalSubcategory VARCHAR(50) DEFAULT '基础核心',

  name VARCHAR(255) NOT NULL,
  description TEXT,
  defaultExp INTEGER DEFAULT 0,
  type VARCHAR(20) DEFAULT 'TASK',
  difficulty INTEGER,
  isActive BOOLEAN DEFAULT true,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 字段映射机制

**后端映射** (lms.service.ts):
```typescript
return tasks.map(task => ({
  id: task.id,
  // 🏷️ 运营标签分类（过关页使用）
  category: task.category,

  // 📚 教育体系分类（备课页使用）- 适配现有数据库结构
  educationalDomain: task.category, // 使用category作为educationalDomain
  educationalSubcategory: task.category, // 使用category作为educationalSubcategory

  name: task.name,
  description: task.description || '',
  defaultExp: task.defaultExp,
  type: task.type,
  difficulty: task.difficulty || 0,
  isActive: task.isActive
}));
```

**前端分组逻辑** (PrepView.tsx):
- **核心教学法**: 按9大教学法维度智能分组（基于任务名称精确匹配）
- **综合成长**: 按4大类重新分组（基于任务名称映射）
- **基础作业**: 直接按category字段分组

### 运营标签分类（过关页使用）

**总任务数**: 82个
**分类覆盖率**: 100%

1. **基础作业** (7个任务): 数学、语文、英语书面作业
2. **语文** (3个任务): 生字听写、课文背诵、词语解释
3. **数学** (2个任务): 几何图形、应用题解答
4. **英语** (3个任务): 听力理解、句型练习、单词背诵
5. **阅读** (3个任务): 课外阅读、阅读理解、读书笔记
6. **自主性** (3个任务): 预习明日课程、复习今日所学、制定学习计划
7. **特色教学** (3个任务): 创新思维训练、实验操作、项目制作
8. **学校** (3个任务): 课堂表现、小组合作、班级服务
9. **家庭** (3个任务): 家务劳动、家庭实验、亲子阅读

---

## 第三部分：核心教学法任务库

### 基础学习方法论（5个任务）

| 任务名称 | 经验值 | 难度 | 教学目标 |
|---------|--------|------|----------|
| 作业的自主检查 | 10 | 2 | 培养自我纠错与质量监控能力 |
| 错题的红笔订正 | 10 | 2 | 强化对错误点的视觉记忆与反思 |
| 错题的摘抄与归因 | 15 | 3 | 深度分析错误根源，从"会做"到"会讲" |
| 用"三色笔法"整理作业 | 10 | 2 | 训练信息分层与知识结构化能力 |
| 自评当日作业质量 | 10 | 2 | 引导学生进行元认知反思，提升自我要求 |

### 数学思维与解题策略（7个任务）

| 任务名称 | 经验值 | 难度 | 教学目标 |
|---------|--------|------|----------|
| 100道口算练习 | 10 | 2 | 提升计算速度和准确性 |
| 5道旧错题（1星）的重做练习 | 20 | 2 | 巩固薄弱环节，检验真懂假懂 |
| 一项老师定制的数学拓展任务 | 20 | 3 | 个性化拔高，激发数学兴趣 |
| 找一道生活中的数学问题并尝试解决 | 20 | 3 | 培养数学建模与应用意识 |
| 一道"说题"练习：口头讲解解题思路 | 30 | 4 | 检验逻辑清晰度，培养表达能力 |
| 高阶任务：从课本和练习中找出1类"母题" | 100 | 5 | 训练抽象思维，提炼核心解题模型 |
| 高阶任务：主动重做一遍昨天的错题 | 100 | 5 | 培养主动复盘、自我驱动的学习习惯 |

### 语文学科能力深化（6个任务）

| 任务名称 | 经验值 | 难度 | 教学目标 |
|---------|--------|------|----------|
| 生字/词语的听写练习 | 10 | 2 | 巩固基础字词掌握 |
| 听写错字的补写练习 | 15 | 3 | 针对性强化薄弱字词 |
| 一组"看拼音写词语"与"给生字注音"练习 | 10 | 2 | 拼音与汉字双向能力训练 |
| 课文重点知识的问答过关 | 20 | 3 | 检验课文理解与记忆效果 |
| 课文填空/古诗的背诵练习 | 20 | 3 | 培养语感与记忆能力 |
| 课文填空/古诗的默写练习 | 20 | 3 | 准确书写与记忆的双重训练 |

### 英语应用与输出（4个任务）

| 任务名称 | 经验值 | 难度 | 教学目标 |
|---------|--------|------|----------|
| 单词的默写练习 | 15 | 2 | 巩固单词拼写掌握 |
| 课文的朗读练习（10分钟） | 10 | 1 | 培养语感与发音准确性 |
| 用今日单词编一个3句话的小对话 | 25 | 3 | 驱动语言的实际应用与输出 |
| 制作一张单词卡 | 30 | 3 | 结合图像与例句，构建多感官记忆 |

### 阅读深度与分享（3个任务）

| 任务名称 | 经验值 | 难度 | 教学目标 |
|---------|--------|------|----------|
| 摘抄3个好词和1个金句，并简单说说"为什么好" | 30 | 3 | 培养审美与批判性思维 |
| 为所读内容画人物关系图或预测后续情节 | 25 | 3 | 训练逻辑推理与文本结构分析能力 |
| 录制一个1-2分钟的"阅读小分享" | 35 | 3 | 锻炼口头表达与知识复述能力 |

### 自主学习与规划（4个任务）

| 任务名称 | 经验值 | 难度 | 教学目标 |
|---------|--------|------|----------|
| 自主规划并完成一项"复习"任务 | 20 | 3 | 培养回顾与巩固的元学习能力 |
| 自主规划并完成一项"预习"任务 | 20 | 3 | 培养前瞻性学习与问题意识 |
| 为明天/本周制定一个学习小计划 | 20 | 3 | 训练目标设定与时间管理能力 |
| 设定一个自己的改进目标，并打卡完成 | 50 | 4 | 培养自我监控与成长的内驱力 |

### 课堂互动与深度参与（5个任务）

| 任务名称 | 经验值 | 难度 | 教学目标 |
|---------|--------|------|----------|
| 今天在课堂上至少举手回答1次问题 | 30 | 3 | 提升课堂参与感与自信心 |
| 每节课准备1个有思考的问题，课后请教老师 | 35 | 3 | 培养批判性思维与深度思考习惯 |
| 主动申请一次板演/领读/小组汇报等课堂角色 | 35 | 3 | 锻炼公众表达与责任担当 |
| 记录老师今天讲的1个"金句"或方法 | 30 | 3 | 训练信息抓取与内化能力 |
| 帮助同桌理解一个课堂没听懂的知识点 | 30 | 3 | 通过"教"来巩固自己的"学" |

### 家庭联结与知识迁移（5个任务）

| 任务名称 | 经验值 | 难度 | 教学目标 |
|---------|--------|------|----------|
| 向家长讲解1个今天学到的学习方法 | 50 | 4 | 强化自身理解，建立家庭正向沟通 |
| 教家人一个今天学的新词/成语/英语句子 | 50 | 3 | 检验知识掌握的最高标准——能教会别人 |
| 复习本周所有基础知识...主动给爸妈看 | 100 | 4 | 培养成果意识与积极的反馈循环 |
| 和父母分享今天的"改进目标"完成情况 | 100 | 4 | 建立家庭支持系统，强化承诺 |
| 用数学知识解决一个家庭小问题 | 30 | 2 | 终极目标——学以致用 |

### 高阶输出与创新（3个任务）

| 任务名称 | 经验值 | 难度 | 教学目标 |
|---------|--------|------|----------|
| 录制一个60秒"小老师"视频 | 50 | 4 | 综合运用知识、表达、技术能力的顶点任务 |
| 高阶任务：用解题模型表，完整独立练习一道难题 | 50 | 4 | 结构化、流程化地攻克难题 |
| 仿写课文中的一个好句 | 30 | 3 | 迁移应用，提升语言表达能力 |

---

## 第四部分：备课操作指南

### 1. 访问备课页面

- **公网地址**: https://esboimzbkure.sealosbja.site/prep
- **本地开发**: http://localhost:3000/prep

### 2. 任务选择流程

1. **登录系统**: 使用教师账号登录
2. **选择分类**: 在核心教学法、综合成长、基础作业之间切换
3. **浏览任务**: 查看各分类下的详细任务列表
4. **筛选过滤**: 根据难度、经验值、学科等维度筛选
5. **任务分配**: 选择适合的任务分配给特定学生或班级

### 3. 备课最佳实践

- **因材施教**: 根据学生实际水平选择合适难度的任务
- **均衡发展**: 确保学生在各个分类领域都有涉及
- **循序渐进**: 从基础任务开始，逐步增加难度
- **及时反馈**: 关注学生完成情况，调整备课策略

### 4. 数据监控

- **任务完成率**: 监控各类任务的完成情况
- **学生进步**: 通过经验值变化追踪学生成长
- **教学效果**: 分析任务选择与学习成果的关联性

---

## 第五部分：测试令牌与API使用

### JWT测试令牌

为了方便开发和测试，系统提供了一个长期有效的测试令牌：

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTAwMSIsInNjaG9vbElkIjoiYXJrb2stdjItZGVtbyIsInJvbGUiOiJ0ZWFjaGVyIiwidXNlcm5hbWUiOiJkZW1vLXRlYWNoZXIiLCJpYXQiOjE3NjU5NzQxODMsImV4cCI6MTc2NjU3ODk4M30.LdSoufpL6-GEQpmmesmgqijKKVqzgXEpEXceINrnHBM",
  "userInfo": {
    "userId": "teacher-001",
    "schoolId": "arkok-v2-demo",
    "role": "teacher",
    "username": "demo-teacher"
  },
  "expiresIn": "7天",
  "generatedAt": "2025-12-17"
}
```

### 使用方法

1. **浏览器开发者工具**:
   ```javascript
   // 在浏览器控制台执行
   localStorage.setItem('authToken', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTAwMSIsInNjaG9vbElkIjoiYXJrb2stdjItZGVtbyIsInJvbGUiOiJ0ZWFjaGVyIiwidXNlcm5hbWUiOiJkZW1vLXRlYWNoZXIiLCJpYXQiOjE3NjU5NzQxODMsImV4cCI6MTc2NjU3ODk4M30.LdSoufpL6-GEQpmmesmgqijKKVqzgXEpEXceINrnHBM');
   localStorage.setItem('user', JSON.stringify({
     "userId": "teacher-001",
     "schoolId": "arkok-v2-demo",
     "role": "teacher",
     "username": "demo-teacher"
   }));
   ```

2. **API测试**:
   ```bash
   # 设置Authorization Header
   curl -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTAwMSIsInNjaG9vbElkIjoiYXJrb2stdjItZGVtbyIsInJvbGUiOiJ0ZWFjaGVyIiwidXNlcm5hbWUiOiJkZW1vLXRlYWNoZXIiLCJpYXQiOjE3NjU5NzQxODMsImV4cCI6MTc2NjU3ODk4M30.LdSoufpL6-GEQpmmesmgqijKKVqzgXEpEXceINrnHBM" \
     https://esboimzbkure.sealosbja.site/api/tasks/library
   ```

### 主要API端点

- **获取任务库**: `GET /api/tasks/library`
- **获取任务详情**: `GET /api/tasks/:id`
- **创建备课计划**: `POST /api/plans`
- **获取学生列表**: `GET /api/students`
- **发布任务**: `POST /api/tasks/assign`

### 注意事项

- 测试令仅供开发测试使用，生产环境请使用正式认证流程
- 令牌有效期为7天，过期后需要重新生成
- 使用测试令牌时，请确保schoolId为"arkok-v2-demo"

---

**🎯 备课系统的成功使用是提升教学质量的关键环节。通过合理运用核心教学法任务库，教师可以实现个性化、精准化的教学设计。**

---

## 第五部分：学期地图功能详解

### 🗺️ 学生个人详情页学期地图

学期地图是ArkOK V2中连接教师备课与学生学习的核心功能，实现了教学计划到学生端的无缝映射。

#### 功能特性

1. **动态学期地图生成**
   - 基于最新教学计划自动生成
   - 按单元课时升序排列显示课程
   - 实时同步备课页发布的课程内容

2. **智能排序算法**
   ```typescript
   // 🔄 按单元和课程号排序（升序）
   Object.values(timeline).forEach(lessons => {
     lessons.sort((a, b) => {
       // 先按单元排序
       if (a.unit !== b.unit) {
         return a.unit - b.unit;
       }
       // 单元相同时按课程号排序
       return (a.lesson || 1) - (b.lesson || 1);
     });
   });
   ```

3. **用户体验优化**
   - 教师发布一课，学生端即时呈现
   - 支持非连续发布（如先发布第4课，后发布第2课）
   - 自动按2、3、4升序排列显示

#### 技术实现

- **数据源**: 直接从 `lessonPlan.content.courseInfo` 获取课程信息
- **前端组件**: `StudentDetail.tsx` 中的学业攻克tab
- **API接口**: `/api/lms/student-progress` 和 `/api/lms/all-records`
- **状态管理**: React Hooks + Context API

---

## 第七部分：技术规范与宪法合规

### 📜 ArkOK V2技术宪法合规性

本系统严格遵循《ArkOK V2技术宪法》的所有规定：

#### 数据库访问规范（宪法第四条）

1. **服务层独占** ✅
   - 所有数据库操作仅在 `server/src/services/` 目录进行
   - 路由层纯净，无直接数据库查询代码

2. **自包含模式** ✅
   - 每个Service类内部自行实例化 `PrismaClient`
   - 修复前：`constructor(private prisma: PrismaClient) {}`
   - 修复后：`private prisma = new PrismaClient();`

3. **架构合规修复**
   ```typescript
   // 修复前（违宪）
   class LMSService {
     constructor(private prisma: PrismaClient) {}
   }

   // 修复后（合宪）
   class LMSService {
     private prisma = new PrismaClient();
   }
   ```

#### 前端交互规范（宪法第八条）

1. **API路径标准化** ✅
   - 所有API调用使用相对路径（如 `/students`）
   - `baseURL: '/api'` 统一配置

2. **UI状态管理** ✅
   - 拒绝暴力刷新，使用状态管理实现无感更新
   - 完整的加载、错误、空状态处理

3. **UI还原保障** ✅
   - 以 `_LEGACY_ARCHIVE_DO_NOT_TOUCH` 为最高参照
   - 保持UI一致性和用户体验

---

*本文档持续更新中...*

**最后更新:** 2025-12-18

---

## 🎯 版本更新日志

### v1.2.0 (2025-12-18)
- 🆕 **学期地图功能**: 实现学生个人详情页的动态学期地图
- 🆕 **智能排序算法**: 按单元课时升序排列，支持非连续发布
- 🆕 **宪法合规修复**: 完成数据库访问规范的技术宪法合规性修复
- 🆕 **数据持久化改进**: 修复备课页数据持久化问题
- 🆕 **API端点优化**: 新增 `/api/lms/student-progress` 和 `/api/lms/all-records`
- 🆕 **前端状态管理**: 完善的加载、错误、空状态处理机制

### v1.1.0 (2025-12-17)
- ✅ **重大更新**: 完整实现82个任务库的双重分类体系
- ✅ **核心教学法**: 9大教学法维度智能分组实现
- ✅ **数据库设计**: 详细的任务库表结构和映射机制
- ✅ **前后端逻辑**: 智能分组和字段映射完整实现
- ✅ **分类统计**: 100%覆盖率，38+14+7=59个核心任务
- ✅ **技术文档**: 完整的API响应标准和类型安全规范