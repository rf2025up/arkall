# ARKOK V2 功能说明手册

## 2025-12-26 更新日志

### 1. 全局 Header 视觉系统重塑 (QC 风格)
- **更新对象**: `StudentManagement.tsx` (学员管理), `TeacherManagement.tsx` (教师管理)
- **设计规范**:
  - 引入沉浸式大圆角背景，采用橙色渐变方案，视觉中心更聚焦。
  - 废除原有的悬浮式顶栏，改为随页面滚动的自然流式布局。
  - **组件精修**:
    - 移除通知铃铛图标，保持界面极简。
    - “添加学生/教师”按钮统一移至右侧，采用 **纯白药丸背景 + 橙色文字** 设计。
    - 图标加粗 (`strokeWidth={3}`)，增强视觉交互反馈。

### 2. 2025 版课纲数据全学段校核与重构
- **更新对象**: `curriculum.service.ts` (课纲服务层)
- **数据灌装范围**:
  - **语文 (PEP)**: 2-6 年级上册全面对齐 2025 新教材，包含《观潮》、《走月亮》、《白鹭》等核心课目及其配套语文园地。
  - **数学 (PEP)**: 3-6 年级上册全面重构，加入《曹冲称象》故事、综合实践活动及总复习模块。
  - **英语 (湘少版)**: 3 年级上册数据补全。
- **优化点**: 彻底清理了历史版本中的语数数据冲突，确保科目、版本、单元序号严格与 2025 秋季新教科书一致。

### 3. 个人详情页“过关地图”动态适配系统
- **更新对象**: `StudentDetail.tsx` (学生详情页)
- **核心逻辑**:
  - **1:1 动态格数**: 告别硬编码的 40 格，现在地图格数会自动根据实际课纲总课数动态呈现。
  - **分科目专属色系**:
    - **语文**: 采用橙红系方案 (`orange-500`)。
    - **数学**: 采用深蓝系方案 (`blue-500`)。
    - **英语**: 采用翠绿系方案 (`green-500`)。
  - **成就节点交互**:
    - 差异化着色：区分 QC 过关、核心教法、个性加餐。
    - 过关节点增加微动呼吸动画。
    - 鼠标悬浮格点时动态显示通过的具体任务名称及达成日期。

### 4. 师生关系转移功能 (抢人模式)
- **更新对象**: `StudentService` (后端), `StudentRoutes` (路由), `ApiService` (前端)
- **核心逻辑**:
  - **功能定位**: 允许老师从全校名单中批量将学生“抢”到自己名下（即由转班升级为抢人）。
  - **数据一致性**:
    - 自动更新学生的 `teacherId` 为目标老师 ID。
    - 自动同步学生的 `className` 为目标老师的 `primaryClassName`（或默认“老师姓名+班”）。
  - **全链路追踪**:
    - 自动创建类型为 `SPECIAL` 的任务记录，详细记录转移操作的发起人、来源老师及目标老师。
    - 触发 `STUDENTS_TRANSFERRED` Socket 事件，实现多端数据实时刷新。

---
*最后更新人: Antigravity AI*
*更新时间: 2025-12-26 23:25*

### 🆕 2025-12-26 晚间修复

#### 4.1 师生转移交互优化
- **更新对象**: `Home.tsx`
- **优化点**: 转移成功后自动切换至"我的班级"视图，用户无需手动切换即可看到新转入的学生。

#### 4.2 PC 端右键菜单支持
- **更新对象**: `Home.tsx`
- **优化点**: PC 端支持右键点击学生头像触发评分/转移菜单（替代移动端长按）。

#### 4.3 勋章发布功能修复
- **更新对象**: `schema.prisma`
- **问题描述**: 勋章发布时报 500 错误，原因是 `task_category` 字段使用了 `BADGE` 值，但该值未在 `TaskCategory` 枚举中定义。
- **修复方案**: 在 Prisma Schema 的 `TaskCategory` 枚举中新增 `BADGE` 值。
