<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StarJourney ç‹¬ç«‹åŠŸèƒ½æ¼”ç¤º</title>
    <link rel="stylesheet" href="/star-static/css/style.css">
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸŒŸ StarJourney åŠŸèƒ½æ¼”ç¤º</h1>
            <p>é”™é¢˜ç®¡ç† + è¿‡å…³ç®¡ç† + å­¦æƒ…ç»Ÿè®¡ ç‹¬ç«‹æµ‹è¯•å¹³å°</p>
        </div>

        <!-- æœåŠ¡å™¨çŠ¶æ€ -->
        <div class="server-status">
            <span class="status-indicator"></span>
            <span id="server-status">æ­£åœ¨æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...</span>
        </div>

        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="tabs">
            <button class="tab active" data-tab="overview">ğŸ“Š æ€»è§ˆ</button>
            <button class="tab" data-tab="records">ğŸ¯ è¿‡å…³ç®¡ç†</button>
            <button class="tab" data-tab="mistakes">ğŸ“ é”™é¢˜ç®¡ç†</button>
            <button class="tab" data-tab="students">ğŸ‘¥ å­¦ç”Ÿç»Ÿè®¡</button>
        </div>

        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="content">
            <!-- æ€»è§ˆæ ‡ç­¾é¡µ -->
            <div class="tab-content active" id="overview-content">
                <div class="grid">
                    <div class="grid-item card">
                        <div class="stat-number" id="total-records">-</div>
                        <div class="stat-label">è¿‡å…³è®°å½•</div>
                    </div>
                    <div class="grid-item card">
                        <div class="stat-number" id="passed-records">-</div>
                        <div class="stat-label">å·²é€šè¿‡ä»»åŠ¡</div>
                    </div>
                    <div class="grid-item card">
                        <div class="stat-number" id="total-attempts">-</div>
                        <div class="stat-label">æ€»å°è¯•æ¬¡æ•°</div>
                    </div>
                    <div class="grid-item card">
                        <div class="stat-number" id="total-mistakes">-</div>
                        <div class="stat-label">é”™é¢˜è®°å½•</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“‹ ç³»ç»ŸåŠŸèƒ½è¯´æ˜</h3>
                    </div>
                    <div class="card-body">
                        <h4>ğŸ¯ è¿‡å…³ç®¡ç† (æ ¸å¿ƒåŠŸèƒ½)</h4>
                        <ul>
                            <li><strong>è¾…å¯¼å°è¯•è®°å½•</strong>ï¼šä½“ç°æœåŠ¡ä»·å€¼ï¼Œè®°å½•å­¦ç”Ÿæ¯æ¬¡è¾…å¯¼å°è¯•</li>
                            <li><strong>ä»»åŠ¡çŠ¶æ€ç®¡ç†</strong>ï¼špending â†’ passedï¼Œæ”¯æŒå¤šè½®è¾…å¯¼</li>
                            <li><strong>ç»éªŒå€¼è®¡ç®—</strong>ï¼šæ ¹æ®ä»»åŠ¡éš¾åº¦å’Œå°è¯•æ¬¡æ•°åŠ¨æ€è®¡ç®—</li>
                            <li><strong>å›°éš¾ä»»åŠ¡æ ‡è®°</strong>ï¼šå°è¯•æ¬¡æ•°>2è‡ªåŠ¨æ ‡è®°ä¸º"ç¡¬éª¨å¤´"ä»»åŠ¡</li>
                        </ul>

                        <h4>ğŸ“ é”™é¢˜ç®¡ç†</h4>
                        <ul>
                            <li><strong>é”™é¢˜è®°å½•</strong>ï¼šæ”¯æŒå›¾ç‰‡ä¸Šä¼ å’ŒOCRè¯†åˆ«</li>
                            <li><strong>AIåˆ†æ</strong>ï¼šå‡ºé¢˜äººè§†è§’çš„æ·±åº¦åˆ†æ</li>
                            <li><strong>çŠ¶æ€è·Ÿè¸ª</strong>ï¼špending â†’ solved</li>
                            <li><strong>çŸ¥è¯†ç‚¹æ ‡ç­¾</strong>ï¼šä¾¿äºåˆ†ç±»ç»Ÿè®¡</li>
                        </ul>

                        <h4>ğŸ“Š å­¦æƒ…ç»Ÿè®¡</h4>
                        <ul>
                            <li><strong>äº”ç»´èƒ½åŠ›é›·è¾¾</strong>ï¼šè®¡ç®—ã€æ¦‚å¿µã€é€»è¾‘ã€å®¡é¢˜ã€åº”ç”¨</li>
                            <li><strong>å­¦ä¹ å»ºè®®</strong>ï¼šåŸºäºAIåˆ†æçš„ä¸ªæ€§åŒ–å»ºè®®</li>
                            <li><strong>è¿›åº¦è·Ÿè¸ª</strong>ï¼šè¯¾ç¨‹è¿›åº¦å’Œå­¦ä¹ è½¨è¿¹</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- è¿‡å…³ç®¡ç†æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="records-content">
                <!-- åˆ›å»ºè¿‡å…³è®°å½•è¡¨å• -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">â• åˆ›å»ºè¿‡å…³è®°å½•</h3>
                    </div>
                    <div class="card-body">
                        <form id="record-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>å­¦ç”ŸID</label>
                                    <input type="number" id="record-student-id" value="28" required>
                                </div>
                                <div class="form-group">
                                    <label>ä»»åŠ¡ç±»å‹</label>
                                    <select id="record-task-type" required>
                                        <option value="QC">è´¨æ£€</option>
                                        <option value="TASK">è¿‡ç¨‹ä»»åŠ¡</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ä»»åŠ¡åç§°</label>
                                    <input type="text" id="record-task-name" placeholder="å¦‚ï¼šå£ç®—è¾¾æ ‡" required>
                                </div>
                                <div class="form-group">
                                    <label>ç»éªŒå€¼</label>
                                    <input type="number" id="record-exp-value" value="10" min="1">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>å­¦ç§‘</label>
                                    <select id="record-subject">
                                        <option value="math">æ•°å­¦</option>
                                        <option value="chinese">è¯­æ–‡</option>
                                        <option value="english">è‹±è¯­</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>å•å…ƒ</label>
                                    <input type="number" id="record-unit" placeholder="å¦‚ï¼š1" min="1">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>è¯¾æ¬¡</label>
                                    <input type="number" id="record-lesson" placeholder="å¦‚ï¼š1" min="1">
                                </div>
                                <div class="form-group">
                                    <label>ä¸ªæ€§åŒ–åŠ é¤</label>
                                    <select id="record-special">
                                        <option value="false">å¦</option>
                                        <option value="true">æ˜¯</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>è¯¾ç¨‹æ ‡é¢˜</label>
                                <input type="text" id="record-title" placeholder="å¦‚ï¼š100ä»¥å†…åŠ å‡æ³•">
                            </div>
                            <button type="submit" class="btn btn-primary">åˆ›å»ºè®°å½•</button>
                        </form>
                    </div>
                </div>

                <!-- è¿‡å…³è®°å½•åˆ—è¡¨ -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“‹ è¿‡å…³è®°å½•åˆ—è¡¨</h3>
                        <button class="btn btn-secondary" onclick="loadRecords()">åˆ·æ–°</button>
                    </div>
                    <div class="card-body">
                        <div id="records-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                æ­£åœ¨åŠ è½½è®°å½•...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é”™é¢˜ç®¡ç†æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="mistakes-content">
                <!-- åˆ›å»ºé”™é¢˜è®°å½•è¡¨å• -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">â• åˆ›å»ºé”™é¢˜è®°å½•</h3>
                    </div>
                    <div class="card-body">
                        <form id="mistake-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>å­¦ç”ŸID</label>
                                    <input type="number" id="mistake-student-id" value="28" required>
                                </div>
                                <div class="form-group">
                                    <label>å­¦ç§‘</label>
                                    <select id="mistake-subject" required>
                                        <option value="math">æ•°å­¦</option>
                                        <option value="chinese">è¯­æ–‡</option>
                                        <option value="english">è‹±è¯­</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>é”™é¢˜æè¿°</label>
                                <textarea id="mistake-text" rows="4" placeholder="æè¿°é”™é¢˜å†…å®¹ï¼Œå¦‚ï¼š25 + 17 = 32ï¼ˆé”™è¯¯ï¼‰" required></textarea>
                            </div>
                            <div class="form-group">
                                <label>çŸ¥è¯†ç‚¹æ ‡ç­¾ (é€—å·åˆ†éš”)</label>
                                <input type="text" id="mistake-tags" placeholder="å¦‚ï¼šåŠ æ³•è®¡ç®—,è¿›ä½">
                            </div>
                            <div class="form-group">
                                <label>éš¾åº¦ç­‰çº§</label>
                                <select id="mistake-difficulty">
                                    <option value="1">1çº§ - ç®€å•</option>
                                    <option value="2">2çº§ - ä¸€èˆ¬</option>
                                    <option value="3">3çº§ - ä¸­ç­‰</option>
                                    <option value="4">4çº§ - å›°éš¾</option>
                                    <option value="5">5çº§ - å¾ˆéš¾</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">åˆ›å»ºé”™é¢˜</button>
                        </form>
                    </div>
                </div>

                <!-- é”™é¢˜è®°å½•åˆ—è¡¨ -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ“ é”™é¢˜è®°å½•åˆ—è¡¨</h3>
                        <button class="btn btn-secondary" onclick="loadMistakes()">åˆ·æ–°</button>
                    </div>
                    <div class="card-body">
                        <div id="mistakes-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                æ­£åœ¨åŠ è½½é”™é¢˜...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å­¦ç”Ÿç»Ÿè®¡æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="students-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ğŸ‘¥ å­¦ç”Ÿç»Ÿè®¡æŸ¥è¯¢</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label>å­¦ç”ŸID</label>
                                <input type="number" id="stats-student-id" value="28" placeholder="è¾“å…¥å­¦ç”ŸID">
                            </div>
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <button class="btn btn-primary" onclick="loadStudentStats()">æŸ¥è¯¢ç»Ÿè®¡</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç»Ÿè®¡ç»“æœ -->
                <div id="student-stats-result" style="display: none;">
                    <!-- åŠ¨æ€ç”Ÿæˆç»Ÿè®¡å†…å®¹ -->
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/star-static/js/api.js"></script>
    <script>
        // ================ é¡µé¢åŠŸèƒ½å®ç° ================

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šæ ‡ç­¾é¡µåˆ‡æ¢äº‹ä»¶
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    UI.switchTab(tabName);

                    // åŠ è½½å¯¹åº”æ ‡ç­¾é¡µçš„æ•°æ®
                    switch(tabName) {
                        case 'overview':
                            loadOverview();
                            break;
                        case 'records':
                            loadRecords();
                            break;
                        case 'mistakes':
                            loadMistakes();
                            break;
                    }
                });
            });

            // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
            document.getElementById('record-form').addEventListener('submit', handleRecordSubmit);
            document.getElementById('mistake-form').addEventListener('submit', handleMistakeSubmit);

            // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
            checkServerStatus();

            // åŠ è½½æ€»è§ˆæ•°æ®
            loadOverview();
        });

        // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        async function checkServerStatus() {
            const statusElement = document.getElementById('server-status');
            try {
                const health = await starAPI.healthCheck();
                if (health.success) {
                    statusElement.textContent = 'âœ… StarJourneyæœåŠ¡å™¨è¿è¡Œæ­£å¸¸';
                } else {
                    statusElement.textContent = 'âŒ æœåŠ¡å™¨çŠ¶æ€å¼‚å¸¸';
                }
            } catch (error) {
                statusElement.textContent = 'âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨';
            }
        }

        // åŠ è½½æ€»è§ˆæ•°æ®
        async function loadOverview() {
            try {
                const records = await starAPI.getRecords();
                const mistakes = await starAPI.getMistakes();

                const totalRecords = records.data ? records.data.length : 0;
                const passedRecords = records.data ? records.data.filter(r => r.status === 'passed').length : 0;
                const totalAttempts = records.data ? records.data.reduce((sum, r) => sum + (r.attempt_count || 0), 0) : 0;
                const totalMistakes = mistakes.data ? mistakes.data.length : 0;

                document.getElementById('total-records').textContent = totalRecords;
                document.getElementById('passed-records').textContent = passedRecords;
                document.getElementById('total-attempts').textContent = totalAttempts;
                document.getElementById('total-mistakes').textContent = totalMistakes;
            } catch (error) {
                console.error('åŠ è½½æ€»è§ˆæ•°æ®å¤±è´¥:', error);
                document.getElementById('total-records').textContent = '0';
                document.getElementById('passed-records').textContent = '0';
                document.getElementById('total-attempts').textContent = '0';
                document.getElementById('total-mistakes').textContent = '0';
            }
        }

        // å¤„ç†è¿‡å…³è®°å½•è¡¨å•æäº¤
        async function handleRecordSubmit(event) {
            event.preventDefault();

            const formData = {
                student_id: parseInt(document.getElementById('record-student-id').value),
                task_name: document.getElementById('record-task-name').value,
                task_type: document.getElementById('record-task-type').value,
                exp_value: parseInt(document.getElementById('record-exp-value').value) || 10,
                lesson_subject: document.getElementById('record-subject').value,
                lesson_unit: document.getElementById('record-unit').value ? parseInt(document.getElementById('record-unit').value) : null,
                lesson_lesson: document.getElementById('record-lesson').value ? parseInt(document.getElementById('record-lesson').value) : null,
                lesson_title: document.getElementById('record-title').value,
                is_special: document.getElementById('record-special').value === 'true'
            };

            try {
                const result = await starAPI.createRecord(formData);
                UI.showSuccess(`è¿‡å…³è®°å½•åˆ›å»ºæˆåŠŸï¼ä»»åŠ¡ï¼š${formData.task_name}`);
                document.getElementById('record-form').reset();
                document.getElementById('record-student-id').value = '28';
                document.getElementById('record-exp-value').value = '10';
                loadRecords();
                loadOverview();
            } catch (error) {
                UI.showError(`åˆ›å»ºå¤±è´¥ï¼š${error.message}`);
            }
        }

        // å¤„ç†é”™é¢˜è®°å½•è¡¨å•æäº¤
        async function handleMistakeSubmit(event) {
            event.preventDefault();

            const tagsText = document.getElementById('mistake-tags').value;
            const tags = tagsText ? tagsText.split(',').map(tag => tag.trim()) : [];

            const formData = {
                student_id: parseInt(document.getElementById('mistake-student-id').value),
                ocr_text: document.getElementById('mistake-text').value,
                subject: document.getElementById('mistake-subject').value,
                tags: tags,
                difficulty_level: parseInt(document.getElementById('mistake-difficulty').value)
            };

            try {
                const result = await starAPI.createMistake(formData);
                UI.showSuccess(`é”™é¢˜è®°å½•åˆ›å»ºæˆåŠŸï¼${formData.subject}ç§‘ç›®`);
                document.getElementById('mistake-form').reset();
                document.getElementById('mistake-student-id').value = '28';
                loadMistakes();
                loadOverview();
            } catch (error) {
                UI.showError(`åˆ›å»ºå¤±è´¥ï¼š${error.message}`);
            }
        }

        // åŠ è½½è¿‡å…³è®°å½•åˆ—è¡¨
        async function loadRecords() {
            UI.showLoading('records-list');

            try {
                const result = await starAPI.getRecords();
                const records = result.data || [];

                if (records.length === 0) {
                    document.getElementById('records-list').innerHTML = '<p style="text-align: center; color: #6b7280;">æš‚æ— è¿‡å…³è®°å½•</p>';
                    return;
                }

                const html = records.map(record => `
                    <div class="list-item">
                        <div class="list-item-header">
                            <div>
                                <span class="list-item-title">${record.task_name}</span>
                                ${UI.getTaskTypeBadge(record.task_type)}
                                ${UI.getStatusBadge(record.status)}
                                ${record.attempt_count > 0 ? UI.getAttemptBadge(record.attempt_count) : ''}
                            </div>
                            <div>
                                ${record.status === 'pending' ? `
                                    <button class="btn btn-warning" onclick="recordAttempt('${record.id}')">è®°å½•è¾…å¯¼</button>
                                    <button class="btn btn-success" onclick="markAsPassed('${record.id}')">æ ‡è®°é€šè¿‡</button>
                                ` : ''}
                                <button class="btn btn-danger" onclick="deleteRecord('${record.id}')">åˆ é™¤</button>
                            </div>
                        </div>
                        <div class="list-item-meta">
                            <span>ğŸ‘¤ ${record.student_name}</span>
                            <span>ğŸ“š ${record.lesson_subject || 'æœªåˆ†ç±»'}</span>
                            <span>ğŸ’° ${record.exp_value} EXP</span>
                            <span>ğŸ•’ ${UI.formatDate(record.created_at)}</span>
                        </div>
                        ${record.lesson_title ? `<div style="margin-top: 8px; color: #6b7280;">ğŸ“– ${record.lesson_title}</div>` : ''}
                    </div>
                `).join('');

                document.getElementById('records-list').innerHTML = html;
            } catch (error) {
                console.error('åŠ è½½è¿‡å…³è®°å½•å¤±è´¥:', error);
                document.getElementById('records-list').innerHTML = '<p style="color: #ef4444;">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿æ¥</p>';
            }
        }

        // åŠ è½½é”™é¢˜è®°å½•åˆ—è¡¨
        async function loadMistakes() {
            UI.showLoading('mistakes-list');

            try {
                const result = await starAPI.getMistakes();
                const mistakes = result.data || [];

                if (mistakes.length === 0) {
                    document.getElementById('mistakes-list').innerHTML = '<p style="text-align: center; color: #6b7280;">æš‚æ— é”™é¢˜è®°å½•</p>';
                    return;
                }

                const html = mistakes.map(mistake => `
                    <div class="list-item">
                        <div class="list-item-header">
                            <div>
                                <span class="list-item-title">${mistake.ocr_text ? mistake.ocr_text.substring(0, 50) + '...' : 'æ— æ–‡æœ¬'}</span>
                                ${UI.getStatusBadge(mistake.status)}
                                <span class="status-badge status-pending">${mistake.subject}</span>
                            </div>
                            <button class="btn btn-danger" onclick="deleteMistake('${mistake.id}')">åˆ é™¤</button>
                        </div>
                        <div class="list-item-meta">
                            <span>ğŸ‘¤ ${mistake.student_name}</span>
                            <span>ğŸ“Š éš¾åº¦${mistake.difficulty_level}çº§</span>
                            <span>ğŸ•’ ${UI.formatDate(mistake.created_at)}</span>
                        </div>
                        ${mistake.tags && mistake.tags.length > 0 ? `
                            <div style="margin-top: 8px;">
                                ${mistake.tags.map(tag => `<span style="background: #e5e7eb; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 5px;">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `).join('');

                document.getElementById('mistakes-list').innerHTML = html;
            } catch (error) {
                console.error('åŠ è½½é”™é¢˜è®°å½•å¤±è´¥:', error);
                document.getElementById('mistakes-list').innerHTML = '<p style="color: #ef4444;">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿æ¥</p>';
            }
        }

        // è®°å½•è¾…å¯¼å°è¯•
        async function recordAttempt(recordId) {
            UI.confirm('ç¡®å®šè¦è®°å½•ä¸€æ¬¡è¾…å¯¼å°è¯•å—ï¼Ÿ', async () => {
                try {
                    const result = await starAPI.recordAttempt(recordId);
                    UI.showSuccess(`è¾…å¯¼å°è¯•è®°å½•æˆåŠŸï¼${result.message}`);
                    loadRecords();
                    loadOverview();
                } catch (error) {
                    UI.showError(`è®°å½•å¤±è´¥ï¼š${error.message}`);
                }
            });
        }

        // æ ‡è®°ä¸ºé€šè¿‡
        async function markAsPassed(recordId) {
            UI.confirm('ç¡®å®šè¦æ ‡è®°æ­¤ä»»åŠ¡ä¸ºé€šè¿‡å—ï¼Ÿ', async () => {
                try {
                    const result = await starAPI.markAsPassed(recordId);
                    UI.showSuccess(`ä»»åŠ¡é€šè¿‡æˆåŠŸï¼${result.message}`);
                    loadRecords();
                    loadOverview();
                } catch (error) {
                    UI.showError(`æ ‡è®°å¤±è´¥ï¼š${error.message}`);
                }
            });
        }

        // åˆ é™¤è¿‡å…³è®°å½•
        async function deleteRecord(recordId) {
            UI.confirm('ç¡®å®šè¦åˆ é™¤æ­¤è¿‡å…³è®°å½•å—ï¼Ÿ', async () => {
                try {
                    await starAPI.deleteRecord(recordId);
                    UI.showSuccess('è®°å½•åˆ é™¤æˆåŠŸ');
                    loadRecords();
                    loadOverview();
                } catch (error) {
                    UI.showError(`åˆ é™¤å¤±è´¥ï¼š${error.message}`);
                }
            });
        }

        // åˆ é™¤é”™é¢˜è®°å½•
        async function deleteMistake(mistakeId) {
            UI.confirm('ç¡®å®šè¦åˆ é™¤æ­¤é”™é¢˜è®°å½•å—ï¼Ÿ', async () => {
                try {
                    await starAPI.deleteMistake(mistakeId);
                    UI.showSuccess('é”™é¢˜åˆ é™¤æˆåŠŸ');
                    loadMistakes();
                    loadOverview();
                } catch (error) {
                    UI.showError(`åˆ é™¤å¤±è´¥ï¼š${error.message}`);
                }
            });
        }

        // åŠ è½½å­¦ç”Ÿç»Ÿè®¡
        async function loadStudentStats() {
            const studentId = document.getElementById('stats-student-id').value;
            if (!studentId) {
                UI.showError('è¯·è¾“å…¥å­¦ç”ŸID');
                return;
            }

            const resultDiv = document.getElementById('student-stats-result');
            resultDiv.style.display = 'block';
            UI.showLoading('student-stats-result');

            try {
                const stats = await starAPI.getStudentStats(studentId);

                const html = `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ğŸ“Š ${stats.data.student_name} çš„å­¦ä¸šç»Ÿè®¡</h3>
                        </div>
                        <div class="card-body">
                            <div class="grid">
                                <div class="grid-item">
                                    <div class="stat-number">${stats.data.qc_passed || 0}</div>
                                    <div class="stat-label">è´¨æ£€é€šè¿‡</div>
                                </div>
                                <div class="grid-item">
                                    <div class="stat-number">${stats.data.qc_pending || 0}</div>
                                    <div class="stat-label">è´¨æ£€å¾…å®Œæˆ</div>
                                </div>
                                <div class="grid-item">
                                    <div class="stat-number">${stats.data.task_passed || 0}</div>
                                    <div class="stat-label">ä»»åŠ¡é€šè¿‡</div>
                                </div>
                                <div class="grid-item">
                                    <div class="stat-number">${stats.data.total_attempts || 0}</div>
                                    <div class="stat-label">æ€»å°è¯•æ¬¡æ•°</div>
                                </div>
                            </div>
                            <div style="margin-top: 20px;">
                                <h4>å­¦ä¹ æˆæœï¼š</h4>
                                <ul>
                                    <li>ğŸ“š ç­çº§ï¼š${stats.data.class_name || 'æœªåˆ†é…'}</li>
                                    <li>ğŸ’° æ€»ç»éªŒå€¼ï¼š${stats.data.total_earned_exp || 0} EXP</li>
                                    <li>ğŸ“ å·²è§£å†³é”™é¢˜ï¼š${stats.data.solved_mistakes || 0} é¢˜</li>
                                    <li>âŒ å¾…è§£å†³é”™é¢˜ï¼š${stats.data.total_mistakes || 0} é¢˜</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;

                resultDiv.innerHTML = html;
            } catch (error) {
                console.error('åŠ è½½å­¦ç”Ÿç»Ÿè®¡å¤±è´¥:', error);
                resultDiv.innerHTML = '<p style="color: #ef4444;">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å­¦ç”ŸIDæ˜¯å¦æ­£ç¡®</p>';
            }
        }
    </script>
</body>
</html>