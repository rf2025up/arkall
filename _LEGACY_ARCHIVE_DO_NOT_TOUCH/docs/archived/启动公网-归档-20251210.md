# å…¬ç½‘è®¿é—®å¯åŠ¨æŒ‡å—

## ğŸš¨ é‡è¦æç¤º (2025-12-10æ›´æ–°)

**å½“å‰ç¡®è®¤çš„å…¬ç½‘åœ°å€**: `https://esboimzbkure.sealosbja.site` â­ **å·²éªŒè¯å¯ç”¨**

**æ¯æ¬¡ä¿®æ”¹åŠŸèƒ½åï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å¿«é€Ÿéƒ¨ç½²**:
```bash
# ä¸€é”®å¿«é€Ÿéƒ¨ç½²
/home/devbox/project/å¿«é€Ÿéƒ¨ç½².sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
cd /home/devbox/project/arkok/mobile && npm run build && cp dist/assets/*.js ../public/assets/ && cp dist/index.html ../public/ && cd /home/devbox/project && ./entrypoint.sh production
```

**è¯¦ç»†éƒ¨ç½²æŒ‡å—**: è¯·æŸ¥çœ‹ `/home/devbox/project/å…¨å±€éƒ¨ç½²æ›´æ–°æŒ‡å—.md`

---

## é—®é¢˜ç°è±¡
å…¬ç½‘åœ°å€é•¿æ—¶é—´å¤„äºã€Œå‡†å¤‡ä¸­ã€çŠ¶æ€

## è§£å†³æ–¹æ¡ˆ

### 1. é¡¹ç›®ç»“æ„è¯´æ˜

æœ¬é¡¹ç›®ä¸º **arkok** å¤šåº”ç”¨ç³»ç»Ÿï¼ŒåŒ…å«ï¼š
- **æ‰‹æœºç«¯ç¨‹åº**ï¼šå¯¹åº”å…¬ç½‘è®¿é—®è·¯å¾„ `/app`
- **å¤§å±ç«¯ç¨‹åº**ï¼šå¯¹åº”å…¬ç½‘è®¿é—®è·¯å¾„ `/screen`

é¡¹ç›®ç»“æ„ï¼š
```
/home/devbox/project/
â”œâ”€â”€ arkok/                      # ä¸»é¡¹ç›®ç›®å½•
â”‚   â”œâ”€â”€ server.js              # åç«¯æœåŠ¡å™¨ï¼ˆExpress + WebSocketï¼‰
â”‚   â”œâ”€â”€ .env                   # æ•°æ®åº“é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ public/                # é™æ€æ–‡ä»¶ç›®å½•ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ index.html         # æ‰‹æœºç«¯ï¼ˆè®¿é—®è·¯å¾„ï¼š/appï¼‰
â”‚   â”‚   â”œâ”€â”€ assets/            # ç¼–è¯‘åçš„èµ„æºæ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ main-*.js      # æ‰‹æœºç«¯ä¸»ç¨‹åºï¼ˆé‡è¦ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ bigscreen-*.js # å¤§å±ç«¯ç¨‹åº
â”‚   â”‚   â”‚   â””â”€â”€ client-*.js    # å…±äº«å®¢æˆ·ç«¯ä»£ç 
â”‚   â”‚   â””â”€â”€ bigscreen/         # å¤§å±ç«¯é™æ€æ–‡ä»¶ï¼ˆè®¿é—®è·¯å¾„ï¼š/screenï¼‰
â”‚   â”œâ”€â”€ mobile/                # æ‰‹æœºç«¯æºç ï¼ˆéœ€ç¼–è¯‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ src/               # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ dist/              # æ„å»ºè¾“å‡ºï¼ˆnpm run buildï¼‰
â”‚   â”‚   â””â”€â”€ package.json       # ä¾èµ–å’Œæ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ bigscreen/             # å¤§å±ç«¯æºç 
â”‚   â””â”€â”€ package.json           # æœåŠ¡å™¨ä¾èµ–
â””â”€â”€ entrypoint.sh              # å¯åŠ¨è„šæœ¬
```

**é‡è¦è¯´æ˜**ï¼š
- `/public` ç›®å½•æ˜¯**ç”Ÿäº§ç¯å¢ƒ**ä½¿ç”¨çš„é™æ€æ–‡ä»¶ç›®å½•
- `/mobile/dist` æ˜¯ç¼–è¯‘åçš„è¾“å‡ºç›®å½•ï¼Œéœ€è¦æ‰‹åŠ¨å¤åˆ¶åˆ° `/public/assets/`
- è¯·å‹¿ç›´æ¥ä¿®æ”¹ `/public/assets/` ä¸­çš„æ–‡ä»¶ï¼Œåº”è¯¥ä¿®æ”¹æºç åé‡æ–°ç¼–è¯‘

### 2. å¯åŠ¨æœåŠ¡

åœ¨ Devbox å®ä¾‹ä¸­è¿è¡Œå¯åŠ¨å‘½ä»¤ï¼š

```bash
cd /home/devbox/project
./entrypoint.sh
```

æˆ–è€…ä½¿ç”¨åå°å¯åŠ¨ï¼š

```bash
cd /home/devbox/project
nohup ./entrypoint.sh > server.log 2>&1 &
```

### 3. å‰ç«¯èµ„æºæ„å»ºä¸ç®¡ç†

#### æ„å»ºæµç¨‹è¯´æ˜

æœ¬é¡¹ç›®ä½¿ç”¨ **Vite** ä½œä¸ºå‰ç«¯æ„å»ºå·¥å…·ï¼Œæ”¯æŒå¤šå…¥å£æ„å»ºï¼š

**æºç ä½ç½®**ï¼š
- æ‰‹æœºç«¯æºç ï¼š`/home/devbox/project/arkok/mobile/`
- å¤§å±ç«¯æºç ï¼š`/home/devbox/project/arkok/bigscreen/`

**æ„å»ºè¾“å‡º**ï¼š
- æ‰‹æœºç«¯ï¼š`/home/devbox/project/arkok/mobile/dist/`
- è¾“å‡ºæ–‡ä»¶ï¼š`main-*.js`, `client-*.js`

**é‡è¦**ï¼šæ„å»ºåçš„æ–‡ä»¶éœ€è¦æ‰‹åŠ¨å¤åˆ¶åˆ°ç”Ÿäº§ç›®å½•ï¼š
```bash
cd /home/devbox/project/arkok/mobile

# å®‰è£…ä¾èµ–ï¼ˆä»…åœ¨é¦–æ¬¡æˆ–ä¾èµ–å˜æ›´æ—¶ï¼‰
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¤åˆ¶æ„å»ºæ–‡ä»¶åˆ° public/assets/
cp dist/assets/main-*.js ../public/assets/
cp dist/index.html ../public/
```

**ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„æ–‡ä»¶**ï¼š
- `/public/index.html` - æ‰‹æœºç«¯å…¥å£æ–‡ä»¶
- `/public/assets/main-*.js` - æ‰‹æœºç«¯ä¸»ç¨‹åºï¼ˆå…³é”®ï¼‰
- `/public/assets/bigscreen-*.js` - å¤§å±ç«¯ç¨‹åº
- `/public/assets/client-*.js` - å…±äº«ä»£ç 

#### å¸¸è§é—®é¢˜ï¼šæ‰‹æœºç«¯æ˜¾ç¤ºç©ºç™½é¡µï¼ˆ404 é”™è¯¯ï¼‰

**é—®é¢˜ç°è±¡**ï¼šè®¿é—® `/app` æ—¶é¡µé¢ç©ºç™½ï¼Œæµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º 404 é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
GET https://xxx.sealosbja.site/assets/main-xxx.js net::ERR_ABORTED 404
```

**æ ¹æœ¬åŸå› **ï¼š`public/assets/` ç›®å½•ç¼ºå°‘ç¼–è¯‘åçš„ `main-*.js` æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥èµ„æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š
   ```bash
   ls -lh /home/devbox/project/arkok/public/assets/
   ```

2. å¦‚æœç¼ºå°‘ `main-*.js` æ–‡ä»¶ï¼Œé‡æ–°ç¼–è¯‘ï¼š
   ```bash
   cd /home/devbox/project/arkok/mobile
   npm install
   npm run build
   cp dist/assets/main-*.js ../public/assets/
   cp dist/index.html ../public/
   ```

3. é‡å¯æœåŠ¡å™¨ï¼š
   ```bash
   # åœæ­¢æ—§è¿›ç¨‹
   kill $(pgrep -f "arkok/server.js")

   # å¯åŠ¨æ–°æœåŠ¡
   cd /home/devbox/project
   ./entrypoint.sh
   ```

### 4. å…³é”®æ£€æŸ¥ç‚¹

#### âœ… ç›‘å¬åœ°å€é…ç½®
- **å¿…é¡»**ï¼šç¡®ä¿å¼€å‘æœåŠ¡å™¨è¿è¡Œåœ¨ `0.0.0.0` è€Œé `localhost`
- **å½“å‰é…ç½®**ï¼š`arkok/server.js` å·²æ­£ç¡®é…ç½®ä¸º `0.0.0.0:3000`
- **é…ç½®æ–‡ä»¶ä½ç½®**ï¼š`/home/devbox/project/arkok/server.js:49`

```javascript
const server = http.createServer(app);
server.listen(PORT, '0.0.0.0', () => {
  console.log(`Server running at http://0.0.0.0:${PORT}`);
});
```

#### âœ… ç«¯å£é…ç½®
- ä»£ç ä¸­ä½¿ç”¨ç«¯å£ï¼š`3000`ï¼ˆåœ¨ .env æ–‡ä»¶ä¸­é…ç½®ï¼‰
- Devbox å¼€æ”¾ç«¯å£ï¼šéœ€ç¡®è®¤ä¸å¹³å°é…ç½®ä¸€è‡´
- **æ³¨æ„**ï¼šentrypoint.sh ä¼šåŠ è½½ .env æ–‡ä»¶ä¸­çš„ PORT é…ç½®

#### âœ… æ•°æ®åº“è¿æ¥é…ç½®
- **é…ç½®æ–‡ä»¶**ï¼š`/home/devbox/project/arkok/.env`
- **æ•°æ®åº“æœåŠ¡**ï¼šSealos PostgreSQL
- **è‡ªåŠ¨è¿æ¥**ï¼šentrypoint.sh ä¼šè‡ªåŠ¨åŠ è½½ .env æ–‡ä»¶å¹¶è¿æ¥æ•°æ®åº“

æ•°æ®åº“é…ç½®å‚æ•°ï¼š
```bash
DB_HOST=growark-postgresql.ns-bg6fgs6y.svc  # Sealos æ•°æ®åº“ä¸»æœºï¼ˆé›†ç¾¤å†…ç½‘åœ°å€ï¼‰
DB_PORT=5432                                  # æ•°æ®åº“ç«¯å£
DB_NAME=postgres                             # æ•°æ®åº“å
DB_USER=postgres                             # æ•°æ®åº“ç”¨æˆ·
DB_PASSWORD=kngwb5cb                         # æ•°æ®åº“å¯†ç 
```

### 5. æœåŠ¡æ¨¡å¼è¯´æ˜

#### ä¸ºä»€ä¹ˆåªéœ€è¦ 3000 ç«¯å£ï¼Ÿ

æœ¬é¡¹ç›®é‡‡ç”¨**å•æœåŠ¡å™¨å¤šåº”ç”¨**æ¶æ„ï¼Œä»…éœ€ 3000 ç«¯å£å³å¯åŒæ—¶æœåŠ¡å¤šä¸ªå‰ç«¯åº”ç”¨ï¼š

**æ¶æ„è¯´æ˜**ï¼š
1. **Express æœåŠ¡å™¨**ï¼ˆç«¯å£ 3000ï¼‰åŒæ—¶å¤„ç†ï¼š
   - é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆæ‰‹æœºç«¯ã€å¤§å±ç«¯ï¼‰
   - API æ¥å£ï¼ˆå­¦ç”Ÿæ•°æ®ç®¡ç†ï¼‰
   - WebSocket å®æ—¶é€šä¿¡

2. **è·¯ç”±åŒºåˆ†**ï¼š
   - `/app` â†’ æ‰‹æœºç«¯åº”ç”¨ï¼ˆpublic/index.htmlï¼‰
   - `/screen` â†’ å¤§å±ç«¯åº”ç”¨ï¼ˆpublic/bigscreen/index.htmlï¼‰
   - `/api/*` â†’ API æ¥å£ï¼ˆserver.js å¤„ç†ï¼‰

3. **å¼€å‘æ¨¡å¼ vs ç”Ÿäº§æ¨¡å¼**ï¼š
   - **ç”Ÿäº§æ¨¡å¼**ï¼ˆå½“å‰ä½¿ç”¨ï¼‰ï¼š
     - å‰ç«¯ä»£ç ç¼–è¯‘ä¸ºé™æ€æ–‡ä»¶ï¼ˆmain-*.js, bigscreen-*.jsï¼‰
     - Express æœåŠ¡å™¨ç»Ÿä¸€æä¾›é™æ€æ–‡ä»¶å’Œ API æœåŠ¡
     - ä»…éœ€è¦ 3000 ç«¯å£

   - **å¼€å‘æ¨¡å¼**ï¼ˆæœ¬åœ°å¼€å‘ï¼‰ï¼š
     - åœ¨ `/mobile` ç›®å½•è¿è¡Œ `npm run dev`
     - Vite å¼€å‘æœåŠ¡å™¨æä¾›çƒ­æ›´æ–°ï¼ˆä¹Ÿä½¿ç”¨ 3000 ç«¯å£ï¼‰
     - ä½†ç”Ÿäº§éƒ¨ç½²ä¸éœ€è¦æ­¤æ­¥éª¤

**ç»“è®º**ï¼šç”Ÿäº§ç¯å¢ƒåªéœ€è¦å¯åŠ¨ Express æœåŠ¡å™¨ï¼ˆ3000 ç«¯å£ï¼‰ï¼Œæ— éœ€å…¶ä»–æœåŠ¡ï¼

#### éªŒè¯æœåŠ¡æ¨¡å¼

```bash
# æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€
netstat -tulpn | grep :3000

# é¢„æœŸè¾“å‡ºï¼štcp 0 0 0.0.0.0:3000 0.0.0.0:* LISTEN node
# è¿™è¡¨æ˜ Express æœåŠ¡å™¨æ­£åœ¨ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£çš„ 3000 ç«¯å£
```

å¦‚æœçœ‹åˆ°å¤šä¸ª Node.js è¿›ç¨‹æˆ–å¤šä¸ªç«¯å£ï¼Œè¯´æ˜å¯èƒ½æœ‰ï¼š
1. æ—§çš„æœåŠ¡å™¨è¿›ç¨‹æœªæ­£ç¡®å…³é—­
2. åŒæ—¶å¯åŠ¨äº†å¼€å‘æœåŠ¡å™¨å’Œ Express æœåŠ¡å™¨

**è§£å†³æ–¹æ³•**ï¼š
```bash
# åœæ­¢æ‰€æœ‰ Node.js è¿›ç¨‹
kill $(pgrep -f "arkok/server.js")

# é‡æ–°å¯åŠ¨
./entrypoint.sh
```

#### âœ… è·¯ç”±æ˜ å°„é…ç½®
- **æ‰‹æœºç«¯**ï¼š`http://å…¬ç½‘åœ°å€/app` â†’ `/home/devbox/project/arkok/public/index.html`
- **å¤§å±ç«¯**ï¼š`http://å…¬ç½‘åœ°å€/screen` â†’ `/home/devbox/project/arkok/public/bigscreen/index.html`
- **Adminç®¡ç†ç«¯**ï¼š`http://å…¬ç½‘åœ°å€/admin` â†’ `/home/devbox/project/arkok/public/index.html`

### 4. å¯åŠ¨åçš„ç­‰å¾…æ—¶é—´

å¯åŠ¨æœåŠ¡åï¼Œå†…éƒ¨ç½‘å…³éœ€è¦ **2-5 åˆ†é’Ÿ**å‡†å¤‡ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

### 5. æœåŠ¡çŠ¶æ€æ£€æŸ¥

#### æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
```bash
ps aux | grep "arkok/server.js" | grep -v grep
```

é¢„æœŸè¾“å‡ºï¼š
```
devbox   59527  0.5  0.0 11778092 61536 ?      Sl   04:14   0:00 node arkok/server.js
```

#### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
# å¦‚æœæœåŠ¡åœ¨åå°è¿è¡Œï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è¾“å‡º
# PID éœ€è¦æ›¿æ¢ä¸ºå®é™…è¿›ç¨‹ID
tail -f /proc/$(pgrep -f "arkok/server.js")/fd/1
```

#### æ‰‹åŠ¨æµ‹è¯•æœåŠ¡
```bash
# æµ‹è¯•æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨
curl http://0.0.0.0:3000/health

# æµ‹è¯•å­¦ç”Ÿæ•°æ®API
curl http://0.0.0.0:3000/api/students

# æµ‹è¯•æ‰‹æœºç«¯é¡µé¢
curl -I http://0.0.0.0:3000/app

# æµ‹è¯•å¤§å±ç«¯é¡µé¢
curl -I http://0.0.0.0:3000/screen
```

### 6. é…ç½®æ–‡ä»¶è¯´æ˜

#### entrypoint.shï¼ˆå¯åŠ¨è„šæœ¬ï¼‰
- **ä½ç½®**ï¼š`/home/devbox/project/entrypoint.sh`
- **ç”¨é€”**ï¼šè‡ªåŠ¨åŒ–å¯åŠ¨è„šæœ¬ï¼Œç¡®ä¿æ•°æ®åº“è¿æ¥å’ŒæœåŠ¡å™¨å¯åŠ¨
- **å¯åŠ¨å‘½ä»¤**ï¼š`./entrypoint.sh [development|production]`
- **é»˜è®¤ç¯å¢ƒ**ï¼šdevelopment
- **è‡ªåŠ¨æ“ä½œ**ï¼š
  1. åˆ‡æ¢åˆ° `/home/devbox/project/arkok` ç›®å½•
  2. åŠ è½½ `.env` ç¯å¢ƒå˜é‡æ–‡ä»¶
  3. æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é…ç½®ä¿¡æ¯
  4. å¯åŠ¨ Node.js æœåŠ¡å™¨ï¼ˆserver.jsï¼‰

#### .envï¼ˆæ•°æ®åº“é…ç½®æ–‡ä»¶ï¼‰
- **ä½ç½®**ï¼š`/home/devbox/project/arkok/.env`
- **ç”¨é€”**ï¼šå­˜å‚¨æ•°æ®åº“è¿æ¥é…ç½®
- **é‡è¦**ï¼šè¯·å‹¿å°†å¯†ç æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

ç¤ºä¾‹é…ç½®ï¼š
```bash
# Node.jsç¯å¢ƒ
NODE_ENV=development
PORT=3000

# æ•°æ®åº“é…ç½®ï¼ˆSealos PostgreSQLï¼‰
DB_HOST=growark-postgresql.ns-bg6fgs6y.svc  # Sealos é›†ç¾¤å†…ç½‘åœ°å€
DB_PORT=5432
DB_NAME=postgres
DB_USER=postgres
DB_PASSWORD=kngwb5cb

# WebSocketé…ç½®
WS_ORIGIN=*
WS_PATH=/ws

# CORSé…ç½®
CORS_ORIGIN=*
CORS_CREDENTIALS=true

# è¿æ¥æ± é…ç½®
DB_POOL_MIN=2
DB_POOL_MAX=10
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=10000
```

#### arkok/server.jsï¼ˆåç«¯æœåŠ¡å™¨ï¼‰
- **ä½ç½®**ï¼š`/home/devbox/project/arkok/server.js`
- **åŠŸèƒ½**ï¼š
  - æä¾›å‰ç«¯é™æ€æ–‡ä»¶æœåŠ¡
  - ä»£ç† API è¯·æ±‚åˆ° PostgreSQL æ•°æ®åº“
  - å¤„ç† WebSocket å®æ—¶é€šä¿¡
  - å­¦ç”Ÿæ•°æ®ç®¡ç†ï¼ˆç§¯åˆ†ã€ç»éªŒå€¼ã€ç­‰çº§ç­‰ï¼‰
- **ç«¯å£**ï¼š3000
- **APIç«¯ç‚¹**ï¼š
  - `/api/students` - è·å–å­¦ç”Ÿåˆ—è¡¨å’Œç§¯åˆ†æ•°æ®
  - `/api/docs` - API æ–‡æ¡£
  - `/health` - å¥åº·æ£€æŸ¥
  - `/ws` - WebSocket è¿æ¥
- **å‰ç«¯è·¯å¾„**ï¼š
  - `/app` - æ‰‹æœºç«¯åº”ç”¨
  - `/screen` - å¤§å±ç«¯åº”ç”¨
  - `/admin` - ç®¡ç†ç«¯åº”ç”¨

### 7. ç¯å¢ƒåŒºåˆ†

#### å¼€å‘ç¯å¢ƒï¼ˆdevelopmentï¼‰
```bash
./entrypoint.sh development
# æˆ–
./entrypoint.sh
```

#### ç”Ÿäº§ç¯å¢ƒï¼ˆproductionï¼‰
```bash
./entrypoint.sh production
```

### 8. å¸¸è§é—®é¢˜æ’æŸ¥

#### Q1: å…¬ç½‘åœ°å€ä»æ˜¾ç¤º"å‡†å¤‡ä¸­"

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. æœåŠ¡æ˜¯å¦å·²å¯åŠ¨ï¼š`ps aux | grep "arkok/server.js"`
2. æ˜¯å¦ç­‰å¾… 2-5 åˆ†é’Ÿï¼ˆç½‘å…³å‡†å¤‡æ—¶é—´ï¼‰
3. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦ç›‘å¬ 0.0.0.0 åœ°å€ï¼ˆä¸æ˜¯ localhostï¼‰
4. æ£€æŸ¥ç«¯å£æ˜¯å¦ä¸º 3000
5. æ£€æŸ¥å¥åº·æ£€æŸ¥æ¥å£ï¼š
   ```bash
   curl http://localhost:3000/health
   ```

#### Q2: ç½‘é¡µå¯ä»¥è®¿é—®ä½†æ²¡æœ‰æ•°æ®

**å¯èƒ½åŸå› **ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹æœåŠ¡å™¨è¾“å‡ºæ—¥å¿—ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®åº“è¿æ¥é”™è¯¯
2. éªŒè¯ .env æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š
   ```bash
   ls -la /home/devbox/project/arkok/.env
   ```
3. æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®
4. æµ‹è¯•æ•°æ®åº“è¿æ¥ï¼š
   ```bash
   curl http://localhost:3000/api/students
   ```
5. å¦‚æœè¿”å›å­¦ç”Ÿæ•°æ®ï¼Œè¯´æ˜è¿æ¥æ­£å¸¸

#### Q3: å¦‚ä½•ä¿®æ”¹æ•°æ®åº“è¿æ¥é…ç½®

**é…ç½®æ–‡ä»¶**ï¼š`/home/devbox/project/arkok/.env`

éœ€è¦ä¿®æ”¹çš„å‚æ•°ï¼š
- `DB_HOST` - æ•°æ®åº“ä¸»æœºåœ°å€
- `DB_PORT` - æ•°æ®åº“ç«¯å£
- `DB_NAME` - æ•°æ®åº“åç§°
- `DB_USER` - æ•°æ®åº“ç”¨æˆ·å
- `DB_PASSWORD` - æ•°æ®åº“å¯†ç 

ä¿®æ”¹åéœ€é‡å¯æœåŠ¡ï¼š
```bash
# åœæ­¢æ—§æœåŠ¡
kill $(pgrep -f "arkok/server.js")

# å¯åŠ¨æ–°æœåŠ¡
./entrypoint.sh
```

#### Q4: å¦‚ä½•åˆ‡æ¢åˆ°å…¶ä»–æœåŠ¡

æœ¬é¡¹ç›®å·²å›ºå®šä¸º arkok é¡¹ç›®ï¼Œå¦‚éœ€åˆ‡æ¢åˆ°å…¶ä»–æœåŠ¡ï¼š

1. ä¿®æ”¹ `entrypoint.sh` ä¸­çš„ `build_target` å˜é‡ï¼ˆå½“å‰ä¸º "server"ï¼‰
2. ç¡®ä¿å¯¹åº”çš„æœåŠ¡æ–‡ä»¶å­˜åœ¨äº `/home/devbox/project/arkok/` ç›®å½•
3. æ›´æ–° `.env` æ–‡ä»¶ä¸­çš„ç›¸åº”é…ç½®
4. é‡å¯æœåŠ¡

#### Q5: å­¦ç”Ÿç­çº§/æ•°æ®æŒä¹…åŒ–é—®é¢˜

**é—®é¢˜ç°è±¡**ï¼šåœ¨æ‰‹æœºç«¯ç®¡ç†åå°ä¿®æ”¹å­¦ç”Ÿç­çº§ï¼ˆæˆ–ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯ï¼‰åï¼Œåˆ·æ–°é¡µé¢æ•°æ®åˆæ¢å¤åˆ°é»˜è®¤å€¼

**æ ¹æœ¬åŸå› åˆ†æ**ï¼š
1. **å‰ç«¯å±‚é¢**ï¼š`handleMoveToTeacherClass` å‡½æ•°å·²æ­£ç¡®è°ƒç”¨ PUT `/api/students/:id` API
2. **åç«¯å±‚é¢**ï¼šserver.js ä¸­çš„ API å®ç°å·²æ­£ç¡®å¤„ç† `class_name` å­—æ®µçš„æ›´æ–°
3. **æ•°æ®åº“å±‚é¢**ï¼šéœ€è¦æ£€æŸ¥ `students` è¡¨çš„ `class_name` å­—æ®µæ˜¯å¦å­˜åœ¨çº¦æŸæˆ–é»˜è®¤å€¼

**æ’æŸ¥æ­¥éª¤**ï¼š
1. **æ£€æŸ¥å‰ç«¯è¯·æ±‚**ï¼šä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹ Network é¢æ¿ï¼Œç¡®è®¤ PUT è¯·æ±‚æ­£æ–‡ä¸­åŒ…å«æ­£ç¡®çš„ class_name
   ```
   PUT /api/students/15
   { "class_name": "é»„è€å¸ˆç­" }
   ```

2. **æ£€æŸ¥ API å“åº”**ï¼šç¡®è®¤åç«¯è¿”å› 200 ä¸”è¿”å›çš„æ•°æ®ä¸­åŒ…å«æ›´æ–°åçš„ class_name

3. **æ£€æŸ¥æ•°æ®åº“ Schema**ï¼ˆå¦‚é—®é¢˜ä»å­˜åœ¨ï¼‰ï¼š
   ```bash
   # è¿æ¥åˆ° PostgreSQL
   psql -h growark-postgresql.ns-bg6fgs6y.svc -U postgres -d postgres

   # æŸ¥çœ‹ students è¡¨ç»“æ„
   \d students
   ```
   æ£€æŸ¥ `class_name` å­—æ®µæ˜¯å¦æœ‰ï¼š
   - DEFAULT çº¦æŸï¼ˆå¦‚ DEFAULT 'ä¸‰å¹´ä¸€ç­'ï¼‰
   - NOT NULL çº¦æŸ
   - CHECK çº¦æŸ

4. **æ£€æŸ¥æ•°æ®åº“è§¦å‘å™¨**ï¼šç¡®è®¤æ˜¯å¦æœ‰è§¦å‘å™¨ä¼šé‡ç½® class_name å­—æ®µ
   ```sql
   SELECT * FROM pg_trigger WHERE tgrelid = 'students'::regclass;
   ```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¦‚æœ `class_name` å­—æ®µæœ‰ DEFAULT çº¦æŸï¼Œéœ€è¦ç§»é™¤ï¼š
  ```sql
  ALTER TABLE students ALTER COLUMN class_name DROP DEFAULT;
  ```

- ç¡®ä¿å‰ç«¯å‘é€çš„å­—æ®µåä¸åç«¯ API æœŸæœ›çš„å­—æ®µåä¸€è‡´ï¼š
  - å‰ç«¯å‘é€ï¼š`class_name`
  - åç«¯æ¥æ”¶ï¼š`class_name`ï¼ˆserver.js line 374ï¼‰
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»– API æˆ–å®šæ—¶ä»»åŠ¡ä¼šè¦†ç›– class_name å­—æ®µ

**éªŒè¯æ•°æ®æŒä¹…åŒ–**ï¼š
```bash
# ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ç¡®è®¤æ•°æ®æ˜¯å¦ä¿å­˜
curl http://localhost:3000/api/students
# æ£€æŸ¥è¿”å›çš„ JSON ä¸­ class_name æ˜¯å¦æ­£ç¡®
```

### 9. å¿«é€Ÿå¯åŠ¨å‘½ä»¤

```bash
cd /home/devbox/project

# åå°å¯åŠ¨
nohup ./entrypoint.sh > server.log 2>&1 &

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
tail -f server.log
```

### 10. åœæ­¢æœåŠ¡

```bash
# æŸ¥æ‰¾è¿›ç¨‹ ID
ps aux | grep "arkok/server.js"

# æ€æ­»è¿›ç¨‹ï¼ˆä¼˜é›…å…³é—­ï¼‰
kill <PID>

# å¼ºåˆ¶æ€æ­»è¿›ç¨‹
kill -9 <PID>
```

### 11. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®

1. **ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒæ¨¡å¼**ï¼š
   ```bash
   ./entrypoint.sh production
   ```

2. **ä½¿ç”¨è¿›ç¨‹ç®¡ç†å™¨**ï¼ˆæ¨è PM2ï¼‰ï¼š
   ```bash
   npm install -g pm2
   cd /home/devbox/project/arkok
   pm2 start server.js --name "arkok-server" --env production
   ```

3. **é…ç½®åå‘ä»£ç†**ï¼ˆNginxï¼‰ï¼š
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;

       location / {
           proxy_pass http://localhost:3000;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_cache_bypass $http_upgrade;
       }
   }
   ```

### 12. æ•°æ®å¤‡ä»½ä¸æ¢å¤

Sealos PostgreSQL æ•°æ®åº“ä¼šå®šæœŸè‡ªåŠ¨å¤‡ä»½ï¼Œå¦‚éœ€æ‰‹åŠ¨å¤‡ä»½ï¼š

```bash
# å¯¼å‡ºæ•°æ®åº“
pg_dump -h growark-postgresql.ns-bg6fgs6y.svc -U postgres -d postgres > backup.sql

# å¯¼å…¥æ•°æ®åº“
psql -h growark-postgresql.ns-bg6fgs6y.svc -U postgres -d postgres < backup.sql
```

---

**æœ€åæ›´æ–°**ï¼š2025-11-25 07:50
**æ–‡æ¡£ä½ç½®**ï¼š`/home/devbox/project/å¯åŠ¨å…¬ç½‘.md`
**é…ç½®ç‰ˆæœ¬**ï¼šarkok-server-v1.1
**æ•°æ®åº“**ï¼šSealos PostgreSQL (growark-postgresql.ns-bg6fgs6y.svc)
**ä¸»è¦æ›´æ–°**ï¼š
- æ–°å¢å‰ç«¯èµ„æºæ„å»ºä¸ç®¡ç†ç« èŠ‚
- æ–°å¢æ‰‹æœºç«¯ç©ºç™½é¡µï¼ˆ404é”™è¯¯ï¼‰è§£å†³æ–¹æ¡ˆ
- æ–°å¢æœåŠ¡æ¨¡å¼è¯´æ˜ï¼ˆä¸ºä»€ä¹ˆåªéœ€è¦ 3000 ç«¯å£ï¼‰
- æ–°å¢å­¦ç”Ÿæ•°æ®æŒä¹…åŒ–é—®é¢˜æ’æŸ¥ï¼ˆQ5ï¼‰
