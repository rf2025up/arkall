# 12æœˆ11æ—¥ç³»ç»Ÿå‡çº§æŠ€æœ¯è¯´æ˜æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ¶å®šæ—¶é—´**: 2025-12-11
**é¡¹ç›®**: Arkok + StarJourney æ·±åº¦èåˆç³»ç»Ÿ
**å‡çº§ç›®æ ‡**: å®ç°å¤‡è¯¾é¡µâ†’è´¨æ£€é¡µâ†’ç»“ç®—é¡µå®Œæ•´æ•°æ®æµé—­ç¯

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### å½“å‰ç³»ç»Ÿæ¶æ„ç°çŠ¶

#### åŒæœåŠ¡å™¨æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Growark       â”‚    â”‚   StarJourney   â”‚
â”‚   (ç«¯å£ 3000)   â”‚    â”‚   (ç«¯å£ 3001)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å­¦ç”Ÿç®¡ç†      â”‚    â”‚ â€¢ é”™é¢˜ç®¡ç†      â”‚
â”‚ â€¢ ç§¯åˆ†ç³»ç»Ÿ      â”‚    â”‚ â€¢ è¿‡å…³è®°å½•      â”‚
â”‚ â€¢ æŒ‘æˆ˜PK        â”‚    â”‚ â€¢ å­¦æƒ…æŠ¥å‘Š      â”‚
â”‚ â€¢ å‹‹ç« ä¹ æƒ¯      â”‚    â”‚ â€¢ æ•™å¸ˆå¤‡è¯¾      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ PostgreSQL      â”‚
            â”‚ å…±äº«æ•°æ®åº“       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç°æœ‰æ•°æ®åº“è¡¨ç»“æ„åˆ†æ

| è¡¨åˆ†ç±» | è¡¨å | çŠ¶æ€ | åŠŸèƒ½ | å‡çº§éœ€æ±‚ |
|--------|------|------|------|----------|
| **æ ¸å¿ƒä¸šåŠ¡è¡¨** | `students` | âœ… å®Œæ•´ | å­¦ç”ŸåŸºç¡€ä¿¡æ¯ | æ‰©å±•teacher_idå­—æ®µ |
| | `teams` | âœ… å®Œæ•´ | ç­çº§ç®¡ç† | æ—  |
| | `groups` | âœ… å®Œæ•´ | åˆ†ç»„ç®¡ç† | æ—  |
| | `challenges` | âœ… å®Œæ•´ | æŒ‘æˆ˜ç³»ç»Ÿ | æ—  |
| | `pk_matches` | âœ… å®Œæ•´ | PKå¯¹å†³ | æ—  |
| | `tasks` | âœ… å®Œæ•´ | ä»»åŠ¡ç³»ç»Ÿ | æ—  |
| | `badges` | âœ… å®Œæ•´ | å‹‹ç« ç³»ç»Ÿ | æ—  |
| | `habits` | âœ… å®Œæ•´ | ä¹ æƒ¯æ‰“å¡ | æ—  |
| **LMSæ‰©å±•è¡¨** | `lms_mistakes` | âœ… å·²åˆ›å»º | é”™é¢˜è®°å½• | æ—  |
| | `lms_student_record` | âœ… å·²åˆ›å»º | è¿‡å…³è®°å½• | æ‰©å±•personalizationå­—æ®µ |
| | `lms_academic_reports` | âœ… å·²åˆ›å»º | å­¦æƒ…æŠ¥å‘Š | æ‰©å±•ç»Ÿè®¡å­—æ®µ |
| | `lms_lesson_plans` | âœ… å·²åˆ›å»º | æ•™å¸ˆå¤‡è¯¾ | æ‰©å±•å‘å¸ƒåŠŸèƒ½ |

### å‡çº§ç›®æ ‡

å®ç°å®Œæ•´çš„"å¤‡è¯¾â†’è´¨æ£€â†’ç»“ç®—"æ•°æ®æµé—­ç¯ï¼š

```
å¤‡è¯¾é¡µé¢ (PrepView.tsx)
    â†“ å‘å¸ƒ
APIæ•°æ®åŒæ­¥
    â†“ è‡ªåŠ¨åˆ›å»º
è´¨æ£€é¡µé¢ (QCView.tsx)
    â†“ ä»»åŠ¡å®Œæˆ
ç»éªŒå€¼è‡ªåŠ¨ç»“ç®—
    â†“ æ•°æ®æ±‡æ€»
ç»“ç®—é¡µé¢ (SettleView.tsx)
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡

### æ•°æ®æµæ¶æ„å›¾

```mermaid
graph TB
    A[å¤‡è¯¾é¡µé¢] -->|å‘å¸ƒè®¡åˆ’| B[lms_lesson_plans]
    B -->|è‡ªåŠ¨åŒæ­¥| C[lms_student_record]
    C -->|å®æ—¶åŠ è½½| D[è´¨æ£€é¡µé¢]
    D -->|ä»»åŠ¡å®Œæˆ| E[æ›´æ–°çŠ¶æ€]
    E -->|è‡ªåŠ¨ç»“ç®—| F[studentsè¡¨]
    F -->|æ•°æ®æ±‡æ€»| G[ç»“ç®—é¡µé¢]
    G -->|ç»Ÿè®¡åˆ†æ| H[lms_academic_reports]

    I[ä¸ªæ€§åŒ–å®šåˆ¶] -->|å¯é€‰æ‰©å±•| C
    J[ä»»åŠ¡åº“] -->|æ”¯æŒä»»åŠ¡é€‰æ‹©| A
    K[é”™é¢˜ç®¡ç†] -->|é›†æˆå±•ç¤º| D
```

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—æ˜ å°„

| åŠŸèƒ½æ¨¡å— | å‰ç«¯ç»„ä»¶ | æ•°æ®è¡¨ | APIç«¯ç‚¹ | çŠ¶æ€ |
|----------|----------|--------|----------|------|
| **å¤‡è¯¾å‘å¸ƒ** | PrepView.tsx | `lms_lesson_plans` | `POST /api/lms/publish-plan` | ğŸ”´ éœ€å¼€å‘ |
| **QCä»»åŠ¡åŒæ­¥** | QCView.tsx | `lms_student_record` | `GET /api/lms/today-records` | ğŸ”´ éœ€å¼€å‘ |
| **ä»»åŠ¡å®Œæˆ** | QCView.tsx | `lms_student_record` | `PATCH /api/lms/complete-task` | ğŸ”´ éœ€å¼€å‘ |
| **ç»éªŒç»“ç®—** | SettleView.tsx | `students` | `POST /api/lms/settle-batch` | ğŸ”´ éœ€å¼€å‘ |
| **å­¦æƒ…æŠ¥å‘Š** | StudentProfile.tsx | `lms_academic_reports` | `GET /api/lms/academic-report` | âš ï¸ éœ€æ‰©å±• |
| **é”™é¢˜ç®¡ç†** | é”™é¢˜ç®¡ç†Tab | `lms_mistakes` | `GET/POST /api/mistakes` | âœ… å·²å®ç° |

---

## ğŸ“Š æ•°æ®åº“ç»“æ„è¯¦ç»†è®¾è®¡

### 1. ç°æœ‰è¡¨æ‰©å±•è®¾è®¡

#### lms_lesson_plans è¡¨æ‰©å±•
```sql
-- ç°æœ‰å­—æ®µä¿æŒä¸å˜ï¼Œæ–°å¢ä»¥ä¸‹å­—æ®µ
ALTER TABLE lms_lesson_plans
ADD COLUMN IF NOT EXISTS
  publish_status VARCHAR(20) DEFAULT 'draft',        -- draft, published, archived
  publish_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,   -- å‘å¸ƒæ—¶é—´
  target_student_ids INTEGER[],                      -- ç›®æ ‡å­¦ç”ŸIDåˆ—è¡¨
  auto_create_records BOOLEAN DEFAULT TRUE,           -- æ˜¯å¦è‡ªåŠ¨åˆ›å»ºå­¦ç”Ÿè®°å½•
  qc_completion_count INTEGER DEFAULT 0,              -- å®Œæˆå­¦ç”Ÿæ•°é‡
  total_students INTEGER DEFAULT 0,                  -- ç›®æ ‡å­¦ç”Ÿæ€»æ•°
  experience_summary JSONB DEFAULT '{}';              -- ç»éªŒå€¼æ±‡æ€»
```

**åŠŸèƒ½è¯´æ˜**:
- `publish_status`: å¤‡è¯¾çŠ¶æ€ç®¡ç†ï¼ˆè‰ç¨¿â†’å·²å‘å¸ƒâ†’å·²å½’æ¡£ï¼‰
- `target_student_ids`: æ”¯æŒé€‰æ‹©æ€§å‘å¸ƒç»™ç‰¹å®šå­¦ç”Ÿ
- `auto_create_records`: è‡ªåŠ¨åˆ›å»ºå­¦ç”Ÿè¿‡å…³è®°å½•çš„å¼€å…³
- `experience_summary`: å­˜å‚¨è¯¥å¤‡è¯¾è®¡åˆ’äº§ç”Ÿçš„ç»éªŒå€¼ç»Ÿè®¡

#### lms_student_record è¡¨æ‰©å±•
```sql
-- ç°æœ‰å­—æ®µä¿æŒä¸å˜ï¼Œæ–°å¢ä»¥ä¸‹å­—æ®µ
ALTER TABLE lms_student_record
ADD COLUMN IF NOT EXISTS
  plan_id UUID REFERENCES lms_lesson_plans(id),       -- å…³è”å¤‡è¯¾è®¡åˆ’
  is_settled BOOLEAN DEFAULT FALSE,                  -- æ˜¯å¦å·²ç»“ç®—ç»éªŒå€¼
  settled_at TIMESTAMP,                              -- ç»“ç®—æ—¶é—´
  personalized_by VARCHAR(50) DEFAULT NULL,          -- ä¸ªæ€§åŒ–å®šåˆ¶è€…
  original_exp_value INTEGER,                        -- åŸå§‹ç»éªŒå€¼
  completion_notes TEXT,                              -- å®Œæˆå¤‡æ³¨
  batch_id VARCHAR(100) DEFAULT NULL;                -- æ‰¹é‡æ“ä½œID
```

**åŠŸèƒ½è¯´æ˜**:
- `plan_id`: å»ºç«‹ä¸å¤‡è¯¾è®¡åˆ’çš„å…³è”å…³ç³»
- `is_settled`: é˜²æ­¢é‡å¤ç»“ç®—ç»éªŒå€¼
- `personalized_by`: è®°å½•ä¸ªæ€§åŒ–å®šåˆ¶æ¥æº
- `batch_id`: æ”¯æŒæ‰¹é‡æ“ä½œè¿½è¸ª

#### students è¡¨æ‰©å±•
```sql
ALTER TABLE students
ADD COLUMN IF NOT EXISTS
  teacher_id VARCHAR(100) DEFAULT 'default_teacher', -- æ•™å¸ˆå½’å±
  current_lesson_plan UUID REFERENCES lms_lesson_plans(id), -- å½“å‰è¯¾ç¨‹è¿›åº¦
  learning_path JSONB DEFAULT '{}',                  -- å­¦ä¹ è·¯å¾„é…ç½®
  daily_task_count INTEGER DEFAULT 0,               -- ä»Šæ—¥ä»»åŠ¡æ•°é‡
  daily_completed_count INTEGER DEFAULT 0;          -- ä»Šæ—¥å®Œæˆä»»åŠ¡æ•°é‡
```

#### lms_academic_reports è¡¨æ‰©å±•
```sql
ALTER TABLE lms_academic_reports
ADD COLUMN IF NOT EXISTS
  daily_stats JSONB DEFAULT '{}',                    -- æ¯æ—¥ç»Ÿè®¡æ•°æ®
  weekly_stats JSONB DEFAULT '{}',                   -- æ¯å‘¨ç»Ÿè®¡æ•°æ®
  monthly_stats JSONB DEFAULT '{}',                  -- æ¯æœˆç»Ÿè®¡æ•°æ®
  task_completion_rate DECIMAL(5,2) DEFAULT 0.00,    -- ä»»åŠ¡å®Œæˆç‡
  progress_summary JSONB DEFAULT '{}',              -- è¿›åº¦æ±‡æ€»
  personalized_insights TEXT[],                      -- ä¸ªæ€§åŒ–æ´å¯Ÿ
  auto_generated BOOLEAN DEFAULT FALSE;              -- æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ
```

### 2. å‰ç«¯æ•°æ®ç»“æ„ä¸æ•°æ®åº“æ˜ å°„

#### PrepView.tsx æ•°æ®æ¨¡å‹æ˜ å°„
```typescript
// å‰ç«¯æ•°æ®ç»“æ„
interface CourseInfo {
  chinese: { unit: string; lesson?: string; title: string };
  math: { unit: string; lesson: string; title: string };
  english: { unit: string; title: string };
}

interface PlanData {
  date: string;
  courseInfo: CourseInfo;
  qc: Record<string, string[]>;           // {chinese: ["ç”Ÿå­—å¬å†™"], math: ["å£ç®—è¾¾æ ‡"]}
  tasks: string[];                       // ["å®Œæˆæ•°å­¦ä¹¦é¢ä½œä¸š"]
  specialTasks: SpecialTaskItem[];       // ä¸ªæ€§åŒ–åŠ é¤
}

// æ•°æ®åº“æ˜ å°„å…³ç³»
PlanData â†’ lms_lesson_plans (3æ¡è®°å½•ï¼Œæ¯ç§‘ä¸€æ¡)
CourseInfo.æ•°å­¦ â†’ lms_lesson_plans (subject='math', unit=4, lesson=1, title='é™¤æ³•')
QC.è¯­æ–‡ â†’ lms_student_record (type='QC', subject='chinese', å¤šæ¡è®°å½•)
Tasks â†’ lms_student_record (type='TASK', å¤šæ¡è®°å½•)
SpecialTasks â†’ lms_student_record (is_special=true, å¤šæ¡è®°å½•)
```

#### QCView.tsx æ•°æ®æ¨¡å‹æ˜ å°„
```typescript
// å‰ç«¯æœŸæœ›çš„æ•°æ®ç»“æ„
interface StudentTaskRecord {
  id: string;
  studentId: number;
  studentName: string;
  tasks: TaskRecord[];
}

interface TaskRecord {
  id: string;
  planId: string;
  taskName: string;
  taskType: 'QC' | 'TASK' | 'SPECIAL';
  status: 'pending' | 'passed' | 'completed';
  expValue: number;
  attemptCount: number;
  isPersonalized: boolean;
}

// æ•°æ®åº“æŸ¥è¯¢SQL
SELECT
  sr.id,
  sr.plan_id,
  sr.student_id,
  s.name as student_name,
  sr.task_name,
  sr.task_type,
  sr.status,
  sr.exp_value,
  sr.attempt_count,
  sr.lesson_subject,
  sr.lesson_unit,
  sr.lesson_lesson,
  sr.is_special
FROM lms_student_record sr
JOIN students s ON sr.student_id = s.id
LEFT JOIN lms_lesson_plans lp ON sr.plan_id = lp.id
WHERE lp.publish_date = CURRENT_DATE
ORDER BY s.name, sr.lesson_subject;
```

---

## ğŸ”§ APIæ¥å£è®¾è®¡

### æ ¸å¿ƒAPIç«¯ç‚¹

#### 1. å¤‡è¯¾å‘å¸ƒAPI
```javascript
POST /api/lms/publish-plan
Content-Type: application/json

Request Body:
{
  "publishDate": "2025-12-11",
  "courseInfo": {
    "chinese": {"unit": "3", "lesson": "2", "title": "å¤è¯—äºŒé¦–"},
    "math": {"unit": "4", "lesson": "1", "title": "é™¤æ³•"},
    "english": {"unit": "2", "title": "Hello World"}
  },
  "qcItems": {
    "chinese": ["ç”Ÿå­—å¬å†™", "è¯¾æ–‡èƒŒè¯µ"],
    "math": ["å£ç®—è¾¾æ ‡", "ç«–å¼è®¡ç®—"],
    "english": ["å•è¯é»˜å†™"]
  },
  "tasks": ["å®Œæˆæ•°å­¦ä¹¦é¢ä½œä¸š", "è¯¾å¤–é˜…è¯»30åˆ†é’Ÿ"],
  "specialTasks": [
    {
      "students": ["å¼ å°æ˜", "æå°èŠ±"],
      "tasks": ["ç½šæŠ„é”™é¢˜", "æœ—è¯»è¯¾æ–‡"]
    }
  ],
  "targetStudentIds": [1, 2, 3, 4, 5], // å¯é€‰ï¼Œç©ºè¡¨ç¤ºå…¨ä½“å­¦ç”Ÿ
  "teacherId": "teacher_001"
}

Response:
{
  "success": true,
  "data": {
    "planIds": {
      "chinese": "uuid-1",
      "math": "uuid-2",
      "english": "uuid-3"
    },
    "createdRecords": 15,
    "totalStudents": 5,
    "estimatedExp": 150
  },
  "message": "å¤‡è¯¾è®¡åˆ’å‘å¸ƒæˆåŠŸ"
}
```

**å®ç°é€»è¾‘**:
```sql
-- 1. åˆ›å»º3æ¡å¤‡è¯¾è®¡åˆ’è®°å½•ï¼ˆæ¯ç§‘ä¸€æ¡ï¼‰
INSERT INTO lms_lesson_plans (teacher_id, subject, unit, lesson, title,
  qc_items, task_items, special_tasks, publish_status, target_student_ids)
VALUES
  ('teacher_001', 'chinese', 3, 2, 'å¤è¯—äºŒé¦–',
   ARRAY['ç”Ÿå­—å¬å†™', 'è¯¾æ–‡èƒŒè¯µ'],
   ARRAY['å®Œæˆæ•°å­¦ä¹¦é¢ä½œä¸š'],
   '[{"students": ["å¼ å°æ˜"], "tasks": ["ç½šæŠ„é”™é¢˜"]}]',
   'published', ARRAY[1,2,3,4,5]);

-- 2. æ‰¹é‡åˆ›å»ºå­¦ç”Ÿè®°å½•
INSERT INTO lms_student_record (student_id, plan_id, task_name, task_type,
  exp_value, lesson_subject, lesson_unit, lesson_lesson, is_special)
SELECT
  s.id as student_id,
  plan.id as plan_id,
  unnest(qc_items) as task_name,
  'QC' as task_type,
  15 as exp_value,
  plan.subject,
  plan.unit,
  plan.lesson,
  false as is_special
FROM students s, lms_lesson_plans plan
WHERE plan.id = $plan_id AND ($target_student_ids IS NULL OR s.id = ANY($target_student_ids));
```

#### 2. è·å–ä»Šæ—¥ä»»åŠ¡API
```javascript
GET /api/lms/today-records?studentId=123&date=2025-12-11

Response:
{
  "success": true,
  "data": {
    "studentInfo": {
      "id": 123,
      "name": "å¼ å°æ˜",
      "class_name": "ä¸‰å¹´çº§1ç­"
    },
    "tasks": [
      {
        "id": "record-uuid-1",
        "planId": "plan-uuid-1",
        "taskName": "ç”Ÿå­—å¬å†™",
        "taskType": "QC",
        "subject": "chinese",
        "status": "pending",
        "expValue": 15,
        "attemptCount": 0,
        "isSpecial": false,
        "lessonInfo": {
          "unit": 3,
          "lesson": 2,
          "title": "å¤è¯—äºŒé¦–"
        }
      },
      {
        "id": "record-uuid-2",
        "taskName": "ç½šæŠ„é”™é¢˜",
        "taskType": "SPECIAL",
        "subject": "math",
        "status": "pending",
        "expValue": 30,
        "attemptCount": 0,
        "isSpecial": true,
        "assignedBy": "teacher"
      }
    ],
    "statistics": {
      "totalTasks": 8,
      "pendingTasks": 6,
      "completedTasks": 2,
      "totalExpPending": 120
    }
  }
}
```

#### 3. ä»»åŠ¡å®Œæˆä¸ç»“ç®—API
```javascript
PATCH /api/lms/records/:recordId/complete
Content-Type: application/json

Request Body:
{
  "status": "passed", // æˆ– "completed"
  "completionDuration": 300, // å®Œæˆè€—æ—¶ï¼ˆç§’ï¼‰
  "difficultyRating": 3, // éš¾åº¦è¯„åˆ† 1-5
  "notes": "å®Œæˆè´¨é‡å¾ˆå¥½"
}

Response:
{
  "success": true,
  "data": {
    "recordId": "record-uuid-1",
    "previousStatus": "pending",
    "newStatus": "passed",
    "expAwarded": 15,
    "pointsAwarded": 7,
    "studentCurrentExp": 245,
    "studentCurrentPoints": 122,
    "attemptCount": 1
  },
  "message": "ä»»åŠ¡å®Œæˆï¼Œç»éªŒå€¼å·²ç»“ç®—"
}
```

**å®ç°é€»è¾‘**:
```sql
-- 1. æ›´æ–°ä»»åŠ¡è®°å½•çŠ¶æ€
UPDATE lms_student_record
SET
  status = $1,
  completed_at = CURRENT_TIMESTAMP,
  attempt_count = attempt_count + 1,
  completion_notes = $2
WHERE id = $3;

-- 2. ç»“ç®—ç»éªŒå€¼ï¼ˆå¦‚æœé¦–æ¬¡å®Œæˆï¼‰
UPDATE students
SET
  total_exp = total_exp + $exp_value,
  score = score + $points_value
WHERE id = $student_id AND
  NOT EXISTS (
    SELECT 1 FROM lms_student_record sr
    WHERE sr.id = $record_id AND sr.is_settled = TRUE
  );

-- 3. æ ‡è®°ä¸ºå·²ç»“ç®—
UPDATE lms_student_record
SET is_settled = TRUE, settled_at = CURRENT_TIMESTAMP
WHERE id = $record_id;
```

#### 4. æ‰¹é‡ç»“ç®—API
```javascript
POST /api/lms/batch-settle
Content-Type: application/json

Request Body:
{
  "date": "2025-12-11",
  "studentIds": [1, 2, 3, 4, 5], // å¯é€‰ï¼Œç©ºè¡¨ç¤ºå…¨ä½“å­¦ç”Ÿ
  "includeOnlyCompleted": true
}

Response:
{
  "success": true,
  "data": {
    "settlementBatch": "batch-uuid-123",
    "totalStudents": 5,
    "settledStudents": 4,
    "totalRecords": 32,
    "settledRecords": 28,
    "totalExpAwarded": 420,
    "totalPointsAwarded": 210,
    "breakdown": [
      {
        "studentId": 1,
        "studentName": "å¼ å°æ˜",
        "settledRecords": 6,
        "expAwarded": 90,
        "pointsAwarded": 45
      }
    ]
  },
  "message": "æ‰¹é‡ç»“ç®—å®Œæˆ"
}
```

---

## ğŸ¯ å‰ç«¯é›†æˆæ–¹æ¡ˆ

### 1. PrepView.tsx é›†æˆ

#### publishPlan å‡½æ•°é‡æ„
```typescript
// ç°æœ‰å‡½æ•°
const publishPlan = () => {
  const plan = {
    date: dateStr,
    courseInfo,
    qc: selectedQC,
    tasks: selectedTasks,
    specialTasks
  };
  console.log("å‘å¸ƒæ•°æ®:", plan);
  alert("ä»Šæ—¥è®¡åˆ’å‘å¸ƒæˆåŠŸï¼");
};

// æ–°å‡½æ•° - APIé›†æˆ
const publishPlan = async () => {
  try {
    // 1. è·å–å­¦ç”Ÿåˆ—è¡¨
    const studentsResponse = await fetch('/api/students');
    const studentsData = await studentsResponse.json();

    if (!studentsData.success) {
      throw new Error('è·å–å­¦ç”Ÿåˆ—è¡¨å¤±è´¥');
    }

    // 2. æ„å»ºå‘å¸ƒæ•°æ®
    const planData = {
      publishDate: dateStr,
      courseInfo,
      qcItems: selectedQC,
      tasks: selectedTasks,
      specialTasks,
      targetStudentIds: studentsData.data.map(s => s.id), // å…¨ä½“å­¦ç”Ÿ
      teacherId: 'current_teacher' // TODO: ä»ç”¨æˆ·ä¿¡æ¯è·å–
    };

    // 3. è°ƒç”¨å‘å¸ƒAPI
    const response = await fetch('/api/lms/publish-plan', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(planData)
    });

    const result = await response.json();

    if (result.success) {
      alert(`å‘å¸ƒæˆåŠŸï¼å·²ä¸º${result.data.totalStudents}åå­¦ç”Ÿåˆ›å»º${result.data.createdRecords}é¡¹ä»»åŠ¡`);
    } else {
      throw new Error(result.message || 'å‘å¸ƒå¤±è´¥');
    }

  } catch (error) {
    console.error('å‘å¸ƒå¤±è´¥:', error);
    alert('å‘å¸ƒå¤±è´¥ï¼š' + error.message);
  }
};
```

### 2. QCView.tsx é›†æˆ

#### loadStudentsData å‡½æ•°é‡æ„
```typescript
// ç°æœ‰å‡½æ•°ï¼ˆå‡è®¾ä»æœ¬åœ°çŠ¶æ€è·å–ï¼‰
const loadStudentsData = () => {
  // æœ¬åœ°æ•°æ®å¤„ç†é€»è¾‘
};

// æ–°å‡½æ•° - APIé›†æˆ
const loadStudentsData = async () => {
  try {
    const today = new Date().toISOString().split('T')[0];
    const response = await fetch(`/api/lms/today-records?date=${today}`);

    if (!response.ok) {
      throw new Error('åŠ è½½ä»Šæ—¥ä»»åŠ¡å¤±è´¥');
    }

    const result = await response.json();

    if (result.success) {
      // è½¬æ¢APIæ•°æ®ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼
      const studentsData = transformAPIDataToStudentsFormat(result.data);
      setStudents(studentsData);
      setFilteredStudents(studentsData);
    } else {
      throw new Error(result.message);
    }

  } catch (error) {
    console.error('åŠ è½½å¤±è´¥:', error);
    // é™çº§ï¼šæ˜¾ç¤ºé”™è¯¯çŠ¶æ€ï¼Œä½†ä¸å½±å“ç°æœ‰åŠŸèƒ½
    alert('åŠ è½½ä»Šæ—¥ä»»åŠ¡å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
  }
};

// æ•°æ®æ ¼å¼è½¬æ¢å‡½æ•°
const transformAPIDataToStudentsFormat = (apiData) => {
  // æŒ‰å­¦ç”Ÿåˆ†ç»„ä»»åŠ¡
  const studentsMap = new Map();

  apiData.tasks.forEach(task => {
    if (!studentsMap.has(task.studentId)) {
      studentsMap.set(task.studentId, {
        id: task.studentId,
        name: task.studentName,
        avatar: '', // TODO: ä»å­¦ç”Ÿä¿¡æ¯è·å–
        avatar_url: '', // TODO: ä»å­¦ç”Ÿä¿¡æ¯è·å–
        className: '', // TODO: ä»å­¦ç”Ÿä¿¡æ¯è·å–
        records: []
      });
    }

    studentsMap.get(task.studentId).records.push({
      id: task.id,
      planId: task.planId,
      task_name: task.taskName,
      task_type: task.taskType,
      subject: task.subject,
      status: task.status,
      exp_value: task.expValue,
      attempt_count: task.attemptCount,
      is_special: task.isSpecial,
      lesson_info: task.lessonInfo
    });
  });

  return Array.from(studentsMap.values());
};
```

#### ä»»åŠ¡å®Œæˆæ“ä½œé›†æˆ
```typescript
// æ–°å¢ï¼šè®°å½•è¾…å¯¼å°è¯•
const recordAttempt = async (recordId, studentId) => {
  try {
    const response = await fetch(`/api/lms/records/${recordId}/attempt`, {
      method: 'PATCH'
    });

    const result = await response.json();

    if (result.success) {
      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      updateStudentRecord(recordId, {
        attempt_count: result.data.attemptCount
      });

      // æ˜¾ç¤ºç«ç„°åŠ¨ç”»ï¼ˆç°æœ‰é€»è¾‘ä¿æŒä¸å˜ï¼‰
      if (result.data.attemptCount === 3) {
        showFlameAnimation(); // ç°æœ‰å‡½æ•°
      }
    }
  } catch (error) {
    console.error('è®°å½•è¾…å¯¼å¤±è´¥:', error);
    // é™çº§ï¼šæ›´æ–°æœ¬åœ°çŠ¶æ€ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒ
    updateStudentRecord(recordId, {
      attempt_count: (getStudentRecord(recordId)?.attempt_count || 0) + 1
    });
  }
};

// æ–°å¢ï¼šæ ‡è®°ä»»åŠ¡å®Œæˆ
const markTaskCompleted = async (recordId, studentId) => {
  try {
    const response = await fetch(`/api/lms/records/${recordId}/complete`, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        status: 'passed',
        completionDuration: 0, // TODO: å®é™…è®¡æ—¶
        difficultyRating: 3,
        notes: ''
      })
    });

    const result = await response.json();

    if (result.success) {
      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      updateStudentRecord(recordId, {
        status: 'passed',
        is_settled: true
      });

      // æ˜¾ç¤ºæˆåŠŸæç¤º
      showSuccessToast(`${result.data.studentName} è·å¾—ç»éªŒ ${result.data.expAwarded}ï¼`);

      // æ›´æ–°å­¦ç”Ÿç§¯åˆ†æ˜¾ç¤ºï¼ˆå¦‚æœå½“å‰æ˜¾ç¤ºè¯¥å­¦ç”Ÿï¼‰
      if (currentStudent?.id === studentId) {
        setCurrentStudent(prev => ({
          ...prev,
          score: result.data.studentCurrentPoints,
          total_exp: result.data.studentCurrentExp
        }));
      }
    }
  } catch (error) {
    console.error('ä»»åŠ¡å®Œæˆå¤±è´¥:', error);
    alert('ä»»åŠ¡å®Œæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
  }
};
```

### 3. SettleView.tsx é›†æˆ

#### ç»“ç®—ç»Ÿè®¡åŠŸèƒ½
```typescript
// æ–°å¢ï¼šè®¡ç®—å¾…ç»“ç®—ç»Ÿè®¡
const calculatePendingSettlement = async () => {
  try {
    const today = new Date().toISOString().split('T')[0];
    const response = await fetch('/api/lms/settlement-stats?date=' + today);

    if (!response.ok) {
      throw new Error('è·å–ç»“ç®—ç»Ÿè®¡å¤±è´¥');
    }

    const result = await response.json();

    if (result.success) {
      setSettlementData(result.data);
      setFilteredSettlementData(result.data);
    }
  } catch (error) {
    console.error('è·å–ç»“ç®—ç»Ÿè®¡å¤±è´¥:', error);
    // é™çº§ï¼šæ˜¾ç¤ºç©ºçŠ¶æ€
    setSettlementData([]);
    setFilteredSettlementData([]);
  }
};

// æ–°å¢ï¼šæ‰¹é‡ç»“ç®—
const executeBatchSettlement = async (selectedStudentIds) => {
  try {
    const response = await fetch('/api/lms/batch-settle', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        date: new Date().toISOString().split('T')[0],
        studentIds: selectedStudentIds,
        includeOnlyCompleted: true
      })
    });

    const result = await response.json();

    if (result.success) {
      showSuccessToast(`æ‰¹é‡ç»“ç®—æˆåŠŸï¼å…±ç»“ç®—${result.data.settledStudents}åå­¦ç”Ÿï¼Œæ€»ç»éªŒ${result.data.totalExpAwarded}`);

      // åˆ·æ–°ç»“ç®—ç»Ÿè®¡
      await calculatePendingSettlement();

      // ç”Ÿæˆç»“ç®—æŠ¥å‘Š
      generateSettlementReport(result.data);
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('æ‰¹é‡ç»“ç®—å¤±è´¥:', error);
    alert('æ‰¹é‡ç»“ç®—å¤±è´¥ï¼š' + error.message);
  }
};
```

---

## âš ï¸ é£é™©åˆ†æä¸è§£å†³æ–¹æ¡ˆ

### ğŸ”´ P0çº§é£é™©ï¼ˆé˜»å¡æ€§é£é™©ï¼‰

#### 1. æ•°æ®åº“äº‹åŠ¡ä¸€è‡´æ€§é£é™©
**é£é™©æè¿°**ï¼š
```
å¤‡è¯¾å‘å¸ƒæµç¨‹æ¶‰åŠå¤šä¸ªè¡¨æ“ä½œï¼š
1. lms_lesson_plans (æ’å…¥3æ¡è®°å½•)
2. lms_student_record (æ‰¹é‡æ’å…¥Næ¡è®°å½•)
3. students (å¯é€‰çš„æ›´æ–°)
å¦‚æœä¸­é€”å¤±è´¥ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çŠ¶æ€
```

**å½±å“èŒƒå›´**ï¼š
- å¤‡è¯¾åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨
- æ•°æ®å®Œæ•´æ€§é—®é¢˜
- ç”¨æˆ·ä½“éªŒä¸¥é‡å—æŸ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// äº‹åŠ¡å®ç°ç¤ºä¾‹
app.post('/api/lms/publish-plan', async (req, res) => {
  const client = await pool.connect();

  try {
    await client.query('BEGIN');

    // 1. åˆ›å»ºå¤‡è¯¾è®¡åˆ’è®°å½•
    const planResult = await createLessonPlans(client, planData);

    // 2. æ‰¹é‡åˆ›å»ºå­¦ç”Ÿè®°å½•
    const recordsResult = await createStudentRecords(client, planResult, studentIds);

    // 3. æ›´æ–°å­¦ç”Ÿç»Ÿè®¡ä¿¡æ¯
    await updateStudentStats(client, studentIds);

    await client.query('COMMIT');

    res.json({ success: true, data: { planIds: planResult.ids, createdRecords: recordsResult.count }});

  } catch (error) {
    await client.query('ROLLBACK');
    console.error('å¤‡è¯¾å‘å¸ƒå¤±è´¥:', error);
    res.status(500).json({ success: false, error: error.message });
  } finally {
    client.release();
  }
});
```

**ç›‘æ§æªæ–½**ï¼š
- æ•°æ®åº“äº‹åŠ¡æ—¥å¿—ç›‘æ§
- å®šæœŸæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
- å¼‚å¸¸æŠ¥è­¦æœºåˆ¶

#### 2. é‡å¤ç»éªŒå€¼ç»“ç®—é£é™©
**é£é™©æè¿°**ï¼š
```
ç”±äºç½‘ç»œå»¶è¿Ÿæˆ–ç”¨æˆ·é‡å¤æ“ä½œï¼Œå¯èƒ½å¯¼è‡´åŒä¸€ä»»åŠ¡å¤šæ¬¡ç»“ç®—ç»éªŒå€¼
```

**å½±å“èŒƒå›´**ï¼š
- å­¦ç”Ÿç§¯åˆ†æ•°æ®ä¸å‡†ç¡®
- ç³»ç»Ÿå…¬å¹³æ€§é—®é¢˜
- æ•°æ®ç»Ÿè®¡é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```sql
-- ä½¿ç”¨ is_settled å­—æ®µé˜²æ­¢é‡å¤ç»“ç®—
UPDATE lms_student_record
SET is_settled = TRUE, settled_at = CURRENT_TIMESTAMP
WHERE id = $recordId AND is_settled = FALSE;

-- æ·»åŠ å”¯ä¸€çº¦æŸ
ALTER TABLE lms_student_record
ADD CONSTRAINT unique_student_plan_task
UNIQUE(student_id, plan_id, task_name);
```

**APIçº§åˆ«é˜²æŠ¤**ï¼š
```javascript
app.patch('/api/lms/records/:recordId/complete', async (req, res) => {
  // 1. æ£€æŸ¥æ˜¯å¦å·²ç»“ç®—
  const checkResult = await pool.query(
    'SELECT is_settled FROM lms_student_record WHERE id = $1',
    [recordId]
  );

  if (checkResult.rows[0]?.is_settled) {
    return res.status(400).json({
      success: false,
      error: 'è¯¥ä»»åŠ¡å·²ç»ç»“ç®—è¿‡ç»éªŒå€¼'
    });
  }

  // 2. æ‰§è¡Œç»“ç®—é€»è¾‘...
});
```

### ğŸŸ¡ P1çº§é£é™©ï¼ˆé‡è¦é£é™©ï¼‰

#### 3. å¤§ç­çº§é‡æ€§èƒ½é£é™©
**é£é™©æè¿°**ï¼š
```
å½“ç­çº§å­¦ç”Ÿæ•°é‡è¾ƒå¤šæ—¶ï¼ˆ50+å­¦ç”Ÿï¼‰ï¼Œæ‰¹é‡æ“ä½œå¯èƒ½å¯¼è‡´ï¼š
1. APIå“åº”æ—¶é—´è¿‡é•¿
2. æ•°æ®åº“è¿æ¥æ± è€—å°½
3. å‰ç«¯ç•Œé¢å¡é¡¿
```

**å½±å“èŒƒå›´**ï¼š
- ç”¨æˆ·ä½“éªŒä¸‹é™
- ç³»ç»Ÿç¨³å®šæ€§é—®é¢˜
- æœåŠ¡å™¨èµ„æºæ¶ˆè€—

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ•°æ®åº“å±‚é¢**ï¼š
```sql
-- æ‰¹é‡æ’å…¥ä¼˜åŒ–
INSERT INTO lms_student_record (student_id, plan_id, task_name, ...)
SELECT
  unnest($1::INTEGER[]) as student_id,
  unnest($2::UUID[]) as plan_id,
  unnest($3::TEXT[]) as task_name,
  ...
FROM (SELECT generate_series(1, array_length($1, 1)));
```

**APIå±‚é¢**ï¼š
```javascript
// åˆ†æ‰¹å¤„ç†å¤§ç­çº§
const BATCH_SIZE = 20;

app.post('/api/lms/batch-create-records', async (req, res) => {
  const { studentIds, tasks, planId } = req.body;

  // åˆ†æ‰¹å¤„ç†
  const batches = [];
  for (let i = 0; i < studentIds.length; i += BATCH_SIZE) {
    batches.push(studentIds.slice(i, i + BATCH_SIZE));
  }

  const results = await Promise.allSettled(
    batches.map(batch => createBatchRecords(batch, tasks, planId))
  );

  const successful = results.filter(r => r.status === 'fulfilled');
  const failed = results.filter(r => r.status === 'rejected');

  res.json({
    success: failed.length === 0,
    data: {
      totalBatches: batches.length,
      successfulBatches: successful.length,
      failedBatches: failed.length,
      totalRecords: successful.reduce((sum, r) => sum + r.value.count, 0)
    }
  });
});
```

**å‰ç«¯å±‚é¢**ï¼š
```typescript
// æ‡’åŠ è½½å’Œè™šæ‹Ÿæ»šåŠ¨
const StudentList = () => {
  const [visibleStudents, setVisibleStudents] = useState([]);
  const [startIndex, setStartIndex] = useState(0);

  // æ¯æ¬¡åªæ¸²æŸ“å¯è§åŒºåŸŸçš„å­¦ç”Ÿ
  const visibleItems = useMemo(() => {
    return students.slice(startIndex, startIndex + 20);
  }, [students, startIndex]);

  return (
    <VirtualizedList
      items={students}
      itemHeight={80}
      renderItem={({item, index}) => <StudentCard student={item} />}
    />
  );
};
```

#### 4. å¹¶å‘æ“ä½œæ•°æ®å†²çªé£é™©
**é£é™©æè¿°**ï¼š
```
å¤šä¸ªæ•™å¸ˆåŒæ—¶è¿›è¡Œå¤‡è¯¾å‘å¸ƒæˆ–ä»»åŠ¡æ“ä½œæ—¶ï¼Œå¯èƒ½å‡ºç°ï¼š
1. æ•°æ®è¦†ç›–
2. çŠ¶æ€å†²çª
3. è¯»å†™ä¸ä¸€è‡´
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

**ä¹è§‚é”æœºåˆ¶**ï¼š
```sql
-- åœ¨è¡¨ä¸­æ·»åŠ ç‰ˆæœ¬å·å­—æ®µ
ALTER TABLE lms_lesson_plans ADD COLUMN version INTEGER DEFAULT 1;

-- æ›´æ–°æ—¶æ£€æŸ¥ç‰ˆæœ¬å·
UPDATE lms_lesson_plans
SET publish_status = 'published', version = version + 1
WHERE id = $planId AND version = $expectedVersion;
```

**APIçº§åˆ«å†²çªæ£€æµ‹**ï¼š
```javascript
app.patch('/api/lms/records/:recordId/complete', async (req, res) => {
  const client = await pool.connect();

  try {
    await client.query('BEGIN');

    // ä½¿ç”¨ FOR UPDATE é”å®šè®°å½•
    const recordResult = await client.query(
      'SELECT * FROM lms_student_record WHERE id = $1 FOR UPDATE',
      [recordId]
    );

    if (recordResult.rows[0].status === 'passed') {
      await client.query('ROLLBACK');
      return res.status(409).json({
        success: false,
        error: 'è¯¥ä»»åŠ¡å·²è¢«å…¶ä»–ç”¨æˆ·å®Œæˆ'
      });
    }

    // æ‰§è¡Œæ›´æ–°...

    await client.query('COMMIT');
  } catch (error) {
    await client.query('ROLLBACK');
    // é”™è¯¯å¤„ç†...
  } finally {
    client.release();
  }
});
```

### ğŸŸ¢ P2çº§é£é™©ï¼ˆä¼˜åŒ–é£é™©ï¼‰

#### 5. å‰ç«¯çŠ¶æ€ç®¡ç†å¤æ‚åº¦é£é™©
**é£é™©æè¿°**ï¼š
```
éšç€APIé›†æˆï¼Œå‰ç«¯çŠ¶æ€ç®¡ç†å˜å¾—å¤æ‚ï¼š
1. æœ¬åœ°çŠ¶æ€ä¸è¿œç¨‹çŠ¶æ€åŒæ­¥
2. ä¹è§‚æ›´æ–°ä¸å›æ»šå¤„ç†
3. é”™è¯¯çŠ¶æ€ç®¡ç†
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

**çŠ¶æ€ç®¡ç†æ¨¡å¼**ï¼š
```typescript
// ä½¿ç”¨React Contextç®¡ç†å…¨å±€çŠ¶æ€
const LMSContext = createContext();

const LMSProvider = ({ children }) => {
  const [tasks, setTasks] = useState({});
  const [students, setStudents] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  // ä¹è§‚æ›´æ–°
  const updateTaskOptimistically = (recordId, updates) => {
    setTasks(prev => ({
      ...prev,
      [recordId]: { ...prev[recordId], ...updates, isPending: true }
    }));

    // å¼‚æ­¥æ›´æ–°æœåŠ¡å™¨
    return updateTaskOnServer(recordId, updates)
      .then(result => {
        setTasks(prev => ({
          ...prev,
          [recordId]: { ...prev[recordId], ...result.data, isPending: false }
        }));
      })
      .catch(error => {
        // å›æ»šæ›´æ–°
        setTasks(prev => ({
          ...prev,
          [recordId]: { ...prev[recordId], isPending: false, error: error.message }
        }));
        throw error;
      });
  };

  return (
    <LMSContext.Provider value={{
      tasks, students, loading, error,
      updateTaskOptimistically
    }}>
      {children}
    </LMSContext.Provider>
  );
};
```

#### 6. æ•°æ®è¿ç§»é£é™©
**é£é™©æè¿°**ï¼š
```
ç°æœ‰ç³»ç»Ÿå·²æœ‰ç”Ÿäº§æ•°æ®ï¼Œè¡¨ç»“æ„å˜æ›´å¯èƒ½å¯¼è‡´ï¼š
1. æ•°æ®ä¸¢å¤±
2. åº”ç”¨å…¼å®¹æ€§é—®é¢˜
3. å›æ»šå›°éš¾
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ¸è¿›å¼è¿ç§»ç­–ç•¥**ï¼š
```sql
-- é˜¶æ®µ1ï¼šæ·»åŠ æ–°å­—æ®µï¼Œä¿ç•™æ—§å­—æ®µ
ALTER TABLE lms_lesson_plans
ADD COLUMN publish_status_new VARCHAR(20) DEFAULT 'draft';

-- é˜¶æ®µ2ï¼šæ•°æ®è¿ç§»è„šæœ¬
UPDATE lms_lesson_plans
SET publish_status_new = CASE
  WHEN is_published = true THEN 'published'
  ELSE 'draft'
END;

-- é˜¶æ®µ3ï¼šéªŒè¯æ•°æ®ä¸€è‡´æ€§
SELECT
  publish_status,
  publish_status_new,
  COUNT(*)
FROM lms_lesson_plans
GROUP BY publish_status, publish_status_new;

-- é˜¶æ®µ4ï¼šåˆ‡æ¢å­—æ®µåï¼ˆåœ¨ç»´æŠ¤çª—å£æœŸï¼‰
ALTER TABLE lms_lesson_plans RENAME COLUMN publish_status TO publish_status_old;
ALTER TABLE lms_lesson_plans RENAME COLUMN publish_status_new TO publish_status;

-- é˜¶æ®µ5ï¼šæ¸…ç†æ—§å­—æ®µï¼ˆä¸€æ®µæ—¶é—´åï¼‰
ALTER TABLE lms_lesson_plans DROP COLUMN publish_status_old;
```

**æ•°æ®å¤‡ä»½ç­–ç•¥**ï¼š
```bash
#!/bin/bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬
DB_NAME="postgres"
BACKUP_DIR="/backup/$(date +%Y%m%d_%H%M%S)"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½å…³é”®è¡¨
pg_dump -h $DB_HOST -U $DB_USER -d $DB_NAME \
  --table="students" \
  --table="lms_lesson_plans" \
  --table="lms_student_record" \
  --format=custom \
  --file="$BACKUP_DIR/lms_tables.backup"

# éªŒè¯å¤‡ä»½
pg_restore --list "$BACKUP_DIR/lms_tables.backup" > "$BACKUP_DIR/backup_manifest.txt"

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
```

---

## ğŸ“… å®æ–½è®¡åˆ’ä¸æ—¶é—´çº¿

### é˜¶æ®µ1ï¼šåŸºç¡€APIå¼€å‘ï¼ˆ12æœˆ11æ—¥-12æ—¥ï¼‰
- [x] æ•°æ®åº“è¡¨ç»“æ„æ‰©å±•
- [x] å¤‡è¯¾å‘å¸ƒAPIå¼€å‘
- [ ] ä»Šæ—¥ä»»åŠ¡è·å–APIå¼€å‘
- [ ] ä»»åŠ¡å®ŒæˆAPIå¼€å‘
- [ ] åŸºç¡€æµ‹è¯•ç”¨ä¾‹

### é˜¶æ®µ2ï¼šå‰ç«¯é›†æˆï¼ˆ12æœˆ13æ—¥-14æ—¥ï¼‰
- [ ] PrepView.tsx APIé›†æˆ
- [ ] QCView.tsx æ•°æ®åŒæ­¥
- [ ] SettleView.tsx ç»“ç®—åŠŸèƒ½
- [ ] é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- [ ] é›†æˆæµ‹è¯•

### é˜¶æ®µ3ï¼šä¼˜åŒ–ä¸æµ‹è¯•ï¼ˆ12æœˆ15æ—¥-16æ—¥ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] å‹åŠ›æµ‹è¯•
- [ ] æ•°æ®ä¸€è‡´æ€§éªŒè¯
- [ ] æ–‡æ¡£å®Œå–„

### éªŒæ”¶æ ‡å‡†
1. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šå¤‡è¯¾â†’è´¨æ£€â†’ç»“ç®—å®Œæ•´æµç¨‹å¯ç”¨
2. **æ•°æ®ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ•°æ®æ“ä½œç¬¦åˆACIDåŸåˆ™
3. **æ€§èƒ½æŒ‡æ ‡**ï¼šAPIå“åº”æ—¶é—´<200msï¼Œæ”¯æŒ50+å­¦ç”Ÿå¹¶å‘
4. **ç”¨æˆ·ä½“éªŒ**ï¼šæ“ä½œæµç•…ï¼Œé”™è¯¯æç¤ºæ˜ç¡®
5. **å‘åå…¼å®¹**ï¼šç°æœ‰åŠŸèƒ½ä¸å—å½±å“

---

## ğŸ“ è”ç³»ä¿¡æ¯ä¸æ”¯æŒ

**æŠ€æœ¯è´Ÿè´£äºº**: Claude Code AIåŠ©æ‰‹
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-12-11
**é¡¹ç›®çŠ¶æ€**: å¼€å‘ä¸­

**é—®é¢˜åé¦ˆ**ï¼š
- æŠ€æœ¯é—®é¢˜ï¼šé€šè¿‡GitHub Issuesæäº¤
- ç´§æ€¥é—®é¢˜ï¼šè”ç³»ç³»ç»Ÿç®¡ç†å‘˜
- åŠŸèƒ½å»ºè®®ï¼šè®°å½•åˆ°äº§å“éœ€æ±‚æ–‡æ¡£

---

**é™„å½•ï¼šAPIæ¥å£æ€»è§ˆ**

| æ¥å£åˆ†ç±» | æ–¹æ³• | è·¯å¾„ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|----------|------|------|------|--------|
| **å¤‡è¯¾ç®¡ç†** | POST | `/api/lms/publish-plan` | å¾…å¼€å‘ | P0 |
| **ä»»åŠ¡ç®¡ç†** | GET | `/api/lms/today-records` | å¾…å¼€å‘ | P0 |
| **ä»»åŠ¡ç®¡ç†** | PATCH | `/api/lms/records/:id/complete` | å¾…å¼€å‘ | P0 |
| **ä»»åŠ¡ç®¡ç†** | PATCH | `/api/lms/records/:id/attempt` | å¾…å¼€å‘ | P1 |
| **ç»“ç®—ç®¡ç†** | POST | `/api/lms/batch-settle` | å¾…å¼€å‘ | P1 |
| **ç»Ÿè®¡åˆ†æ** | GET | `/api/lms/settlement-stats` | å¾…å¼€å‘ | P2 |
| **å­¦æƒ…æŠ¥å‘Š** | GET | `/api/lms/academic-report/:studentId` | æ‰©å±• | P2 |

---

*æœ¬æ–‡æ¡£å°†éšç€é¡¹ç›®è¿›å±•æŒç»­æ›´æ–°ï¼Œè¯·ç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ã€‚*