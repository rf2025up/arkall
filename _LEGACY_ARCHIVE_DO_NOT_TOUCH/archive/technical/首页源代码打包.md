# é¦–é¡µæºä»£ç å®Œæ•´æ‰“åŒ…

**æ‰“åŒ…æ—¶é—´**ï¼š2025-12-10
**æ›´æ–°æ—¶é—´**ï¼š2025-12-10 (v11.0 UIä¼˜åŒ–)
**é¡¹ç›®**ï¼šStarJourney + Growark èåˆé¡¹ç›®
**èŒƒå›´**ï¼šé¦–é¡µç›¸å…³å®Œæ•´æºä»£ç 

---

## ğŸ“ æ–‡ä»¶æ¸…å•

æœ¬æ¬¡æ‰“åŒ…åŒ…å«é¦–é¡µç›¸å…³çš„æ‰€æœ‰æ ¸å¿ƒæºä»£ç æ–‡ä»¶ï¼š

1. **ä¸»é¡µé¢ç»„ä»¶** - `Home.tsx` (v11.0 UIä¼˜åŒ–ç‰ˆ)
2. **ç±»å‹å®šä¹‰** - `types.ts` (éƒ¨åˆ†)
3. **ç»„ä»¶** - `StarJourneyModal.tsx`, `ActionSheet.tsx`
4. **APIæœåŠ¡** - `api.ts` (éƒ¨åˆ†)
5. **æ ·å¼ä¾èµ–** - Tailwind CSS é…ç½®

## ğŸ¨ v11.0 UIä¼˜åŒ–ç‰¹æ€§

### æ ¸å¿ƒæ”¹åŠ¨
- **åˆ é™¤è“è‰²å°äººæŒ‰é’®**ï¼šæ¸…ç†å­¦ç”Ÿå¡ç‰‡ç•Œé¢ï¼Œä»…ä¿ç•™çŠ¶æ€æŒ‡ç¤ºå™¨
- **HeaderåŠŸèƒ½èƒ¶å›Š**ï¼šæ–°å¢4ä¸ªå¿«æ·åŠŸèƒ½å…¥å£ï¼ˆæ’è¡Œæ¦œã€å‘å‹‹ç« ã€PKå¯¹å†³ã€æŒ‘æˆ˜ï¼‰
- **ä¼˜åŒ–çŠ¶æ€æŒ‡ç¤ºå™¨**ï¼šç®€åŒ–é€»è¾‘ï¼Œçº¢ç‚¹æ˜¾ç¤ºé”™é¢˜ï¼Œæ©™ç‚¹æ˜¾ç¤ºå¾…å®Œæˆä»»åŠ¡

---

## ğŸ”— æ–‡ä»¶ä¾èµ–å…³ç³»

```
Home.tsx (ä¸»é¡µé¢)
â”œâ”€â”€ types.ts (ç±»å‹å®šä¹‰)
â”œâ”€â”€ components/ActionSheet.tsx
â”œâ”€â”€ components/StarJourneyModal.tsx
â”œâ”€â”€ services/api.ts
â””â”€â”€ lucide-react (å›¾æ ‡åº“)
```

---

## ğŸ“„ å®Œæ•´æºä»£ç 

### 1. ä¸»é¡µé¢ç»„ä»¶ - Home.tsx

```typescript
import React, { useState } from 'react';
import { Student, PointPreset } from '../types';
import ActionSheet from '../components/ActionSheet';
import StarJourneyModal from '../components/StarJourneyModal';
import { Check, CheckSquare, ListChecks, BookOpen, AlertCircle, User, Trophy, Medal, Swords, Flag } from 'lucide-react';

interface HomeProps {
  students: Student[];
  onUpdateScore: (ids: string[], points: number, reason: string, exp?: number) => void;
  scorePresets: PointPreset[];
  categoryNames: Record<string, string>;
  identity?: 'teacher'|'principal';
  classes?: string[];
  teacherClass?: string;
  starJourneyData?: Record<string, {
    mistakes?: number;
    records?: number;
    pendingTasks?: number;
  }>;
}

const Home: React.FC<HomeProps> = ({ students, onUpdateScore, scorePresets, categoryNames, identity='teacher', classes=[], teacherClass, starJourneyData }) => {
  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());
  const [isMultiSelectMode, setIsMultiSelectMode] = useState(false);
  const [scoringStudent, setScoringStudent] = useState<Student | null>(null);
  const [isSheetOpen, setIsSheetOpen] = useState(false);
  const [toastMsg, setToastMsg] = useState<string | null>(null);
  const [starJourneyModalOpen, setStarJourneyModalOpen] = useState(false);
  const [selectedStudentForStarJourney, setSelectedStudentForStarJourney] = useState<Student | null>(null);

  // ç§»åŠ¨ç«¯åŒå‡»æ£€æµ‹
  const [lastTapTime, setLastTapTime] = useState<Record<string, number>>({});
  const [tapTimeout, setTapTimeout] = useState<NodeJS.Timeout | null>(null);
  const visibleStudents = (identity==='principal' ? students : students.filter(s => s.className === (teacherClass || classes[0] || ''))).sort((a, b) => (b.exp || 0) - (a.exp || 0));

  const toggleSelection = (id: string) => {
    const newSet = new Set(selectedIds);
    if (newSet.has(id)) {
      newSet.delete(id);
    } else {
      newSet.add(id);
    }
    setSelectedIds(newSet);
  };

  const handleLongPress = (id: string) => {
    if (!isMultiSelectMode) {
      setIsMultiSelectMode(true);
      setSelectedIds(new Set([id]));
      if (navigator.vibrate) navigator.vibrate(50);
    }
  };

  const handleCardClick = (student: Student) => {
    if (isMultiSelectMode) {
      toggleSelection(student.id);
    } else {
      setScoringStudent(student);
      setIsSheetOpen(true);
    }
  };

  const handleCardDoubleClick = (student: Student) => {
    if (!isMultiSelectMode) {
      setSelectedStudentForStarJourney(student);
      setStarJourneyModalOpen(true);
    }
  };

  // ç§»åŠ¨ç«¯ç‚¹å‡»å¤„ç†ï¼ˆæ”¯æŒåŒå‡»ï¼‰
  const handleCardTouch = (student: Student) => {
    if (isMultiSelectMode) {
      toggleSelection(student.id);
      return;
    }

    const now = Date.now();
    const timeSinceLastTap = now - (lastTapTime[student.id] || 0);

    // æ¸…é™¤ä¹‹å‰çš„è¶…æ—¶
    if (tapTimeout) {
      clearTimeout(tapTimeout);
      setTapTimeout(null);
    }

    if (timeSinceLastTap < 300) {
      // åŒå‡»æ£€æµ‹
      setSelectedStudentForStarJourney(student);
      setStarJourneyModalOpen(true);
      setLastTapTime(prev => ({ ...prev, [student.id]: 0 }));
    } else {
      // è®¾ç½®è¶…æ—¶ï¼Œå¦‚æœ300mså†…æ²¡æœ‰ç¬¬äºŒæ¬¡ç‚¹å‡»ï¼Œåˆ™æ‰§è¡Œå•å‡»
      const timeout = setTimeout(() => {
        setScoringStudent(student);
        setIsSheetOpen(true);
      }, 300);
      setTapTimeout(timeout);
      setLastTapTime(prev => ({ ...prev, [student.id]: now }));
    }
  };

  const handleBatchScoreClick = () => {
    if (selectedIds.size > 0) {
        setIsSheetOpen(true);
    }
  };

  const toggleMultiSelectMode = () => {
    if (isMultiSelectMode) {
        setIsMultiSelectMode(false);
        setSelectedIds(new Set());
    } else {
        setIsMultiSelectMode(true);
    }
  }

  const handleConfirmScore = (points: number, reason: string, exp?: number) => {
    let idsToUpdate: string[] = [];
    if (scoringStudent) {
        idsToUpdate = [scoringStudent.id];
    } else if (selectedIds.size > 0) {
        idsToUpdate = Array.from(selectedIds);
    }

    onUpdateScore(idsToUpdate, points, reason, exp);


    const nameText = scoringStudent ? scoringStudent.name : `å·²é€‰ ${idsToUpdate.length} äºº`;
    const ptsText = typeof points === 'number' && points !== 0 ? `${points > 0 ? '+' : ''}${points}` : '';
    const expText = typeof exp === 'number' && exp !== 0 ? ` ç»éªŒ${exp > 0 ? '+' : ''}${exp}` : '';
    const msg = ptsText || expText ? `${nameText} ${ptsText}${expText} å·²æ›´æ–°` : `${nameText} æ“ä½œå·²å®Œæˆ`;
    setToastMsg(msg);
    setTimeout(() => setToastMsg(null), 1500);
  };

  // è¾…åŠ©ç»„ä»¶ï¼šHeader ä¸Šçš„åŠŸèƒ½èƒ¶å›ŠæŒ‰é’®
  const HeaderActionBtn = ({ icon, label, colorClass, bgClass, onClick }: any) => (
    <button onClick={onClick} className="flex flex-col items-center gap-1 group active:scale-95 transition-transform">
        <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shadow-sm ${bgClass} ${colorClass}`}>
            {icon}
        </div>
        <span className="text-xs text-white/90 font-medium">{label}</span>
    </button>
  );

  return (
    <div className="min-h-screen bg-background pb-24">
      {/* Header - v11.0 é£æ ¼æ”¹é€  */}
      <header className="bg-primary px-6 py-6 pb-20 rounded-b-[2.5rem] shadow-lg relative overflow-hidden">
        {/* èƒŒæ™¯è£…é¥° */}
        <div className="absolute top-0 right-0 p-4 opacity-10">
            <Check size={120} className="text-white" />
        </div>

        {/* ç¬¬ä¸€è¡Œï¼šæ ‡é¢˜ä¸å¤šé€‰å¼€å…³ */}
        <div className="relative z-10 flex justify-between items-center mb-6">
            <div>
                <h1 className="text-white text-2xl font-bold mb-1">{identity==='principal' ? 'å…¨éƒ¨å­¦ç”Ÿ' : (teacherClass || classes[0] || 'æœ¬ç­çº§')}</h1>
                <p className="text-orange-100 text-sm opacity-90">{visibleStudents.length} ä½å­¦ç”Ÿ Â· ä»Šæ—¥æ´»è·ƒ {Math.floor(visibleStudents.length * 0.9)}</p>
            </div>
            <div className="flex items-center space-x-2">
                <button
                    onClick={toggleMultiSelectMode}
                    className={`p-2 rounded-xl backdrop-blur-sm transition-all ${isMultiSelectMode ? 'bg-white text-primary shadow-md' : 'bg-white/20 text-white'}`}
                >
                    {isMultiSelectMode ? <CheckSquare size={20} /> : <ListChecks size={20} />}
                </button>
            </div>
        </div>

        {/* ç¬¬äºŒè¡Œï¼šå¿«æ·åŠŸèƒ½å…¥å£ (v11.0 é£æ ¼) */}
        {!isMultiSelectMode && (
            <div className="relative z-10 flex justify-between px-2 animate-in slide-in-from-top-4 fade-in duration-500">
                <HeaderActionBtn
                    icon={<Trophy size={22} />}
                    label="æ’è¡Œæ¦œ"
                    bgClass="bg-yellow-100"
                    colorClass="text-yellow-600"
                    onClick={() => console.log('æ’è¡Œæ¦œ')}
                />
                <HeaderActionBtn
                    icon={<Medal size={22} />}
                    label="å‘å‹‹ç« "
                    bgClass="bg-blue-100"
                    colorClass="text-blue-600"
                    onClick={() => console.log('å‘å‹‹ç« ')}
                />
                <HeaderActionBtn
                    icon={<Swords size={22} />}
                    label="PKå¯¹å†³"
                    bgClass="bg-red-100"
                    colorClass="text-red-600"
                    onClick={() => console.log('PKå¯¹å†³')}
                />
                <HeaderActionBtn
                    icon={<Flag size={22} />}
                    label="æŒ‘æˆ˜"
                    bgClass="bg-purple-100"
                    colorClass="text-purple-600"
                    onClick={() => console.log('æŒ‘æˆ˜')}
                />
            </div>
        )}
      </header>

      {/* Student Grid - è°ƒæ•´marginé€‚é…æ–°Headeré«˜åº¦ */}
      <div className="px-4 -mt-12 relative z-20">
        <div className="bg-white rounded-3xl shadow-xl p-5 min-h-[60vh]">
          <div className="grid grid-cols-3 sm:grid-cols-4 gap-4">
            {visibleStudents.map((student) => {
                const isSelected = selectedIds.has(student.id);
                const studentStarData = starJourneyData?.[student.id];
                const hasMistakes = (studentStarData?.mistakes || 0) > 0;
                const hasPendingTasks = (studentStarData?.pendingTasks || 0) > 0;

                return (
                    <div
                        key={student.id}
                        onClick={() => handleCardClick(student)}
                        onDoubleClick={() => handleCardDoubleClick(student)}
                        onTouchEnd={() => handleCardTouch(student)}
                        onContextMenu={(e) => { e.preventDefault(); handleLongPress(student.id); }}
                        className={`flex flex-col items-center p-2 rounded-xl transition-all duration-200 cursor-pointer select-none ${
                            isSelected ? 'bg-orange-50 scale-95 ring-2 ring-primary' : 'active:scale-95 hover:bg-gray-50'
                        }`}
                        title={isMultiSelectMode ? "é•¿æŒ‰è¿›å…¥å¤šé€‰æ¨¡å¼" : "å•å‡»è¯„åˆ†ï¼ŒåŒå‡»æŸ¥çœ‹å­¦æƒ…è¯¦æƒ…"}
                    >
                        <div className="relative">
                            <img
                                src={student.avatar}
                                alt={student.name}
                                onError={(e)=>{ e.currentTarget.src = 'data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 64 64%22><rect width=%2264%22 height=%2264%22 fill=%22%23e5e7eb%22/><circle cx=%2232%22 cy=%2224%22 r=%2212%22 fill=%22%23cbd5e1%22/><rect x=%2216%22 y=%2240%22 width=%2232%22 height=%2216%22 rx=%228%22 fill=%22%23cbd5e1%22/></svg>'; }}
                                className={`w-14 h-14 rounded-full object-cover border-2 transition-all ${
                                    isSelected ? 'border-primary opacity-100' : 'border-gray-100'
                                }`}
                            />

                            {/* ä¼˜åŒ–åçš„çŠ¶æ€æŒ‡ç¤ºå™¨ - v11.0 é£æ ¼ */}
                            {!isMultiSelectMode && (hasMistakes || hasPendingTasks) && (
                                <>
                                    {hasMistakes && (
                                        <div className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center shadow-md border border-white" title="æœ‰å¾…å¤„ç†é”™é¢˜">
                                            <AlertCircle className="w-2.5 h-2.5 text-white" />
                                        </div>
                                    )}
                                    {hasPendingTasks && !hasMistakes && (
                                        <div className="absolute -top-1 -right-1 w-3 h-3 bg-orange-500 rounded-full border-2 border-white shadow-md" title="æœ‰å¾…å®Œæˆä»»åŠ¡"></div>
                                    )}
                                </>
                            )}

                            {isMultiSelectMode && (
                                <div className={`absolute -top-1 -right-1 w-5 h-5 rounded-full border-2 border-white flex items-center justify-center shadow-sm transition-colors ${
                                    isSelected ? 'bg-primary' : 'bg-gray-200'
                                }`}>
                                    {isSelected && <Check size={12} className="text-white" strokeWidth={3} />}
                                </div>
                            )}
                        </div>
                        <span className={`mt-2 text-xs font-bold truncate w-full text-center ${isSelected ? 'text-primary' : 'text-gray-700'}`}>
                            {student.name}
                        </span>
                        <span className="text-[10px] text-gray-400 font-medium">{student.points} ç§¯åˆ†</span>
                    </div>
                );
            })}
          </div>
        </div>
      </div>

      {/* Batch Action Bar */}
      {isMultiSelectMode && selectedIds.size > 0 && (
          <div className="fixed bottom-24 left-0 right-0 px-8 z-30 animate-in slide-in-from-bottom-10">
              <button
                onClick={handleBatchScoreClick}
                className="w-full bg-gray-900 text-white font-bold py-4 rounded-2xl shadow-2xl flex items-center justify-center space-x-2 active:scale-95 transition-transform"
              >
                  <CheckSquare size={20} />
                  <span>ä¸º {selectedIds.size} ä½å­¦ç”Ÿè¯„åˆ†</span>
              </button>
          </div>
      )}

      <ActionSheet
        isOpen={isSheetOpen}
        onClose={() => {
          setIsSheetOpen(false);
          setScoringStudent(null);
          if (isMultiSelectMode) {
            setSelectedIds(new Set());
            setIsMultiSelectMode(false);
          }
        }}
        selectedStudents={scoringStudent ? [scoringStudent] : visibleStudents.filter(s => selectedIds.has(s.id))}
        onConfirm={handleConfirmScore}
        scorePresets={scorePresets}
        categoryNames={categoryNames}
      />

      {/* StarJourney å­¦æƒ…ç®¡ç†æ¨¡æ€æ¡† */}
      <StarJourneyModal
        studentId={selectedStudentForStarJourney?.id || ''}
        studentName={selectedStudentForStarJourney?.name || ''}
        students={students}
        starJourneyData={starJourneyData}
        isOpen={starJourneyModalOpen}
        onClose={() => {
          setStarJourneyModalOpen(false);
          setSelectedStudentForStarJourney(null);
        }}
        onStudentSelect={(student) => {
          setSelectedStudentForStarJourney(student);
        }}
      />

      {toastMsg && (
        <div className="fixed bottom-24 left-1/2 -translate-x-1/2 bg-black/80 text-white px-4 py-2 rounded-xl shadow-lg text-sm z-50">
          {toastMsg}
        </div>
      )}
    </div>
  );
};

export default Home;
```

---

### 2. ç±»å‹å®šä¹‰ - types.ts (ç›¸å…³éƒ¨åˆ†)

```typescript
// åŸºç¡€å­¦ç”Ÿç±»å‹
export interface Student {
  id: string;
  name: string;
  avatar: string;
  points: number;
  exp: number;
  level: number;
  className: string;
  teamId?: string;
  habitStats?: Record<string, number>;
  badges?: Array<{id: number; name: string; icon: string; awarded_at: string}>;
  challengeHistory?: StudentChallengeRecord[];
  pkHistory?: StudentPKRecord[];
  taskHistory?: StudentTaskRecord[];
  badgeHistory?: StudentBadgeRecord[];
}

export interface PointPreset {
  id?: string;
  label: string;
  value: number;
  category: string;
}

// StarJourney ç›¸å…³ç±»å‹
export interface StarMistake {
  id: string;
  student_id: string;
  student_name?: string;
  image_url?: string;
  ocr_text?: string;
  subject: 'math' | 'chinese' | 'english' | 'physics' | 'chemistry';
  tags?: string;
  difficulty_level: number;
  status: 'pending' | 'analyzed' | 'resolved';
  ai_analysis?: string;
  created_at: string;
  updated_at?: string;
}

export interface StarStudentRecord {
  id: string;
  student_id: string;
  student_name?: string;
  task_name: string;
  task_type: 'QC' | 'TASK' | 'SPECIAL';
  exp_value: number;
  lesson_unit?: string;
  lesson_lesson?: string;
  lesson_title?: string;
  lesson_subject?: string;
  is_special: boolean;
  status: 'pending' | 'passed';
  attempt_count: number;
  difficulty_flag: boolean;
  first_attempt_at?: string;
  completed_at?: string;
  created_at: string;
  updated_at?: string;
}

export interface StarJourneyData {
  mistakes: StarMistake[];
  records: StarStudentRecord[];
  reports: any[];
  stats?: any;
}

export interface StarJourneyModalProps {
  studentId: string;
  studentName: string;
  isOpen: boolean;
  onClose: () => void;
}

export interface CreateRecordRequest {
  student_id: string;
  task_name: string;
  task_type: 'QC' | 'TASK' | 'SPECIAL';
  exp_value?: number;
  lesson_unit?: string;
  lesson_lesson?: string;
  lesson_title?: string;
  lesson_subject?: string;
  is_special?: boolean;
}

export interface CreateMistakeRequest {
  student_id: string;
  image_url?: string;
  ocr_text?: string;
  subject?: 'math' | 'chinese' | 'english' | 'physics' | 'chemistry';
  tags?: string;
  difficulty_level?: number;
}
```

---

### 3. ActionSheet ç»„ä»¶ - ActionSheet.tsx

```typescript
import React, { useState, useEffect } from 'react';
import { X } from 'lucide-react';
import { Student, PointPreset } from '../types';

interface ActionSheetProps {
  isOpen: boolean;
  onClose: () => void;
  selectedStudents: Student[];
  onConfirm: (points: number, reason: string, exp?: number) => void;
  scorePresets: PointPreset[];
  categoryNames: Record<string, string>;
}

const ActionSheet: React.FC<ActionSheetProps> = ({
  isOpen,
  onClose,
  selectedStudents,
  onConfirm,
  scorePresets,
  categoryNames
}) => {
  const [activeTab, setActiveTab] = useState<string>('');
  const [customPoints, setCustomPoints] = useState<string>('');
  const [customExp, setCustomExp] = useState<string>('');

  useEffect(() => {
    if (isOpen) {
      const keys = Object.keys(categoryNames);
      if (keys.length > 0 && !activeTab) {
          setActiveTab(keys[0]);
      }
      setCustomPoints('');
      setCustomExp('');
    }
  }, [isOpen, categoryNames]);

  if (!isOpen) return null;

  const handlePresetClick = (value: number, label: string) => {
    onConfirm(value, label);
  };

  const handleCustomConfirm = () => {
    const pts = parseInt(customPoints);
    const exp = parseInt(customExp);

    if (!isNaN(pts) || !isNaN(exp)) {
      const finalPts = isNaN(pts) ? 0 : pts;
      const finalExp = isNaN(exp) ? 0 : exp;
      const reason = finalPts > 0 ? 'æ‰‹åŠ¨åŠ åˆ†' : (finalPts < 0 ? 'æ‰‹åŠ¨æ‰£åˆ†' : 'ç»éªŒè°ƒæ•´');

      onConfirm(finalPts, reason, finalExp);
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-end justify-center bg-black/60 transition-opacity animate-in fade-in">
      <div className="w-full max-w-md bg-white rounded-t-3xl shadow-2xl overflow-hidden animate-in slide-in-from-bottom duration-300 flex flex-col max-h-[90vh]">

        <div className="flex items-center justify-between p-5 border-b border-gray-100 bg-white sticky top-0 z-10">
          <div className="flex items-center space-x-3">
            {selectedStudents.length === 1 ? (
              <>
                <img src={selectedStudents[0].avatar} alt="avatar" className="w-12 h-12 rounded-full border-2 border-orange-100 shadow-sm" />
                <div>
                  <p className="font-bold text-lg text-gray-800">{selectedStudents[0].name}</p>
                  <div className="flex items-center space-x-2 text-xs font-medium">
                    <span className="text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full">ç§¯åˆ†: {selectedStudents[0].points}</span>
                    <span className="text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full">ç»éªŒ: {selectedStudents[0].exp}</span>
                  </div>
                </div>
              </>
            ) : (
              <div>
                <p className="font-bold text-lg text-gray-800">æ‰¹é‡æ“ä½œ</p>
                <p className="text-xs text-gray-500 mt-0.5">å·²é€‰ä¸­ <span className="text-primary font-bold">{selectedStudents.length}</span> ä½å­¦ç”Ÿ</p>
              </div>
            )}
          </div>
          <button onClick={onClose} className="p-2 bg-gray-50 rounded-full hover:bg-gray-200 transition-colors text-gray-500">
            <X size={24} />
          </button>
        </div>

        <div className="px-2 pt-2 bg-gray-50/50">
          <div className="flex overflow-x-auto space-x-2 no-scrollbar py-2 px-2 snap-x snap-mandatory">
            {Object.keys(categoryNames).map((catKey) => (
              <button
                key={catKey}
                onClick={() => setActiveTab(catKey)}
                className={`px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap transition-all snap-start min-w-[88px] ${
                  activeTab === catKey
                    ? 'bg-primary text-white shadow-md shadow-orange-200'
                    : 'bg-white text-gray-500 border border-gray-200'
                }`}
              >
                {categoryNames[catKey]}
              </button>
            ))}
          </div>
        </div>

        <div className="p-4 grid grid-cols-2 gap-3 overflow-y-auto flex-1 min-h-[200px] max-h-[400px] bg-gray-50/30">
            {scorePresets.filter(p => p.category === activeTab).map((preset, idx) => (
              <button
                key={idx}
                onClick={() => handlePresetClick(preset.value, preset.label)}
                className="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100 shadow-sm active:scale-95 active:bg-orange-50 transition-all hover:border-orange-200"
              >
                <span className="text-xs font-bold text-gray-600 text-left line-clamp-2 flex-1 mr-2">{preset.label}</span>
                <span className={`text-lg font-black ${preset.value > 0 ? 'text-orange-500' : 'text-red-500'}`}>
                  {preset.value > 0 ? `+${preset.value}` : preset.value}
                </span>
              </button>
            ))}
            {scorePresets.filter(p => p.category === activeTab).length === 0 && (
                <div className="col-span-2 text-center py-8 text-gray-400 text-xs">
                    è¯¥åˆ†ç±»ä¸‹æš‚æ— ç§¯åˆ†é¡¹
                </div>
            )}
        </div>

        <div className="p-5 border-t border-gray-100 bg-white pb-8 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.02)]">
          <div className="flex gap-3 items-center mb-3">
            <div className="flex-1 relative">
               <label className="absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-gray-400">ç§¯åˆ†</label>
               <input
                  type="number"
                  placeholder="0"
                  value={customPoints}
                  onChange={(e) => setCustomPoints(e.target.value)}
                  className="w-full border border-gray-200 rounded-xl px-4 py-3 text-center font-bold text-gray-800 focus:ring-2 focus:ring-primary focus:border-transparent outline-none bg-gray-50"
               />
            </div>
            <div className="flex-1 relative">
               <label className="absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-gray-400">ç»éªŒå€¼</label>
               <input
                  type="number"
                  placeholder="0"
                  value={customExp}
                  onChange={(e) => setCustomExp(e.target.value)}
                  className="w-full border border-gray-200 rounded-xl px-4 py-3 text-center font-bold text-gray-800 focus:ring-2 focus:ring-blue-400 focus:border-transparent outline-none bg-gray-50"
               />
            </div>
          </div>
          <button
            onClick={handleCustomConfirm}
            className="w-full bg-gray-900 text-white font-bold rounded-xl py-3.5 hover:bg-gray-800 active:scale-[0.98] transition-all shadow-lg"
          >
             ç¡®è®¤è°ƒæ•´
           </button>
        </div>

      </div>
    </div>
  );
};

export default ActionSheet;
```

---

### 4. StarJourney æ¨¡æ€æ¡†ç»„ä»¶ (æ ¸å¿ƒåŠŸèƒ½)

**æ³¨æ„**ï¼šç”±äº StarJourneyModal.tsx æ–‡ä»¶è¾ƒå¤§ï¼ˆè¶…è¿‡1000è¡Œï¼‰ï¼Œæ­¤å¤„ä»…å±•ç¤ºä¸»è¦ç»“æ„ã€‚å®Œæ•´ä»£ç è¯·å‚è€ƒé¡¹ç›®ä¸­çš„ `arkok/mobile/components/StarJourneyModal.tsx` æ–‡ä»¶ã€‚

**æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ**ï¼š
- ä¸‰Tabè®¾è®¡ï¼šå­¦æƒ…æ¦‚è§ˆã€æˆé•¿ç®¡ç†ã€å­¦ä¸šåˆ†æ
- é”™é¢˜è®°å½•ç®¡ç†ï¼ˆåˆ›å»ºã€åˆ é™¤ã€çŠ¶æ€æ›´æ–°ï¼‰
- è¿‡å…³ä»»åŠ¡ç®¡ç†ï¼ˆåˆ›å»ºã€è¾…å¯¼å°è¯•ã€æ ‡è®°é€šè¿‡ï¼‰
- å®æ—¶æ•°æ®åŒæ­¥å’ŒçŠ¶æ€æŒ‡ç¤ºå™¨
- æ‰¹é‡æ“ä½œå’Œä¸€é”®åŠŸèƒ½

---

### 5. API æœåŠ¡ - api.ts (StarJourney ç›¸å…³éƒ¨åˆ†)

```typescript
/**
 * StarJourney API - é”™é¢˜å’Œè¿‡å…³ç®¡ç†ç³»ç»Ÿ
 */
export const starJourneyAPI = {
  // ==================== é”™é¢˜ç®¡ç† API ====================

  // è·å–é”™é¢˜åˆ—è¡¨
  async getMistakes(studentId?: string, subject?: string, status?: string) {
    const params = new URLSearchParams();
    if (studentId) params.append('student_id', studentId);
    if (subject) params.append('subject', subject);
    if (status) params.append('status', status);

    return fetchWithAuth(`${STARJOURNEY_API_BASE_URL}/mistakes?${params.toString()}`);
  },

  // åˆ›å»ºé”™é¢˜è®°å½•
  async createMistake(data: {
    student_id: string;
    image_url?: string;
    ocr_text?: string;
    subject?: string;
    tags?: string;
    difficulty_level?: number;
  }) {
    return fetchWithAuth(`${STARJOURNEY_API_BASE_URL}/mistakes`, {
      method: 'POST',
      body: JSON.stringify(data)
    });
  },

  // ==================== è¿‡å…³ç®¡ç† API ====================

  // è·å–è¿‡å…³è®°å½•
  async getRecords(studentId?: string, taskType?: string, status?: string) {
    const params = new URLSearchParams();
    if (studentId) params.append('student_id', studentId);
    if (taskType) params.append('task_type', taskType);
    if (status) params.append('status', status);

    return fetchWithAuth(`${STARJOURNEY_API_BASE_URL}/records?${params.toString()}`);
  },

  // åˆ›å»ºè¿‡å…³è®°å½•
  async createRecord(data: {
    student_id: string;
    task_name: string;
    task_type: 'QC' | 'TASK' | 'SPECIAL';
    exp_value?: number;
    lesson_unit?: string;
    lesson_lesson?: string;
    lesson_title?: string;
    lesson_subject?: string;
    is_special?: boolean;
  }) {
    return fetchWithAuth(`${STARJOURNEY_API_BASE_URL}/records`, {
      method: 'POST',
      body: JSON.stringify(data)
    });
  },

  // è®°å½•è¾…å¯¼å°è¯• (æ ¸å¿ƒåŠŸèƒ½)
  async recordAttempt(recordId: string) {
    return fetchWithAuth(`${STARJOURNEY_API_BASE_URL}/records/${recordId}/attempt`, {
      method: 'PATCH'
    });
  },

  // æ ‡è®°ä»»åŠ¡é€šè¿‡
  async markAsPassed(recordId: string, expBonus?: number) {
    return fetchWithAuth(`${STARJOURNEY_API_BASE_URL}/records/${recordId}/pass`, {
      method: 'PATCH',
      body: JSON.stringify({ exp_bonus: expBonus || 0 })
    });
  },

  // æ‰¹é‡æ ‡è®°å­¦ç”Ÿæ‰€æœ‰QCä»»åŠ¡ä¸ºé€šè¿‡
  async passAllQCTasks(studentId: string, expBonus?: number) {
    return fetchWithAuth(`${STARJOURNEY_API_BASE_URL}/records/student/${studentId}/pass-all`, {
      method: 'PATCH',
      body: JSON.stringify({ expBonus: expBonus || 0 })
    });
  },

  // ==================== ç»¼åˆæ•°æ® API ====================

  // è·å–å­¦ç”Ÿå®Œæ•´StarJourneyæ•°æ®
  async getStudentStarJourneyData(studentId: string) {
    const [mistakesRes, recordsRes, statsRes] = await Promise.all([
      starJourneyAPI.getMistakes(studentId),
      starJourneyAPI.getRecords(studentId),
      starJourneyAPI.getStudentStats(studentId)
    ]);

    return {
      mistakes: mistakesRes.data || [],
      records: recordsRes.data || [],
      stats: statsRes.data || null,
      success: mistakesRes.success && recordsRes.success && statsRes.success
    };
  }
};
```

---

## ğŸ¨ æ ·å¼é…ç½®

### Tailwind CSS é…ç½®è¦æ±‚

```css
/* éœ€è¦çš„ Tailwind CSS ç±» */
- åŸºç¡€å¸ƒå±€ï¼šmin-h-screen, bg-background, pb-24
- ç½‘æ ¼ç³»ç»Ÿï¼šgrid, grid-cols-3, sm:grid-cols-4, gap-4
- åœ†è§’æ ·å¼ï¼šrounded-xl, rounded-2xl, rounded-3xl, rounded-full
- é˜´å½±æ•ˆæœï¼šshadow-lg, shadow-xl, shadow-2xl, shadow-md
- é¢œè‰²ç³»ç»Ÿï¼šbg-primary, text-primary, bg-orange-50, text-orange-600
- åŠ¨ç”»æ•ˆæœï¼štransition-all, duration-200, active:scale-95
- å“åº”å¼ï¼šsm:grid-cols-4, md:grid-cols-4
- å®šä½ï¼šfixed, absolute, relative, z-30, z-50
- é—´è·ï¼šp-2, p-4, p-5, p-6, space-x-2, space-y-3

/* è‡ªå®šä¹‰CSSå˜é‡ */
:root {
  --primary: #f97316; /* orange-500 */
  --background: #f8fafc; /* slate-50 */
}
```

---

## ğŸ“± åŠŸèƒ½ç‰¹æ€§æ€»ç»“

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

1. **å­¦ç”Ÿå±•ç¤ºç½‘æ ¼**
   - 3åˆ—å“åº”å¼å¸ƒå±€ï¼ˆç§»åŠ¨ç«¯ï¼‰â†’ 4åˆ—ï¼ˆæ¡Œé¢ç«¯ï¼‰
   - å­¦ç”Ÿå¤´åƒã€å§“åã€ç§¯åˆ†æ˜¾ç¤º
   - æŒ‰ç»éªŒå€¼æ’åº

2. **äº¤äº’æ“ä½œ**
   - å•å‡»ï¼šæ‰“å¼€è¯„åˆ†é¢æ¿
   - åŒå‡»ï¼šæ‰“å¼€StarJourneyå­¦æƒ…ç®¡ç†
   - é•¿æŒ‰ï¼šè¿›å…¥å¤šé€‰æ¨¡å¼
   - è§¦æ‘¸ä¼˜åŒ–ï¼šæ”¯æŒç§»åŠ¨ç«¯åŒå‡»æ£€æµ‹

3. **å¤šé€‰æ¨¡å¼**
   - æ‰¹é‡é€‰æ‹©å­¦ç”Ÿ
   - æ‰¹é‡è¯„åˆ†æ“ä½œ
   - é€‰æ‹©çŠ¶æ€è§†è§‰åé¦ˆ

4. **StarJourneyé›†æˆ**
   - çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆçº¢è‰²é”™é¢˜ã€æ©™è‰²å¾…å®Œæˆã€è“è‰²æ•°æ®ä¸°å¯Œï¼‰
   - å¿«é€Ÿè®¿é—®æŒ‰é’®
   - å­¦æƒ…ç®¡ç†æ¨¡æ€æ¡†
   - ä¸‰Tabç•Œé¢è®¾è®¡

5. **è¯„åˆ†ç³»ç»Ÿ**
   - åˆ†ç±»ç§¯åˆ†é¢„è®¾
   - è‡ªå®šä¹‰ç§¯åˆ†è°ƒæ•´
   - ç§¯åˆ†å’Œç»éªŒå€¼åˆ†ç¦»
   - å®æ—¶åé¦ˆæç¤º

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### ä¾èµ–åŒ…è¦æ±‚

```json
{
  "dependencies": {
    "react": "^18.0.0",
    "lucide-react": "^0.263.1",
    "typescript": "^4.9.5"
  },
  "devDependencies": {
    "tailwindcss": "^3.3.0",
    "@types/react": "^18.0.0"
  }
}
```

### ç¯å¢ƒé…ç½®

```typescript
// ç¯å¢ƒå˜é‡
REACT_APP_API_BASE_URL=https://esboimzbkure.sealosbja.site/api
REACT_APP_STARJOURNEY_API_BASE_URL=https://esboimzbkure.sealosbja.site/api
```

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

- **Home.tsx (v11.0ä¼˜åŒ–ç‰ˆ)**: çº¦325è¡Œ (+17è¡Œ)
- **ActionSheet.tsx**: 160è¡Œ
- **types.ts (ç›¸å…³éƒ¨åˆ†)**: 243è¡Œ
- **api.ts (StarJourneyéƒ¨åˆ†)**: 120è¡Œ
- **StarJourneyModal.tsx**: 1021è¡Œ

**æ€»è®¡**: çº¦1869è¡Œæ ¸å¿ƒä»£ç  (+17è¡Œ)

### v11.0 ä¼˜åŒ–æ–°å¢ä»£ç 
- Headerèƒ¶å›ŠæŒ‰é’®ç»„ä»¶ï¼š8è¡Œ
- 4ä¸ªåŠŸèƒ½æŒ‰é’®é…ç½®ï¼š20è¡Œ
- ä¼˜åŒ–çŠ¶æ€æŒ‡ç¤ºå™¨ï¼š-11è¡Œï¼ˆåˆ é™¤å†—ä½™é€»è¾‘ï¼‰
- å¸ƒå±€è°ƒæ•´ï¼šè‹¥å¹²

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- å®Œæ•´StarJourneyModalç»„ä»¶ï¼š`/home/devbox/project/arkok/mobile/components/StarJourneyModal.tsx`
- å®Œæ•´ç±»å‹å®šä¹‰ï¼š`/home/devbox/project/arkok/mobile/types.ts`
- å®Œæ•´APIæœåŠ¡ï¼š`/home/devbox/project/arkok/mobile/services/api.ts`
- é¡¹ç›®é…ç½®ï¼š`/home/devbox/project/arkok/mobile/package.json`

---

**æ‰“åŒ…å®Œæˆæ—¶é—´**ï¼š2025-12-10
**v11.0ä¼˜åŒ–æ›´æ–°**ï¼š2025-12-10
**ç‰ˆæœ¬**ï¼šv11.0
**çŠ¶æ€**ï¼šâœ… å®Œæ•´UIä¼˜åŒ–ç‰ˆ