<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ArkOK ç§»åŠ¨ç«¯è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        .debug-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            color: #333;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin: 8px 5px;
            font-weight: 600;
            transition: transform 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .button:hover {
            transform: translateY(-2px);
        }
        .button:active {
            transform: translateY(0);
        }
        .error {
            background: #ffe6e6;
            color: #d00;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #d00;
        }
        .success {
            background: #e6ffe6;
            color: #0a0;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #0a0;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-break: break-all;
            border: 1px solid #dee2e6;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin: 2px;
        }
        .status-ok { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-warning { background: #fff3cd; color: #856404; }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            .debug-section { padding: 15px; }
            .button {
                padding: 10px 16px;
                font-size: 14px;
                margin: 5px 2px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; margin-bottom: 30px;">ğŸ”§ ArkOK ç§»åŠ¨ç«¯è¯Šæ–­</h1>

        <div class="debug-section">
            <h3>ğŸ“± è®¾å¤‡ä¿¡æ¯</h3>
            <p><strong>ç”¨æˆ·ä»£ç†:</strong> <span id="userAgent"></span></p>
            <p><strong>å±å¹•å°ºå¯¸:</strong> <span id="screenSize"></span></p>
            <p><strong>è§†å£å°ºå¯¸:</strong> <span id="viewportSize"></span></p>
            <p><strong>è®¾å¤‡ç±»å‹:</strong> <span id="deviceType"></span></p>
            <p><strong>æ˜¯å¦æ”¯æŒè§¦æ‘¸:</strong> <span id="touchSupport"></span></p>
            <p><strong>å½“å‰æ—¶é—´:</strong> <span id="currentTime"></span></p>
        </div>

        <div class="debug-section">
            <h3>ğŸ”’ è®¤è¯çŠ¶æ€æ£€æŸ¥</h3>
            <p><strong>localStorageå¯ç”¨:</strong> <span class="status" id="localStorageStatus"></span></p>
            <p><strong>sessionStorageå¯ç”¨:</strong> <span class="status" id="sessionStorageStatus"></span></p>
            <p><strong>TokençŠ¶æ€:</strong> <span class="status" id="tokenStatus"></span></p>
            <p><strong>CookieçŠ¶æ€:</strong> <span class="status" id="cookieStatus"></span></p>
        </div>

        <div class="debug-section">
            <h3>ğŸŒ ç½‘ç»œè¿æ¥æµ‹è¯•</h3>
            <button class="button" onclick="testHealthCheck()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
            <button class="button" onclick="testAPI()">æµ‹è¯•APIè¿æ¥</button>
            <button class="button" onclick="testAuth()">æµ‹è¯•è®¤è¯API</button>
            <button class="button" onclick="testStudentsAPI()">æµ‹è¯•å­¦ç”ŸAPI</button>
            <div id="networkResult"></div>
        </div>

        <div class="debug-section">
            <h3>ğŸ¯ é¡µé¢è·³è½¬æµ‹è¯•</h3>
            <button class="button" onclick="goToMain()">å‰å¾€ä¸»é¡µ</button>
            <button class="button" onclick="goToLogin()">å‰å¾€ç™»å½•é¡µ</button>
            <button class="button" onclick="goToBigScreen()">å‰å¾€å¤§å±é¡µ</button>
            <button class="button" onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
            <div id="navigationResult"></div>
        </div>

        <div class="debug-section">
            <h3>ğŸ”§ JavaScriptæ£€æŸ¥</h3>
            <button class="button" onclick="checkJSEnabled()">æ£€æŸ¥JSæ”¯æŒ</button>
            <button class="button" onclick="checkFetchAPI()">æ£€æŸ¥Fetch API</button>
            <button class="button" onclick="checkLocalStorage()">æ£€æŸ¥å­˜å‚¨åŠŸèƒ½</button>
            <div id="jsResult"></div>
        </div>

        <div class="debug-section">
            <h3>ğŸ“Š æ€§èƒ½ä¿¡æ¯</h3>
            <p><strong>é¡µé¢åŠ è½½æ—¶é—´:</strong> <span id="loadTime"></span></p>
            <p><strong>ç½‘ç»œç±»å‹:</strong> <span id="networkType"></span></p>
            <p><strong>ç”µæ± çŠ¶æ€:</strong> <span id="batteryStatus"></span></p>
        </div>
    </div>

    <script>
        // è®°å½•é¡µé¢åŠ è½½å¼€å§‹æ—¶é—´
        const startTime = performance.now();

        // è®¾å¤‡ä¿¡æ¯æ£€æµ‹
        function updateDeviceInfo() {
            document.getElementById('userAgent').textContent = navigator.userAgent;
            document.getElementById('screenSize').textContent = `${window.screen.width}Ã—${window.screen.height}`;
            document.getElementById('viewportSize').textContent = `${window.innerWidth}Ã—${window.innerHeight}`;

            // è®¾å¤‡ç±»å‹æ£€æµ‹
            const ua = navigator.userAgent;
            let deviceType = 'æœªçŸ¥è®¾å¤‡';
            if (/Android/i.test(ua)) {
                deviceType = 'Android è®¾å¤‡';
            } else if (/iPhone|iPad|iPod/i.test(ua)) {
                deviceType = 'iOS è®¾å¤‡';
            } else if (/Mobile/i.test(ua)) {
                deviceType = 'ç§»åŠ¨è®¾å¤‡';
            } else if (/Tablet/i.test(ua)) {
                deviceType = 'å¹³æ¿è®¾å¤‡';
            } else {
                deviceType = 'æ¡Œé¢è®¾å¤‡';
            }
            document.getElementById('deviceType').textContent = deviceType;

            // è§¦æ‘¸æ”¯æŒ
            document.getElementById('touchSupport').textContent =
                'ontouchstart' in window ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ';

            document.getElementById('currentTime').textContent = new Date().toLocaleString();
        }

        // å­˜å‚¨çŠ¶æ€æ£€æµ‹
        function checkStorageStatus() {
            // localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                document.getElementById('localStorageStatus').textContent = 'âœ… æ­£å¸¸';
                document.getElementById('localStorageStatus').className = 'status status-ok';
            } catch (e) {
                document.getElementById('localStorageStatus').textContent = 'âŒ å¼‚å¸¸: ' + e.message;
                document.getElementById('localStorageStatus').className = 'status status-error';
            }

            // sessionStorage
            try {
                sessionStorage.setItem('test', 'test');
                sessionStorage.removeItem('test');
                document.getElementById('sessionStorageStatus').textContent = 'âœ… æ­£å¸¸';
                document.getElementById('sessionStorageStatus').className = 'status status-ok';
            } catch (e) {
                document.getElementById('sessionStorageStatus').textContent = 'âŒ å¼‚å¸¸: ' + e.message;
                document.getElementById('sessionStorageStatus').className = 'status status-error';
            }

            // Tokenæ£€æŸ¥
            const token = localStorage.getItem('token');
            if (token) {
                document.getElementById('tokenStatus').textContent = 'âœ… å­˜åœ¨ (' + token.substring(0, 20) + '...)';
                document.getElementById('tokenStatus').className = 'status status-ok';
            } else {
                document.getElementById('tokenStatus').textContent = 'âŒ ä¸å­˜åœ¨';
                document.getElementById('tokenStatus').className = 'status status-warning';
            }

            // Cookieæ£€æŸ¥
            document.getElementById('cookieStatus').textContent =
                navigator.cookieEnabled ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨';
            document.getElementById('cookieStatus').className =
                navigator.cookieEnabled ? 'status status-ok' : 'status status-error';
        }

        // ç½‘ç»œæµ‹è¯•å‡½æ•°
        async function testHealthCheck() {
            const result = document.getElementById('networkResult');
            result.innerHTML = '<div class="result">ğŸ”„ æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£...</div>';

            try {
                const response = await fetch('/health');
                const data = await response.json();
                result.innerHTML = `
                    <div class="success">âœ… å¥åº·æ£€æŸ¥æˆåŠŸ</div>
                    <div class="result">${JSON.stringify(data, null, 2)}</div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="error">âŒ å¥åº·æ£€æŸ¥å¤±è´¥</div>
                    <div class="result">é”™è¯¯ä¿¡æ¯: ${error.message}</div>
                `;
            }
        }

        async function testAPI() {
            const result = document.getElementById('networkResult');
            result.innerHTML = '<div class="result">ğŸ”„ æµ‹è¯•APIé€šç”¨è¿æ¥...</div>';

            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                result.innerHTML = `
                    <div class="success">âœ… APIè¿æ¥æ­£å¸¸ (çŠ¶æ€: ${response.status})</div>
                    <div class="result">${JSON.stringify(data, null, 2)}</div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="error">âŒ APIè¿æ¥å¤±è´¥</div>
                    <div class="result">é”™è¯¯ä¿¡æ¯: ${error.message}</div>
                `;
            }
        }

        async function testAuth() {
            const result = document.getElementById('networkResult');
            result.innerHTML = '<div class="result">ğŸ”„ æµ‹è¯•è®¤è¯API...</div>';

            try {
                const response = await fetch('/api/auth/me');
                const data = await response.json();
                result.innerHTML = `
                    <div class="success">âœ… è®¤è¯APIå“åº”æ­£å¸¸ (çŠ¶æ€: ${response.status})</div>
                    <div class="result">${JSON.stringify(data, null, 2)}</div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="error">âŒ è®¤è¯APIå¤±è´¥</div>
                    <div class="result">é”™è¯¯ä¿¡æ¯: ${error.message}</div>
                `;
            }
        }

        async function testStudentsAPI() {
            const result = document.getElementById('networkResult');
            result.innerHTML = '<div class="result">ğŸ”„ æµ‹è¯•å­¦ç”Ÿæ•°æ®API...</div>';

            try {
                const response = await fetch('/api/students');
                const data = await response.json();
                result.innerHTML = `
                    <div class="success">âœ… å­¦ç”ŸAPIå“åº”æ­£å¸¸ (çŠ¶æ€: ${response.status})</div>
                    <div class="result">${JSON.stringify(data, null, 2)}</div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="error">âŒ å­¦ç”ŸAPIå¤±è´¥</div>
                    <div class="result">é”™è¯¯ä¿¡æ¯: ${error.message}</div>
                `;
            }
        }

        // é¡µé¢è·³è½¬å‡½æ•°
        function goToMain() {
            const result = document.getElementById('navigationResult');
            result.innerHTML = '<div class="result">ğŸ”„ è·³è½¬åˆ°ä¸»é¡µ...</div>';
            setTimeout(() => {
                window.location.href = '/';
            }, 1000);
        }

        function goToLogin() {
            const result = document.getElementById('navigationResult');
            result.innerHTML = '<div class="result">ğŸ”„ è·³è½¬åˆ°ç™»å½•é¡µ...</div>';
            setTimeout(() => {
                window.location.href = '/login';
            }, 1000);
        }

        function goToBigScreen() {
            const result = document.getElementById('navigationResult');
            result.innerHTML = '<div class="result">ğŸ”„ è·³è½¬åˆ°å¤§å±é¡µ...</div>';
            setTimeout(() => {
                window.location.href = '/screen';
            }, 1000);
        }

        function clearAllData() {
            const result = document.getElementById('navigationResult');
            localStorage.clear();
            sessionStorage.clear();
            result.innerHTML = '<div class="success">âœ… æ‰€æœ‰æœ¬åœ°æ•°æ®å·²æ¸…é™¤ï¼Œè¯·åˆ·æ–°é¡µé¢é‡æ–°æµ‹è¯•</div>';
        }

        // JavaScriptåŠŸèƒ½æ£€æŸ¥
        function checkJSEnabled() {
            const result = document.getElementById('jsResult');
            result.innerHTML = `
                <div class="success">âœ… JavaScript å·²å¯ç”¨</div>
                <div class="result">ç‰ˆæœ¬: ${navigator.userAgent}</div>
            `;
        }

        function checkFetchAPI() {
            const result = document.getElementById('jsResult');
            if (typeof fetch !== 'undefined') {
                result.innerHTML = '<div class="success">âœ… Fetch API å¯ç”¨</div>';
            } else {
                result.innerHTML = '<div class="error">âŒ Fetch API ä¸å¯ç”¨</div>';
            }
        }

        function checkLocalStorage() {
            const result = document.getElementById('jsResult');
            try {
                localStorage.setItem('test', '1');
                localStorage.removeItem('test');
                result.innerHTML = '<div class="success">âœ… localStorage åŠŸèƒ½æ­£å¸¸</div>';
            } catch (e) {
                result.innerHTML = `<div class="error">âŒ localStorage å¼‚å¸¸: ${e.message}</div>`;
            }
        }

        // æ€§èƒ½ä¿¡æ¯
        function updatePerformanceInfo() {
            // é¡µé¢åŠ è½½æ—¶é—´
            window.addEventListener('load', () => {
                const loadTime = (performance.now() - startTime).toFixed(2);
                document.getElementById('loadTime').textContent = loadTime + 'ms';
            });

            // ç½‘ç»œç±»å‹
            if ('connection' in navigator) {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                document.getElementById('networkType').textContent =
                    connection ? `${connection.effectiveType || 'æœªçŸ¥'} (${connection.downlink || 'æœªçŸ¥'}Mbps)` : 'ä¸å¯ç”¨';
            } else {
                document.getElementById('networkType').textContent = 'APIä¸å¯ç”¨';
            }

            // ç”µæ± çŠ¶æ€
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    const level = Math.round(battery.level * 100);
                    const charging = battery.charging ? 'å……ç”µä¸­' : 'æœªå……ç”µ';
                    document.getElementById('batteryStatus').textContent = `${level}% (${charging})`;
                }).catch(() => {
                    document.getElementById('batteryStatus').textContent = 'æƒé™è¢«æ‹’ç»';
                });
            } else {
                document.getElementById('batteryStatus').textContent = 'APIä¸å¯ç”¨';
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥
        window.addEventListener('load', () => {
            updateDeviceInfo();
            checkStorageStatus();
            updatePerformanceInfo();
        });

        // ç›‘å¬æ–¹å‘å˜åŒ–
        window.addEventListener('orientationchange', updateDeviceInfo);
        window.addEventListener('resize', updateDeviceInfo);
    </script>
</body>
</html>